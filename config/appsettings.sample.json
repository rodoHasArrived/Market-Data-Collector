{
  // =============================================================================
  // MARKET DATA COLLECTOR - SAMPLE CONFIGURATION
  // =============================================================================
  // Copy this file to appsettings.json and update the values for your setup.
  //
  // Environment Variables (can override config values):
  //   MDC_DEBUG=true          - Enable debug logging
  //   ALPACA_KEY_ID           - Alpaca API Key ID (recommended over config file)
  //   ALPACA_SECRET_KEY       - Alpaca Secret Key (recommended over config file)
  //   POLYGON_API_KEY         - Polygon.io API Key
  //   TIINGO_API_TOKEN        - Tiingo API Token
  //   FINNHUB_API_KEY         - Finnhub API Key
  //   ALPHA_VANTAGE_API_KEY   - Alpha Vantage API Key
  //
  // For more details, see docs/CONFIGURATION.md
  // =============================================================================

  // ---------------------------------------------------------------------------
  // DATA STORAGE SETTINGS
  // ---------------------------------------------------------------------------

  // Root directory for all data output (relative or absolute path)
  "DataRoot": "data",

  // Enable gzip compression for JSONL files (.jsonl.gz)
  "Compress": false,

  // ---------------------------------------------------------------------------
  // HISTORICAL BACKFILL SETTINGS
  // ---------------------------------------------------------------------------
  // Pull free end-of-day bars from multiple providers with automatic failover.
  // Supports: Alpaca, Yahoo Finance, Polygon.io, Tiingo, Finnhub, Stooq,
  //           Alpha Vantage (intraday), and Nasdaq Data Link (Quandl).
  "Backfill": {
    // Enable backfill mode (pulls historical data instead of live streaming)
    "Enabled": false,

    // Provider to use: "composite" (auto-failover), "alpaca", "yahoo", "stooq", "nasdaq"
    "Provider": "composite",

    // Symbols to backfill
    "Symbols": ["SPY", "QQQ", "AAPL"],

    // Date range (inclusive)
    "From": "2024-01-01",
    "To": "2024-12-31",

    // Data granularity: "daily", "hourly", "minute1", "minute5", "minute15", "minute30"
    "Granularity": "daily",

    // Enable automatic failover to alternate providers on failure
    "EnableFallback": true,

    // Use split/dividend adjusted prices when available
    "PreferAdjustedPrices": true,

    // Enable OpenFIGI symbol resolution (normalizes symbols across providers)
    "EnableSymbolResolution": true,

    // Custom provider priority order (optional, lower = tried first)
    // Default: ["alpaca", "yahoo", "stooq", "nasdaq"] (alpaca only if credentials available)
    "ProviderPriority": null,

    // Enable rate-limit aware provider rotation
    // When enabled, automatically switches to alternate providers when approaching rate limits
    "EnableRateLimitRotation": true,

    // Threshold (0.0-1.0) at which to start rotating to other providers
    // Default: 0.8 (start rotating when 80% of rate limit is used)
    "RateLimitRotationThreshold": 0.8,

    // Check existing archives and skip dates that already have data
    "SkipExistingData": true,

    // Only fill detected gaps in existing data (vs. full backfill)
    "FillGapsOnly": true,

    // Job management configuration
    "Jobs": {
      // Persist job state to disk for resume after restart
      "PersistJobs": true,

      // Directory for job state files (relative to DataRoot)
      "JobsDirectory": "_backfill_jobs",

      // Maximum concurrent requests across all providers
      "MaxConcurrentRequests": 3,

      // Maximum concurrent requests per provider
      "MaxConcurrentPerProvider": 2,

      // Maximum retries for failed requests
      "MaxRetries": 3,

      // Delay between retries in seconds
      "RetryDelaySeconds": 5,

      // Maximum days per request batch
      "BatchSizeDays": 365,

      // Automatically pause job when all providers are rate-limited
      "AutoPauseOnRateLimit": true,

      // Automatically resume after rate limit window expires
      "AutoResumeAfterRateLimit": true,

      // Maximum minutes to wait for rate limit before pausing
      "MaxRateLimitWaitMinutes": 5,

      // Scheduled backfill configuration
      "Scheduling": {
        // Enable scheduled backfill service
        "Enabled": false,

        // How often to check for due schedules (seconds)
        "ScheduleCheckIntervalSeconds": 60,

        // Maximum duration for a single execution (hours)
        "MaxExecutionDurationHours": 6,

        // Catch up missed schedules on startup
        "CatchUpMissedSchedules": true,

        // How far back to look for missed schedules (hours)
        "CatchUpWindowHours": 24,

        // Maximum concurrent scheduled executions
        "MaxConcurrentExecutions": 1,

        // Pause executions during market hours
        "PauseDuringMarketHours": false,

        // Default schedules to create on first startup (optional)
        // Presets available: "daily", "weekly", "eod", "monthly"
        "DefaultSchedules": [
          // {
          //   "Name": "Daily Gap-Fill",
          //   "Preset": "daily",
          //   "Symbols": ["SPY", "QQQ", "AAPL"],
          //   "Enabled": true
          // },
          // {
          //   "Name": "Weekly Full Backfill",
          //   "Preset": "weekly",
          //   "Symbols": null,  // Use default symbols
          //   "Enabled": false
          // },
          // {
          //   "Name": "Custom Schedule",
          //   "CronExpression": "0 4 * * *",  // Daily at 4 AM
          //   "LookbackDays": 14,
          //   "Enabled": true
          // }
        ]
      }
    },

    // Individual provider configuration
    "Providers": {
      // Alpaca Markets - Highest priority when credentials are available
      // See: https://docs.alpaca.markets/reference/stockbars
      "Alpaca": {
        "Enabled": true,
        // API credentials (recommended: use ALPACA_KEY_ID and ALPACA_SECRET_KEY env vars instead)
        "KeyId": null,
        "SecretKey": null,
        // Data feed: "iex" (free), "sip" (paid), or "delayed_sip" (free, 15-min delay)
        "Feed": "iex",
        // Price adjustment: "raw", "split", "dividend", or "all" (recommended)
        "Adjustment": "all",
        "Priority": 5,
        "RateLimitPerMinute": 200
      },

      // Yahoo Finance - Broadest free coverage (50K+ global securities)
      // No API key required, unofficial API
      "Yahoo": {
        "Enabled": true,
        "Priority": 10,
        "RateLimitPerHour": 2000
      },

      // Polygon.io - High-quality data with 2-year history on free tier
      // See: https://polygon.io/docs/stocks/get_v2_aggs_ticker__stocksticker__range__multiplier___timespan___from___to
      // Free tier: 5 API calls/minute, delayed data
      "Polygon": {
        "Enabled": true,
        // API key (recommended: use POLYGON_API_KEY env var instead)
        "ApiKey": null,
        "Priority": 12,
        "RateLimitPerMinute": 5
      },

      // Tiingo - Best for dividend-adjusted OHLCV with corporate actions
      // See: https://api.tiingo.com/documentation/end-of-day
      // Free tier: 1,000 requests/day, 50 requests/hour
      "Tiingo": {
        "Enabled": true,
        // API token (recommended: use TIINGO_API_TOKEN env var instead)
        "ApiToken": null,
        "Priority": 15,
        "RateLimitPerHour": 50
      },

      // Finnhub - Generous free tier with fundamentals data
      // See: https://finnhub.io/docs/api/stock-candles
      // Free tier: 60 API calls/minute
      "Finnhub": {
        "Enabled": true,
        // API key (recommended: use FINNHUB_API_KEY env var instead)
        "ApiKey": null,
        "Priority": 18,
        "RateLimitPerMinute": 60
      },

      // Stooq - Reliable free EOD data for US equities
      // No API key required
      "Stooq": {
        "Enabled": true,
        "Priority": 20,
        "DefaultMarket": "us"
      },

      // Alpha Vantage - Unique intraday historical data
      // See: https://www.alphavantage.co/documentation/
      // Free tier: 25 requests/day (very limited), 5 calls/minute
      // Disabled by default due to severely limited free tier
      "AlphaVantage": {
        "Enabled": false,
        // API key (recommended: use ALPHA_VANTAGE_API_KEY env var instead)
        "ApiKey": null,
        "Priority": 25,
        "RateLimitPerMinute": 5,
        "RateLimitPerDay": 25
      },

      // Nasdaq Data Link (formerly Quandl) - Alternative/financial datasets
      "Nasdaq": {
        "Enabled": true,
        "ApiKey": null,  // Optional: Get higher rate limits with API key
        "Database": "WIKI",
        "Priority": 30
      },

      // OpenFIGI symbol resolver - Normalizes symbols across providers
      "OpenFigi": {
        "Enabled": true,
        "ApiKey": null,  // Optional: Higher rate limits with API key
        "CacheResults": true
      }
    }
  },

  // ---------------------------------------------------------------------------
  // DATA SOURCE SELECTION
  // ---------------------------------------------------------------------------

  // Available options: "IB" (Interactive Brokers), "Alpaca", "Polygon"
  // Only one provider can be active at a time
  "DataSource": "IB",

  // ---------------------------------------------------------------------------
  // INTERACTIVE BROKERS (IB) - No additional config needed
  // ---------------------------------------------------------------------------
  // IB configuration is handled through symbol settings below.
  // Prerequisites:
  //   1. Install IB TWS or IB Gateway
  //   2. Enable API connections in TWS: File -> Global Configuration -> API -> Settings
  //   3. Ensure "Enable ActiveX and Socket Clients" is checked
  //   4. Note the port (default 7497 for TWS paper, 7496 for live)
  // See docs/interactive-brokers-setup.md for detailed setup instructions.

  // ---------------------------------------------------------------------------
  // ALPACA SETTINGS
  // ---------------------------------------------------------------------------
  // Required when DataSource is set to "Alpaca"
  "Alpaca": {
    // Your Alpaca API Key ID
    // SECURITY: Consider using environment variable ALPACA_KEY_ID instead
    "KeyId": "__SET_ME__",

    // Your Alpaca Secret Key
    // SECURITY: Consider using environment variable ALPACA_SECRET_KEY instead
    "SecretKey": "__SET_ME__",

    // Data feed to use: "iex" (free) or "sip" (paid, requires subscription)
    // IEX provides 15-min delayed data for free accounts
    // SIP provides real-time consolidated data (requires Alpaca paid plan)
    "Feed": "iex",

    // Use sandbox environment for testing (paper trading)
    "UseSandbox": false,

    // Subscribe to quote data (BBO updates) in addition to trades
    "SubscribeQuotes": false
  },

  // ---------------------------------------------------------------------------
  // STORAGE CONFIGURATION
  // ---------------------------------------------------------------------------
  "Storage": {
    // File naming convention:
    //   "Flat"     - {root}/{symbol}_{type}_{date}.jsonl
    //   "BySymbol" - {root}/{symbol}/{type}/{date}.jsonl (DEFAULT)
    //   "ByDate"   - {root}/{date}/{symbol}/{type}.jsonl
    //   "ByType"   - {root}/{type}/{symbol}/{date}.jsonl
    "NamingConvention": "BySymbol",

    // Date partitioning:
    //   "None"    - Single file per symbol/type
    //   "Daily"   - One file per day (DEFAULT)
    //   "Hourly"  - One file per hour (for high-volume scenarios)
    //   "Monthly" - One file per month (for long-term storage)
    "DatePartition": "Daily",

    // Include provider name in file path
    "IncludeProvider": false,

    // Optional prefix for all file names
    "FilePrefix": null,

    // Auto-delete files older than this many days (null = keep forever)
    "RetentionDays": null,

    // Maximum total storage in MB (null = unlimited)
    // When exceeded, oldest files are removed first
    "MaxTotalMegabytes": null
  },

  // ---------------------------------------------------------------------------
  // MASSTRANSIT DISTRIBUTED MESSAGING (OPTIONAL)
  // ---------------------------------------------------------------------------
  // Enable MassTransit to publish market events to a message broker.
  // This allows other services to consume market data in real-time.
  "MassTransit": {
    // Enable/disable MassTransit messaging (default: false)
    // When disabled, events are only stored locally
    "Enabled": false,

    // Transport type: "InMemory", "RabbitMQ", "AzureServiceBus"
    "Transport": "InMemory",

    // Optional prefix for queue/exchange names
    "EndpointPrefix": null,

    // Enable message scheduling (requires Quartz or Hangfire for some transports)
    "EnableScheduling": false,

    // RabbitMQ configuration (required when Transport is "RabbitMQ")
    "RabbitMQ": {
      "Host": "localhost",
      "Port": 5672,
      "VirtualHost": "/",
      "Username": "guest",
      "Password": "guest",
      "UseSsl": false,
      "PublisherConfirmation": true,
      "ClusterNodes": null
    },

    // Azure Service Bus configuration (required when Transport is "AzureServiceBus")
    "AzureServiceBus": {
      // Use connection string authentication
      "ConnectionString": "",
      // OR use managed identity authentication
      "Namespace": null,
      "UseManagedIdentity": false,
      "EnablePremiumFeatures": false
    },

    // Retry configuration for message publishing
    "Retry": {
      "MaxRetries": 3,
      "InitialIntervalMs": 100,
      "MaxIntervalMs": 5000,
      "IntervalMultiplier": 2.0
    }
  },

  // ---------------------------------------------------------------------------
  // SYMBOL SUBSCRIPTIONS
  // ---------------------------------------------------------------------------
  // Array of symbols to subscribe to. Each symbol can have its own settings.
  "Symbols": [
    // Example 1: Standard stock with all data
    {
      "Symbol": "SPY",
      "SubscribeTrades": true,
      "SubscribeDepth": true,
      "DepthLevels": 10,

      // IB-specific contract fields (ignored for Alpaca)
      "SecurityType": "STK",
      "Exchange": "SMART",
      "Currency": "USD",
      "PrimaryExchange": "ARCA"
    },

    // Example 2: Standard stock, trades only
    {
      "Symbol": "AAPL",
      "SubscribeTrades": true,
      "SubscribeDepth": false,
      "DepthLevels": 10,
      "SecurityType": "STK",
      "Exchange": "SMART",
      "Currency": "USD",
      "PrimaryExchange": "NASDAQ"
    },

    // Example 3: Preferred shares (IB requires LocalSymbol)
    {
      "Symbol": "PCG-PA",
      "SubscribeTrades": true,
      "SubscribeDepth": true,
      "DepthLevels": 10,
      "SecurityType": "STK",
      "Exchange": "SMART",
      "Currency": "USD",
      "PrimaryExchange": "NYSE",
      "LocalSymbol": "PCG PRA"
    }

    // Example 4: Futures contract (uncomment to use)
    // {
    //   "Symbol": "ES",
    //   "SubscribeTrades": true,
    //   "SubscribeDepth": true,
    //   "DepthLevels": 10,
    //   "SecurityType": "FUT",
    //   "Exchange": "CME",
    //   "Currency": "USD",
    //   "LocalSymbol": "ESH5"  // March 2025 contract
    // }
  ],

  // ---------------------------------------------------------------------------
  // LOGGING CONFIGURATION (Serilog)
  // ---------------------------------------------------------------------------
  "Serilog": {
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "System": "Warning"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "outputTemplate": "[{Timestamp:HH:mm:ss} {Level:u3}] {Message:lj}{NewLine}{Exception}"
        }
      },
      {
        "Name": "File",
        "Args": {
          "path": "data/_logs/mdc-.log",
          "rollingInterval": "Day",
          "retainedFileCountLimit": 30
        }
      }
    ]
  }
}
