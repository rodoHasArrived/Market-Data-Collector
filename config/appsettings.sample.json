{
  // =============================================================================
  // MARKET DATA COLLECTOR - SAMPLE CONFIGURATION
  // =============================================================================
  // Copy this file to appsettings.json and update non-sensitive values.
  //
  // ⚠️  SECURITY: NEVER store API keys or secrets in this file!
  // ⚠️  Use environment variables for all credentials.
  //
  // ---------------------------------------------------------------------------
  // REQUIRED ENVIRONMENT VARIABLES (set these before running):
  // ---------------------------------------------------------------------------
  //
  // Data Providers (set based on which providers you use):
  //   ALPACA_KEY_ID           - Alpaca API Key ID
  //   ALPACA_SECRET_KEY       - Alpaca Secret Key
  //   POLYGON_API_KEY         - Polygon.io API Key
  //   TIINGO_API_TOKEN        - Tiingo API Token
  //   FINNHUB_API_KEY         - Finnhub API Key
  //   ALPHA_VANTAGE_API_KEY   - Alpha Vantage API Key
  //   NASDAQ_API_KEY          - Nasdaq Data Link API Key
  //   OPENFIGI_API_KEY        - OpenFIGI API Key (optional, higher rate limits)
  //   NYSE_API_KEY            - NYSE Connect API Key
  //   NYSE_API_SECRET         - NYSE Connect API Secret
  //   NYSE_CLIENT_ID          - NYSE OAuth Client ID
  //   MDC_STOCKSHARP_CONNECTOR        - StockSharp connector type (Rithmic, IQFeed, CQG, InteractiveBrokers, Custom)
  //   MDC_STOCKSHARP_ADAPTER_TYPE     - StockSharp adapter type (for custom connectors)
  //   MDC_STOCKSHARP_ADAPTER_ASSEMBLY - StockSharp adapter assembly (if needed)
  //   MDC_STOCKSHARP_RITHMIC_SERVER   - Rithmic server name
  //   MDC_STOCKSHARP_RITHMIC_USERNAME - Rithmic username
  //   MDC_STOCKSHARP_RITHMIC_PASSWORD - Rithmic password
  //   MDC_STOCKSHARP_RITHMIC_CERTFILE - Path to Rithmic certificate file
  //   MDC_STOCKSHARP_IQFEED_HOST      - IQFeed host address
  //   MDC_STOCKSHARP_IQFEED_LEVEL1_PORT - IQFeed Level1 port
  //   MDC_STOCKSHARP_CQG_USERNAME     - CQG username
  //   MDC_STOCKSHARP_CQG_PASSWORD     - CQG password
  //   MDC_STOCKSHARP_IB_HOST          - Interactive Brokers host (via StockSharp)
  //   MDC_STOCKSHARP_IB_PORT          - Interactive Brokers port (via StockSharp)
  //
  // Optional:
  //   MDC_DEBUG=true          - Enable debug logging
  //
  // Example (Linux/macOS):
  //   export ALPACA_KEY_ID=your-key-id
  //   export ALPACA_SECRET_KEY=your-secret-key
  //
  // Example (Windows PowerShell):
  //   $env:ALPACA_KEY_ID="your-key-id"
  //   $env:ALPACA_SECRET_KEY="your-secret-key"
  //
  // For more details, see docs/guides/configuration.md
  // =============================================================================

  // ---------------------------------------------------------------------------
  // DATA STORAGE SETTINGS
  // ---------------------------------------------------------------------------

  // Root directory for all data output (relative or absolute path)
  "DataRoot": "data",

  // Enable gzip compression for JSONL files (.jsonl.gz)
  "Compress": false,

  // ---------------------------------------------------------------------------
  // HISTORICAL BACKFILL SETTINGS
  // ---------------------------------------------------------------------------
  // Pull free end-of-day bars from multiple providers with automatic failover.
  // Supports: Alpaca, Yahoo Finance, Polygon.io, Tiingo, Finnhub, Stooq,
  //           Alpha Vantage (intraday), and Nasdaq Data Link (Quandl).
  "Backfill": {
    // Enable backfill mode (pulls historical data instead of live streaming)
    "Enabled": false,

    // Provider to use: "composite" (auto-failover), "alpaca", "yahoo", "stooq", "nasdaq"
    "Provider": "composite",

    // Symbols to backfill
    "Symbols": ["SPY", "QQQ", "AAPL"],

    // Date range (inclusive)
    "From": "2024-01-01",
    "To": "2024-12-31",

    // Data granularity: "daily", "hourly", "minute1", "minute5", "minute15", "minute30"
    "Granularity": "daily",

    // Enable automatic failover to alternate providers on failure
    "EnableFallback": true,

    // Use split/dividend adjusted prices when available
    "PreferAdjustedPrices": true,

    // Enable OpenFIGI symbol resolution (normalizes symbols across providers)
    "EnableSymbolResolution": true,

    // Custom provider priority order (optional, lower = tried first)
    // Default: ["alpaca", "yahoo", "stooq", "nasdaq"] (alpaca only if credentials available)
    "ProviderPriority": null,

    // Enable rate-limit aware provider rotation
    // When enabled, automatically switches to alternate providers when approaching rate limits
    "EnableRateLimitRotation": true,

    // Threshold (0.0-1.0) at which to start rotating to other providers
    // Default: 0.8 (start rotating when 80% of rate limit is used)
    "RateLimitRotationThreshold": 0.8,

    // Check existing archives and skip dates that already have data
    "SkipExistingData": true,

    // Only fill detected gaps in existing data (vs. full backfill)
    "FillGapsOnly": true,

    // Job management configuration
    "Jobs": {
      // Persist job state to disk for resume after restart
      "PersistJobs": true,

      // Directory for job state files (relative to DataRoot)
      "JobsDirectory": "_backfill_jobs",

      // Maximum concurrent requests across all providers
      "MaxConcurrentRequests": 3,

      // Maximum concurrent requests per provider
      "MaxConcurrentPerProvider": 2,

      // Maximum retries for failed requests
      "MaxRetries": 3,

      // Delay between retries in seconds
      "RetryDelaySeconds": 5,

      // Maximum days per request batch
      "BatchSizeDays": 365,

      // Automatically pause job when all providers are rate-limited
      "AutoPauseOnRateLimit": true,

      // Automatically resume after rate limit window expires
      "AutoResumeAfterRateLimit": true,

      // Maximum minutes to wait for rate limit before pausing
      "MaxRateLimitWaitMinutes": 5,

      // Scheduled backfill configuration
      "Scheduling": {
        // Enable scheduled backfill service
        "Enabled": false,

        // How often to check for due schedules (seconds)
        "ScheduleCheckIntervalSeconds": 60,

        // Maximum duration for a single execution (hours)
        "MaxExecutionDurationHours": 6,

        // Catch up missed schedules on startup
        "CatchUpMissedSchedules": true,

        // How far back to look for missed schedules (hours)
        "CatchUpWindowHours": 24,

        // Maximum concurrent scheduled executions
        "MaxConcurrentExecutions": 1,

        // Pause executions during market hours
        "PauseDuringMarketHours": false,

        // Default schedules to create on first startup (optional)
        // Presets available: "daily", "weekly", "eod", "monthly"
        "DefaultSchedules": [
          // {
          //   "Name": "Daily Gap-Fill",
          //   "Preset": "daily",
          //   "Symbols": ["SPY", "QQQ", "AAPL"],
          //   "Enabled": true
          // },
          // {
          //   "Name": "Weekly Full Backfill",
          //   "Preset": "weekly",
          //   "Symbols": null,  // Use default symbols
          //   "Enabled": false
          // },
          // {
          //   "Name": "Custom Schedule",
          //   "CronExpression": "0 4 * * *",  // Daily at 4 AM
          //   "LookbackDays": 14,
          //   "Enabled": true
          // }
        ]
      }
    },

    // Individual provider configuration
    "Providers": {
      // Alpaca Markets - Highest priority when credentials are available
      // See: https://docs.alpaca.markets/reference/stockbars
      // Credentials: Set ALPACA_KEY_ID and ALPACA_SECRET_KEY environment variables
      "Alpaca": {
        "Enabled": true,
        // Data feed: "iex" (free), "sip" (paid), or "delayed_sip" (free, 15-min delay)
        "Feed": "iex",
        // Price adjustment: "raw", "split", "dividend", or "all" (recommended)
        "Adjustment": "all",
        "Priority": 5,
        "RateLimitPerMinute": 200
      },

      // Yahoo Finance - Broadest free coverage (50K+ global securities)
      // No API key required, unofficial API
      "Yahoo": {
        "Enabled": true,
        "Priority": 10,
        "RateLimitPerHour": 2000
      },

      // Polygon.io - High-quality data with 2-year history on free tier
      // See: https://polygon.io/docs/stocks/get_v2_aggs_ticker__stocksticker__range__multiplier___timespan___from___to
      // Free tier: 5 API calls/minute, delayed data
      // Credentials: Set POLYGON_API_KEY environment variable
      "Polygon": {
        "Enabled": true,
        "Priority": 12,
        "RateLimitPerMinute": 5
      },

      // Tiingo - Best for dividend-adjusted OHLCV with corporate actions
      // See: https://api.tiingo.com/documentation/end-of-day
      // Free tier: 1,000 requests/day, 50 requests/hour
      // Credentials: Set TIINGO_API_TOKEN environment variable
      "Tiingo": {
        "Enabled": true,
        "Priority": 15,
        "RateLimitPerHour": 50
      },

      // Finnhub - Generous free tier with fundamentals data
      // See: https://finnhub.io/docs/api/stock-candles
      // Free tier: 60 API calls/minute
      // Credentials: Set FINNHUB_API_KEY environment variable
      "Finnhub": {
        "Enabled": true,
        "Priority": 18,
        "RateLimitPerMinute": 60
      },

      // Stooq - Reliable free EOD data for US equities
      // No API key required
      "Stooq": {
        "Enabled": true,
        "Priority": 20,
        "DefaultMarket": "us"
      },

      // Alpha Vantage - Unique intraday historical data
      // See: https://www.alphavantage.co/documentation/
      // Free tier: 25 requests/day (very limited), 5 calls/minute
      // Disabled by default due to severely limited free tier
      // Credentials: Set ALPHA_VANTAGE_API_KEY environment variable
      "AlphaVantage": {
        "Enabled": false,
        "Priority": 25,
        "RateLimitPerMinute": 5,
        "RateLimitPerDay": 25
      },

      // Nasdaq Data Link (formerly Quandl) - Alternative/financial datasets
      // Credentials: Set NASDAQ_API_KEY environment variable (optional, higher rate limits)
      "Nasdaq": {
        "Enabled": true,
        "Database": "WIKI",
        "Priority": 30
      },

      // OpenFIGI symbol resolver - Normalizes symbols across providers
      // Credentials: Set OPENFIGI_API_KEY environment variable (optional, higher rate limits)
      "OpenFigi": {
        "Enabled": true,
        "CacheResults": true
      }
    }
  },

  // ---------------------------------------------------------------------------
  // DATA SOURCE SELECTION (Legacy - Single Provider)
  // ---------------------------------------------------------------------------

  // Available options: "IB" (Interactive Brokers), "Alpaca", "Polygon", "NYSE", "StockSharp"
  // For single-provider mode only. See DataSources below for multi-provider.
  "DataSource": "IB",

  // ---------------------------------------------------------------------------
  // MULTI-PROVIDER CONFIGURATION (NEW)
  // ---------------------------------------------------------------------------
  // Configure multiple simultaneous data providers with automatic failover.
  // This replaces the single DataSource setting when enabled.
  // NOTE: Credentials are resolved from environment variables - do NOT add them here.
  "DataSources": {
    // List of configured data sources
    "Sources": [
      // Example: Primary Alpaca feed
      // Credentials: Set ALPACA_KEY_ID and ALPACA_SECRET_KEY environment variables
      {
        "Id": "alpaca-primary",
        "Name": "Alpaca Primary",
        "Provider": "Alpaca",
        "Enabled": true,
        "Type": "RealTime",
        "Priority": 10,
        "Description": "Primary real-time feed from Alpaca",
        "Alpaca": {
          "Feed": "sip"
        }
      },
      // Example: Backup IB feed
      // No credentials needed - uses local IB Gateway/TWS connection
      {
        "Id": "ib-backup",
        "Name": "Interactive Brokers Backup",
        "Provider": "IB",
        "Enabled": true,
        "Type": "RealTime",
        "Priority": 20,
        "Description": "Backup feed via Interactive Brokers",
        "IB": {
          "Host": "127.0.0.1",
          "Port": 7496,
          "ClientId": 1
        }
      },
      // Example: Tertiary StockSharp feed for redundancy + cross-validation
      {
        "Id": "stocksharp-tertiary",
        "Name": "StockSharp Tertiary",
        "Provider": "StockSharp",
        "Enabled": true,
        "Type": "RealTime",
        "Priority": 30,
        "Description": "Tertiary feed via StockSharp adapter (used for failover and consistency checks)",
        "Tags": ["tertiary", "cross-validate", "multi-asset"]
      }
    ],

    // Default data source ID for real-time streaming
    "DefaultRealTimeSourceId": "alpaca-primary",

    // Default data source ID for historical data requests
    "DefaultHistoricalSourceId": "alpaca-primary",

    // ---------------------------------------------------------------------------
    // AUTOMATIC FAILOVER SETTINGS
    // ---------------------------------------------------------------------------

    // Enable automatic failover between providers
    "EnableFailover": true,

    // Timeout in seconds before failover to next provider
    "FailoverTimeoutSeconds": 30,

    // Health check interval in seconds
    "HealthCheckIntervalSeconds": 10,

    // Automatically recover to primary provider when it becomes healthy
    "AutoRecover": true,

    // Failover rules - define primary/backup chains
    "FailoverRules": [
      {
        "Id": "realtime-failover",
        "PrimaryProviderId": "alpaca-primary",
        "BackupProviderIds": ["ib-backup", "stocksharp-tertiary"],
        "FailoverThreshold": 3,
        "RecoveryThreshold": 5,
        "DataQualityThreshold": 70,
        "MaxLatencyMs": 100
      }
    ],

    // ---------------------------------------------------------------------------
    // SYMBOL MAPPING CONFIGURATION
    // ---------------------------------------------------------------------------
    // Map canonical symbols to provider-specific symbols
    "SymbolMappings": {
      // Path to persist symbol mappings
      "PersistencePath": "data/_config/symbol-mappings.json",

      // Pre-configured mappings for common edge cases
      "Mappings": [
        {
          "CanonicalSymbol": "BRK.B",
          "IbSymbol": "BRK B",
          "AlpacaSymbol": "BRK.B",
          "PolygonSymbol": "BRK.B",
          "YahooSymbol": "BRK-B",
          "Name": "Berkshire Hathaway Class B"
        },
        {
          "CanonicalSymbol": "BRK.A",
          "IbSymbol": "BRK A",
          "AlpacaSymbol": "BRK.A",
          "PolygonSymbol": "BRK.A",
          "YahooSymbol": "BRK-A",
          "Name": "Berkshire Hathaway Class A"
        }
      ]
    }
  },

  // ---------------------------------------------------------------------------
  // INTERACTIVE BROKERS (IB) - No additional config needed
  // ---------------------------------------------------------------------------
  // IB configuration is handled through symbol settings below.
  // Prerequisites:
  //   1. Install IB TWS or IB Gateway
  //   2. Enable API connections in TWS: File -> Global Configuration -> API -> Settings
  //   3. Ensure "Enable ActiveX and Socket Clients" is checked
  //   4. Note the port (default 7497 for TWS paper, 7496 for live)
  // See docs/interactive-brokers-setup.md for detailed setup instructions.

  // ---------------------------------------------------------------------------
  // ALPACA SETTINGS
  // ---------------------------------------------------------------------------
  // Required when DataSource is set to "Alpaca"
  // Credentials: Set ALPACA_KEY_ID and ALPACA_SECRET_KEY environment variables
  "Alpaca": {
    // Data feed to use: "iex" (free) or "sip" (paid, requires subscription)
    // IEX provides 15-min delayed data for free accounts
    // SIP provides real-time consolidated data (requires Alpaca paid plan)
    "Feed": "iex",

    // Use sandbox environment for testing (paper trading)
    "UseSandbox": false,

    // Subscribe to quote data (BBO updates) in addition to trades
    "SubscribeQuotes": false
  },

  // ---------------------------------------------------------------------------
  // STOCKSHARP SETTINGS
  // ---------------------------------------------------------------------------
  // Required when DataSource is set to "StockSharp"
  // Credentials: Set MDC_STOCKSHARP_* environment variables (see top of file)
  "StockSharp": {
    "Enabled": true,
    "ConnectorType": "Rithmic",
    "AdapterType": "",
    "AdapterAssembly": "",
    "EnableRealTime": true,
    "EnableHistorical": true,
    "UseBinaryStorage": false,
    "StoragePath": "data/stocksharp/{connector}",
    "Rithmic": {
      "Server": "Rithmic Test",
      "UserName": "",
      "Password": "",
      "CertFile": "",
      "UsePaperTrading": true
    },
    "IQFeed": {
      "Host": "127.0.0.1",
      "Level1Port": 9100,
      "Level2Port": 9200,
      "LookupPort": 9300,
      "ProductId": "",
      "ProductVersion": "1.0"
    },
    "CQG": {
      "UserName": "",
      "Password": "",
      "UseDemoServer": true
    },
    "InteractiveBrokers": {
      "Host": "127.0.0.1",
      "Port": 7496,
      "ClientId": 1
    }
  },

  // ---------------------------------------------------------------------------
  // STORAGE CONFIGURATION
  // ---------------------------------------------------------------------------
  "Storage": {
    // File naming convention:
    //   "Flat"     - {root}/{symbol}_{type}_{date}.jsonl
    //   "BySymbol" - {root}/{symbol}/{type}/{date}.jsonl (DEFAULT)
    //   "ByDate"   - {root}/{date}/{symbol}/{type}.jsonl
    //   "ByType"   - {root}/{type}/{symbol}/{date}.jsonl
    "NamingConvention": "BySymbol",

    // Date partitioning:
    //   "None"    - Single file per symbol/type
    //   "Daily"   - One file per day (DEFAULT)
    //   "Hourly"  - One file per hour (for high-volume scenarios)
    //   "Monthly" - One file per month (for long-term storage)
    "DatePartition": "Daily",

    // Include provider name in file path
    "IncludeProvider": false,

    // Optional prefix for all file names
    "FilePrefix": null,

    // Optional storage profile preset: Research, LowLatency, Archival
    "Profile": null,

    // Auto-delete files older than this many days (null = keep forever)
    "RetentionDays": null,

    // Maximum total storage in MB (null = unlimited)
    // When exceeded, oldest files are removed first
    "MaxTotalMegabytes": null
  },

  // ---------------------------------------------------------------------------
  // SYMBOL SUBSCRIPTIONS
  // ---------------------------------------------------------------------------
  // Array of symbols to subscribe to. Each symbol can have its own settings.
  "Symbols": [
    // Example 1: Standard stock with all data
    {
      "Symbol": "SPY",
      "SubscribeTrades": true,
      "SubscribeDepth": true,
      "DepthLevels": 10,

      // IB-specific contract fields (ignored for Alpaca)
      "SecurityType": "STK",
      "Exchange": "SMART",
      "Currency": "USD",
      "PrimaryExchange": "ARCA"
    },

    // Example 2: Standard stock, trades only
    {
      "Symbol": "AAPL",
      "SubscribeTrades": true,
      "SubscribeDepth": false,
      "DepthLevels": 10,
      "SecurityType": "STK",
      "Exchange": "SMART",
      "Currency": "USD",
      "PrimaryExchange": "NASDAQ"
    },

    // Example 3: Preferred shares (IB requires LocalSymbol)
    {
      "Symbol": "PCG-PA",
      "SubscribeTrades": true,
      "SubscribeDepth": true,
      "DepthLevels": 10,
      "SecurityType": "STK",
      "Exchange": "SMART",
      "Currency": "USD",
      "PrimaryExchange": "NYSE",
      "LocalSymbol": "PCG PRA"
    }

    // Example 4: Futures contract (uncomment to use)
    // {
    //   "Symbol": "ES",
    //   "SubscribeTrades": true,
    //   "SubscribeDepth": true,
    //   "DepthLevels": 10,
    //   "SecurityType": "FUT",
    //   "Exchange": "CME",
    //   "Currency": "USD",
    //   "LocalSymbol": "ESH5"  // March 2025 contract
    // }
  ],

  // ---------------------------------------------------------------------------
  // DESKTOP APP SETTINGS (UWP)
  // ---------------------------------------------------------------------------
  // Settings specific to the Windows desktop application.
  // These control the connection to the core Market Data Collector service.
  "Settings": {
    // Theme: "System", "Light", or "Dark"
    "Theme": "System",

    // Accent color: "System" or a hex color (e.g., "#0078D4")
    "AccentColor": "System",

    // Use compact mode for UI elements
    "CompactMode": false,

    // Enable Windows toast notifications
    "NotificationsEnabled": true,

    // Notification types
    "NotifyConnectionStatus": true,
    "NotifyErrors": true,
    "NotifyBackfillComplete": true,
    "NotifyDataGaps": true,
    "NotifyStorageWarnings": true,

    // Quiet hours for notifications
    "QuietHoursEnabled": false,
    "QuietHoursStart": "22:00",
    "QuietHoursEnd": "07:00",

    // Auto-reconnection settings
    "AutoReconnectEnabled": true,
    "MaxReconnectAttempts": 10,

    // Status refresh interval in seconds
    "StatusRefreshIntervalSeconds": 2,

    // ---------------------------------------------------------------------------
    // SERVICE CONNECTION SETTINGS
    // ---------------------------------------------------------------------------

    // URL of the Market Data Collector service
    // Change this if running the service on a different host or port
    "ServiceUrl": "http://localhost:8080",

    // Timeout in seconds for API requests to the service
    "ServiceTimeoutSeconds": 30,

    // Timeout in minutes for long-running backfill operations
    "BackfillTimeoutMinutes": 60
  },

  // ---------------------------------------------------------------------------
  // LOGGING CONFIGURATION (Serilog)
  // ---------------------------------------------------------------------------
  "Serilog": {
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "System": "Warning"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "outputTemplate": "[{Timestamp:HH:mm:ss} {Level:u3}] {Message:lj}{NewLine}{Exception}"
        }
      },
      {
        "Name": "File",
        "Args": {
          "path": "data/_logs/mdc-.log",
          "rollingInterval": "Day",
          "retainedFileCountLimit": 30
        }
      }
    ]
  }
}
