<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MarketDataCollector.Uwp.Views.StoragePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MarketDataCollector.Uwp.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24">
        <StackPanel Spacing="24" MaxWidth="1000">
            <!-- Header -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" Spacing="12">
                    <FontIcon Glyph="&#xE8B7;" FontSize="28" Foreground="{ThemeResource SystemAccentColor}" />
                    <TextBlock Text="Storage Settings" Style="{StaticResource TitleTextBlockStyle}" VerticalAlignment="Center" />
                </StackPanel>

                <Button Grid.Column="1" Click="RefreshAnalytics_Click">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE72C;" FontSize="14" />
                        <TextBlock Text="Refresh Analytics" />
                    </StackPanel>
                </Button>
            </Grid>

            <!-- Storage Analytics Dashboard -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE9D9;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Storage Analytics" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <!-- Disk Usage Overview -->
                    <Grid ColumnSpacing="24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- Total Storage -->
                        <Border Grid.Column="0" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Total Storage" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                <TextBlock x:Name="TotalStorageText" Text="12.4 GB"
                                           Style="{StaticResource SubheaderTextBlockStyle}"
                                           Foreground="{ThemeResource SystemAccentColor}" />
                                <TextBlock x:Name="TotalFilesText" Text="1,847 files"
                                           Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                        </Border>

                        <!-- Trade Data -->
                        <Border Grid.Column="1" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Trade Data" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                <TextBlock x:Name="TradeStorageText" Text="8.2 GB"
                                           Style="{StaticResource SubheaderTextBlockStyle}"
                                           Foreground="#48BB78" />
                                <TextBlock x:Name="TradeFilesText" Text="1,245 files"
                                           Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                        </Border>

                        <!-- Depth Data -->
                        <Border Grid.Column="2" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Depth Data" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                <TextBlock x:Name="DepthStorageText" Text="3.8 GB"
                                           Style="{StaticResource SubheaderTextBlockStyle}"
                                           Foreground="#ED8936" />
                                <TextBlock x:Name="DepthFilesText" Text="512 files"
                                           Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                        </Border>

                        <!-- Historical -->
                        <Border Grid.Column="3" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Historical" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                <TextBlock x:Name="HistoricalStorageText" Text="0.4 GB"
                                           Style="{StaticResource SubheaderTextBlockStyle}"
                                           Foreground="#667EEA" />
                                <TextBlock x:Name="HistoricalFilesText" Text="90 files"
                                           Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Storage Usage Bar -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Disk Usage" Style="{StaticResource BodyStrongTextBlockStyle}" />
                        <Grid Height="24" CornerRadius="4" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition x:Name="TradeColumn" Width="66*" />
                                <ColumnDefinition x:Name="DepthColumn" Width="31*" />
                                <ColumnDefinition x:Name="HistoricalColumn" Width="3*" />
                                <ColumnDefinition x:Name="FreeColumn" Width="0*" />
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Background="#48BB78" CornerRadius="4,0,0,4" />
                            <Border Grid.Column="1" Background="#ED8936" />
                            <Border Grid.Column="2" Background="#667EEA" CornerRadius="0,4,4,0" />
                        </Grid>
                        <StackPanel Orientation="Horizontal" Spacing="24">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Ellipse Width="10" Height="10" Fill="#48BB78" />
                                <TextBlock Text="Trade (66%)" Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Ellipse Width="10" Height="10" Fill="#ED8936" />
                                <TextBlock Text="Depth (31%)" Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Ellipse Width="10" Height="10" Fill="#667EEA" />
                                <TextBlock Text="Historical (3%)" Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <!-- Top Symbols by Storage -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Top Symbols by Storage" Style="{StaticResource BodyStrongTextBlockStyle}" />
                        <ListView x:Name="TopSymbolsList" SelectionMode="None" MaxHeight="180">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="8,4" ColumnSpacing="16">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="80" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="{Binding Symbol}" FontWeight="SemiBold" />
                                        <ProgressBar Grid.Column="1" Value="{Binding Percentage}" Maximum="100" Height="8" />
                                        <TextBlock Grid.Column="2" Text="{Binding Size}" HorizontalAlignment="Right" />
                                        <TextBlock Grid.Column="3" Text="{Binding Files}" HorizontalAlignment="Right"
                                                   Foreground="{ThemeResource SystemBaseMediumColor}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Data Lifecycle Management -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE823;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Data Lifecycle Management" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <ToggleSwitch x:Name="LifecycleEnabledToggle"
                                  Header="Enable Automatic Data Tiering"
                                  OffContent="Disabled"
                                  OnContent="Enabled"
                                  Toggled="LifecycleToggle_Toggled" />

                    <Grid x:Name="LifecycleSettingsPanel" RowSpacing="16">
                        <!-- Hot Tier -->
                        <Border Background="#48BB7820" CornerRadius="8" Padding="16" Margin="0,0,0,8">
                            <Grid ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Spacing="4" Width="120">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Ellipse Width="12" Height="12" Fill="#48BB78" />
                                        <TextBlock Text="Hot Tier" FontWeight="SemiBold" />
                                    </StackPanel>
                                    <TextBlock Text="Fast SSD storage" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                                </StackPanel>
                                <StackPanel Grid.Column="1" Spacing="4">
                                    <TextBlock Text="Retention: Last 7 days" />
                                    <TextBlock Text="Format: Uncompressed JSONL"
                                               Style="{StaticResource CaptionTextBlockStyle}" />
                                </StackPanel>
                                <NumberBox x:Name="HotRetentionDays" Grid.Column="2"
                                           Header="Days" Value="7" Minimum="1" Maximum="90"
                                           SpinButtonPlacementMode="Compact" Width="100" />
                            </Grid>
                        </Border>

                        <!-- Warm Tier -->
                        <Border Background="#ED893620" CornerRadius="8" Padding="16" Margin="0,0,0,8">
                            <Grid ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Spacing="4" Width="120">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Ellipse Width="12" Height="12" Fill="#ED8936" />
                                        <TextBlock Text="Warm Tier" FontWeight="SemiBold" />
                                    </StackPanel>
                                    <TextBlock Text="Compressed local" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                                </StackPanel>
                                <StackPanel Grid.Column="1" Spacing="4">
                                    <TextBlock Text="Retention: 7-90 days" />
                                    <TextBlock Text="Format: Compressed (gzip)"
                                               Style="{StaticResource CaptionTextBlockStyle}" />
                                </StackPanel>
                                <NumberBox x:Name="WarmRetentionDays" Grid.Column="2"
                                           Header="Days" Value="90" Minimum="7" Maximum="365"
                                           SpinButtonPlacementMode="Compact" Width="100" />
                            </Grid>
                        </Border>

                        <!-- Cold Tier -->
                        <Border Background="#667EEA20" CornerRadius="8" Padding="16">
                            <Grid ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Spacing="4" Width="120">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Ellipse Width="12" Height="12" Fill="#667EEA" />
                                        <TextBlock Text="Cold Tier" FontWeight="SemiBold" />
                                    </StackPanel>
                                    <TextBlock Text="Archive/Cloud" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                                </StackPanel>
                                <StackPanel Grid.Column="1" Spacing="4">
                                    <TextBlock Text="Retention: 90+ days (or delete)" />
                                    <TextBlock Text="Format: Parquet or cloud archive"
                                               Style="{StaticResource CaptionTextBlockStyle}" />
                                </StackPanel>
                                <ComboBox x:Name="ColdTierAction" Grid.Column="2" Header="Action" Width="140">
                                    <ComboBoxItem Content="Archive to Cloud" Tag="Cloud" IsSelected="True" />
                                    <ComboBoxItem Content="Convert to Parquet" Tag="Parquet" />
                                    <ComboBoxItem Content="Delete" Tag="Delete" />
                                </ComboBox>
                            </Grid>
                        </Border>
                    </Grid>

                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Button Content="Run Lifecycle Now" Click="RunLifecycle_Click">
                            <Button.KeyboardAccelerators>
                                <KeyboardAccelerator Modifiers="Control,Shift" Key="L" />
                            </Button.KeyboardAccelerators>
                        </Button>
                        <ProgressRing x:Name="LifecycleProgress" IsActive="False" Width="20" Height="20" />
                        <TextBlock x:Name="LifecycleStatusText" VerticalAlignment="Center"
                                   Style="{StaticResource CaptionTextBlockStyle}" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Cloud Storage Integration -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE753;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Cloud Storage Integration" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <ToggleSwitch x:Name="CloudEnabledToggle"
                                  Header="Enable Cloud Sync"
                                  OffContent="Disabled"
                                  OnContent="Enabled"
                                  Toggled="CloudToggle_Toggled" />

                    <Grid x:Name="CloudSettingsPanel" ColumnSpacing="16" RowSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <ComboBox x:Name="CloudProviderCombo" Grid.Row="0" Grid.Column="0"
                                  Header="Cloud Provider" HorizontalAlignment="Stretch"
                                  SelectionChanged="CloudProvider_Changed">
                            <ComboBoxItem Content="Azure Blob Storage" Tag="Azure" IsSelected="True">
                                <ComboBoxItem.ContentTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <FontIcon Glyph="&#xE753;" FontSize="14" />
                                            <TextBlock Text="Azure Blob Storage" />
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBoxItem.ContentTemplate>
                            </ComboBoxItem>
                            <ComboBoxItem Content="AWS S3" Tag="S3">
                                <ComboBoxItem.ContentTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <FontIcon Glyph="&#xE753;" FontSize="14" />
                                            <TextBlock Text="AWS S3" />
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBoxItem.ContentTemplate>
                            </ComboBoxItem>
                            <ComboBoxItem Content="Google Cloud Storage" Tag="GCS">
                                <ComboBoxItem.ContentTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <FontIcon Glyph="&#xE753;" FontSize="14" />
                                            <TextBlock Text="Google Cloud Storage" />
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBoxItem.ContentTemplate>
                            </ComboBoxItem>
                        </ComboBox>

                        <ComboBox x:Name="CloudSyncModeCombo" Grid.Row="0" Grid.Column="1"
                                  Header="Sync Mode" HorizontalAlignment="Stretch">
                            <ComboBoxItem Content="Manual" Tag="Manual" />
                            <ComboBoxItem Content="Scheduled" Tag="Scheduled" IsSelected="True" />
                            <ComboBoxItem Content="Real-time" Tag="Realtime" />
                        </ComboBox>

                        <!-- Azure Settings -->
                        <StackPanel x:Name="AzureSettings" Grid.Row="1" Grid.ColumnSpan="2" Spacing="12">
                            <TextBox x:Name="AzureConnectionString" Header="Connection String"
                                     PlaceholderText="DefaultEndpointsProtocol=https;AccountName=..."
                                     PasswordRevealMode="Peek" />
                            <Grid ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="AzureContainerName" Grid.Column="0"
                                         Header="Container Name" PlaceholderText="marketdata" />
                                <ComboBox x:Name="AzureStorageTier" Grid.Column="1"
                                          Header="Storage Tier" HorizontalAlignment="Stretch">
                                    <ComboBoxItem Content="Hot" Tag="Hot" IsSelected="True" />
                                    <ComboBoxItem Content="Cool" Tag="Cool" />
                                    <ComboBoxItem Content="Archive" Tag="Archive" />
                                </ComboBox>
                            </Grid>
                        </StackPanel>

                        <!-- AWS S3 Settings (hidden by default) -->
                        <StackPanel x:Name="S3Settings" Grid.Row="1" Grid.ColumnSpan="2" Spacing="12"
                                    Visibility="Collapsed">
                            <Grid ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="S3AccessKey" Grid.Column="0" Header="Access Key ID"
                                         PlaceholderText="AKIAIOSFODNN7EXAMPLE" />
                                <TextBox x:Name="S3SecretKey" Grid.Column="1" Header="Secret Access Key"
                                         PlaceholderText="wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
                                         PasswordRevealMode="Peek" />
                            </Grid>
                            <Grid ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="S3BucketName" Grid.Column="0"
                                         Header="Bucket Name" PlaceholderText="my-marketdata-bucket" />
                                <ComboBox x:Name="S3Region" Grid.Column="1"
                                          Header="Region" HorizontalAlignment="Stretch">
                                    <ComboBoxItem Content="us-east-1" IsSelected="True" />
                                    <ComboBoxItem Content="us-west-2" />
                                    <ComboBoxItem Content="eu-west-1" />
                                    <ComboBoxItem Content="ap-northeast-1" />
                                </ComboBox>
                            </Grid>
                        </StackPanel>

                        <!-- GCS Settings (hidden by default) -->
                        <StackPanel x:Name="GcsSettings" Grid.Row="1" Grid.ColumnSpan="2" Spacing="12"
                                    Visibility="Collapsed">
                            <TextBox x:Name="GcsServiceAccountKey" Header="Service Account JSON"
                                     PlaceholderText="Paste service account JSON or select file..."
                                     AcceptsReturn="True" TextWrapping="Wrap" Height="80" />
                            <Grid ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="GcsBucketName" Grid.Column="0"
                                         Header="Bucket Name" PlaceholderText="my-marketdata-bucket" />
                                <Button Grid.Column="1" Content="Browse Key File..." VerticalAlignment="Bottom"
                                        Click="BrowseGcsKey_Click" />
                            </Grid>
                        </StackPanel>

                        <!-- Sync Status -->
                        <Border Grid.Row="2" Grid.ColumnSpan="2"
                                Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                CornerRadius="8" Padding="16">
                            <Grid ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Spacing="4">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Ellipse x:Name="CloudStatusIndicator" Width="10" Height="10" Fill="#48BB78" />
                                        <TextBlock x:Name="CloudStatusText" Text="Connected - Last sync: 5 min ago" />
                                    </StackPanel>
                                    <TextBlock x:Name="CloudSyncDetails"
                                               Text="Synced: 1,234 files (10.2 GB) | Pending: 12 files"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                                    <Button Content="Test Connection" Click="TestCloudConnection_Click" />
                                    <Button Content="Sync Now" Style="{StaticResource AccentButtonStyle}"
                                            Click="SyncCloud_Click" />
                                    <ProgressRing x:Name="CloudSyncProgress" IsActive="False" Width="20" Height="20" />
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Storage Profile Selection -->
            <Border Style="{StaticResource CardStyle}" BorderBrush="{ThemeResource SystemAccentColor}" BorderThickness="2">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE771;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Storage Profile" Style="{StaticResource SubtitleTextBlockStyle}" />
                        <Border Background="{ThemeResource SystemAccentColorLight3}" CornerRadius="4" Padding="8,2">
                            <TextBlock Text="Recommended" FontSize="10" Foreground="{ThemeResource SystemAccentColorDark1}" />
                        </Border>
                    </StackPanel>

                    <TextBlock Text="Start with a profile to simplify configuration. Profiles pre-configure compression, partitioning, and retention settings for common use cases."
                               TextWrapping="Wrap" Foreground="{ThemeResource SystemBaseMediumColor}" />

                    <ComboBox x:Name="StorageProfileCombo"
                              Header="Select a Profile"
                              HorizontalAlignment="Stretch"
                              SelectionChanged="StorageProfile_Changed">
                        <ComboBoxItem Tag="" Content="Custom (No Profile)" />
                        <ComboBoxItem Tag="Research" IsSelected="True">
                            <ComboBoxItem.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <TextBlock Text="Research (Recommended)" FontWeight="SemiBold" />
                                        <TextBlock Text="Balanced defaults for analysis - Gzip compression, daily partitions, manifests enabled"
                                                   Style="{StaticResource CaptionTextBlockStyle}" TextWrapping="Wrap"
                                                   Foreground="{ThemeResource SystemBaseMediumColor}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBoxItem.ContentTemplate>
                        </ComboBoxItem>
                        <ComboBoxItem Tag="LowLatency">
                            <ComboBoxItem.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <TextBlock Text="Low Latency" FontWeight="SemiBold" />
                                        <TextBlock Text="Fast ingest - No compression, hourly partitions, minimal overhead"
                                                   Style="{StaticResource CaptionTextBlockStyle}" TextWrapping="Wrap"
                                                   Foreground="{ThemeResource SystemBaseMediumColor}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBoxItem.ContentTemplate>
                        </ComboBoxItem>
                        <ComboBoxItem Tag="Archival">
                            <ComboBoxItem.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <TextBlock Text="Archival" FontWeight="SemiBold" />
                                        <TextBlock Text="Long-term storage - Zstd compression, tiering enabled, 10-year retention"
                                                   Style="{StaticResource CaptionTextBlockStyle}" TextWrapping="Wrap"
                                                   Foreground="{ThemeResource SystemBaseMediumColor}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBoxItem.ContentTemplate>
                        </ComboBoxItem>
                    </ComboBox>

                    <InfoBar x:Name="ProfileInfoBar" IsOpen="False" IsClosable="True" Severity="Informational" />
                </StackPanel>
            </Border>

            <!-- Data Root -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <TextBlock Text="Data Location" Style="{StaticResource SubtitleTextBlockStyle}" />

                    <Grid ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBox x:Name="DataRootBox"
                                 Grid.Column="0"
                                 Header="Data Root Path"
                                 PlaceholderText="data"
                                 TextChanged="UpdatePreview" />

                        <Button Grid.Column="1" Content="Browse..." VerticalAlignment="Bottom"
                                Click="BrowseFolder_Click" />
                    </Grid>

                    <ToggleSwitch x:Name="CompressToggle"
                                  Header="Enable Compression"
                                  OffContent="Disabled"
                                  OnContent="Enabled (gzip)"
                                  Toggled="UpdatePreview" />
                </StackPanel>
            </Border>

            <!-- File Organization -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <TextBlock Text="File Organization" Style="{StaticResource SubtitleTextBlockStyle}" />

                    <Grid ColumnSpacing="16" RowSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <ComboBox x:Name="NamingConventionCombo"
                                  Grid.Row="0" Grid.Column="0"
                                  Header="Naming Convention"
                                  HorizontalAlignment="Stretch"
                                  SelectionChanged="UpdatePreview">
                            <ComboBoxItem Content="Flat" Tag="Flat" />
                            <ComboBoxItem Content="By Symbol (recommended)" Tag="BySymbol" IsSelected="True" />
                            <ComboBoxItem Content="By Date" Tag="ByDate" />
                            <ComboBoxItem Content="By Type" Tag="ByType" />
                        </ComboBox>

                        <ComboBox x:Name="DatePartitionCombo"
                                  Grid.Row="0" Grid.Column="1"
                                  Header="Date Partitioning"
                                  HorizontalAlignment="Stretch"
                                  SelectionChanged="UpdatePreview">
                            <ComboBoxItem Content="None (single file)" Tag="None" />
                            <ComboBoxItem Content="Daily (recommended)" Tag="Daily" IsSelected="True" />
                            <ComboBoxItem Content="Hourly" Tag="Hourly" />
                            <ComboBoxItem Content="Monthly" Tag="Monthly" />
                        </ComboBox>

                        <TextBox x:Name="FilePrefixBox"
                                 Grid.Row="1" Grid.Column="0"
                                 Header="File Prefix (optional)"
                                 PlaceholderText="e.g., market_"
                                 TextChanged="UpdatePreview" />

                        <ToggleSwitch x:Name="IncludeProviderToggle"
                                      Grid.Row="1" Grid.Column="1"
                                      Header="Include Provider in Path"
                                      OffContent="No"
                                      OnContent="Yes"
                                      Toggled="UpdatePreview" />
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Path Preview -->
            <Border Style="{StaticResource CardStyle}"
                    Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}">
                <StackPanel Spacing="8">
                    <TextBlock Text="Example File Path" Style="{StaticResource CaptionTextBlockStyle}" />
                    <TextBlock x:Name="PathPreviewText"
                               Text="data/AAPL/Trade/2024-01-15.jsonl"
                               FontFamily="Consolas"
                               FontSize="14"
                               IsTextSelectionEnabled="True"
                               Foreground="{ThemeResource SystemAccentColor}" />
                </StackPanel>
            </Border>

            <!-- Naming Convention Info -->
            <Border Style="{StaticResource CardStyle}">
                <Expander Header="Naming Convention Details" HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch">
                    <Grid ColumnSpacing="24" RowSpacing="12" Padding="0,12,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Flat:" FontWeight="SemiBold" />
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{root}/{symbol}_{type}_{date}.jsonl"
                                   FontFamily="Consolas" TextWrapping="Wrap" />

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="By Symbol:" FontWeight="SemiBold" />
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{root}/{symbol}/{type}/{date}.jsonl"
                                   FontFamily="Consolas" TextWrapping="Wrap" />

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="By Date:" FontWeight="SemiBold" />
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{root}/{date}/{symbol}/{type}.jsonl"
                                   FontFamily="Consolas" TextWrapping="Wrap" />

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="By Type:" FontWeight="SemiBold" />
                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{root}/{type}/{symbol}/{date}.jsonl"
                                   FontFamily="Consolas" TextWrapping="Wrap" />
                    </Grid>
                </Expander>
            </Border>

            <!-- Save Button -->
            <StackPanel Orientation="Horizontal" Spacing="12">
                <Button Content="Save Storage Settings"
                        Style="{StaticResource AccentButtonStyle}"
                        Click="SaveSettings_Click" />
                <ProgressRing x:Name="SaveProgress" IsActive="False" Width="20" Height="20" />
            </StackPanel>

            <InfoBar x:Name="SaveInfoBar" IsOpen="False" IsClosable="True" />
        </StackPanel>
    </ScrollViewer>
</Page>
