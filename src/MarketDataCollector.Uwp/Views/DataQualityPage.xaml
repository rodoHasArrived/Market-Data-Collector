<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MarketDataCollector.Uwp.Views.DataQualityPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MarketDataCollector.Uwp.Views"
    xmlns:vm="using:MarketDataCollector.Uwp.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24">
        <StackPanel Spacing="24">
            <!-- Header -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                    <FontIcon Glyph="&#xE9F5;" FontSize="28" Foreground="{ThemeResource SystemAccentColor}" />
                    <StackPanel>
                        <TextBlock Text="Data Quality Monitor" Style="{StaticResource TitleTextBlockStyle}" />
                        <TextBlock Text="Monitor data quality scores, alerts, and trends across all collected data"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource SystemBaseMediumColor}" />
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button x:Name="RefreshButton" Click="Refresh_Click" Style="{StaticResource IconButtonStyle}"
                            ToolTipService.ToolTip="Refresh data (F5)">
                        <FontIcon Glyph="&#xE72C;" FontSize="16" />
                        <Button.KeyboardAccelerators>
                            <KeyboardAccelerator Key="F5" />
                        </Button.KeyboardAccelerators>
                    </Button>
                    <Button x:Name="RunCheckButton" Click="RunQualityCheck_Click" Style="{StaticResource PrimaryButtonStyle}">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <FontIcon Glyph="&#xE9D9;" FontSize="14" />
                            <TextBlock Text="Run Quality Check" />
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- Overall Quality Score Card -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Overall Score -->
                <Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,8,0">
                    <StackPanel Spacing="8" HorizontalAlignment="Center">
                        <TextBlock Text="Overall Quality" Style="{StaticResource SubtitleTextBlockStyle}"
                                   HorizontalAlignment="Center" />
                        <Grid Width="100" Height="100">
                            <Ellipse Stroke="{ThemeResource SystemBaseMediumLowColor}" StrokeThickness="8" />
                            <Ellipse x:Name="ScoreRing" Stroke="{StaticResource SuccessColorBrush}" StrokeThickness="8"
                                     StrokeDashArray="100,100" StrokeDashOffset="25" />
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <TextBlock x:Name="OverallScoreText" Text="98.5" FontSize="28" FontWeight="Bold"
                                           HorizontalAlignment="Center" Foreground="{StaticResource SuccessColorBrush}" />
                                <TextBlock x:Name="OverallGradeText" Text="A+" FontSize="16" FontWeight="SemiBold"
                                           HorizontalAlignment="Center" Opacity="0.7" />
                            </StackPanel>
                        </Grid>
                        <Border x:Name="StatusBadge" Background="{StaticResource SuccessColorBrush}"
                                CornerRadius="12" Padding="12,4" HorizontalAlignment="Center">
                            <TextBlock x:Name="StatusText" Text="Excellent" FontSize="12" Foreground="White" FontWeight="SemiBold" />
                        </Border>
                    </StackPanel>
                </Border>

                <!-- File Health -->
                <Border Grid.Column="1" Style="{StaticResource CardStyle}" Margin="8,0">
                    <StackPanel Spacing="16">
                        <TextBlock Text="File Health" Style="{StaticResource SubtitleTextBlockStyle}" />
                        <Grid RowSpacing="12">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="12">
                                <Border Background="#1A48BB78" CornerRadius="4" Padding="8">
                                    <FontIcon Glyph="&#xE73E;" FontSize="16" Foreground="{StaticResource SuccessColorBrush}" />
                                </Border>
                                <StackPanel>
                                    <TextBlock x:Name="HealthyFilesText" Text="1,234" FontWeight="Bold" FontSize="18" />
                                    <TextBlock Text="Healthy Files" Style="{StaticResource CaptionTextBlockStyle}" />
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="12">
                                <Border Background="#1AECC94B" CornerRadius="4" Padding="8">
                                    <FontIcon Glyph="&#xE7BA;" FontSize="16" Foreground="{StaticResource WarningColorBrush}" />
                                </Border>
                                <StackPanel>
                                    <TextBlock x:Name="WarningFilesText" Text="12" FontWeight="Bold" FontSize="18" />
                                    <TextBlock Text="Warning" Style="{StaticResource CaptionTextBlockStyle}" />
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="12">
                                <Border Background="#1AF56565" CornerRadius="4" Padding="8">
                                    <FontIcon Glyph="&#xE783;" FontSize="16" Foreground="{StaticResource ErrorColorBrush}" />
                                </Border>
                                <StackPanel>
                                    <TextBlock x:Name="CriticalFilesText" Text="0" FontWeight="Bold" FontSize="18" />
                                    <TextBlock Text="Critical" Style="{StaticResource CaptionTextBlockStyle}" />
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Active Alerts -->
                <Border Grid.Column="2" Style="{StaticResource CardStyle}" Margin="8,0">
                    <StackPanel Spacing="16">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="Active Alerts" Style="{StaticResource SubtitleTextBlockStyle}" />
                            <Border x:Name="AlertCountBadge" Background="{StaticResource ErrorColorBrush}"
                                    CornerRadius="10" Padding="8,2" Visibility="Collapsed">
                                <TextBlock x:Name="AlertCountText" Text="3" FontSize="11" Foreground="White" FontWeight="SemiBold" />
                            </Border>
                        </StackPanel>

                        <StackPanel Spacing="8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Unacknowledged" VerticalAlignment="Center" />
                                <TextBlock x:Name="UnacknowledgedText" Grid.Column="1" Text="2"
                                           FontWeight="Bold" FontSize="18" Foreground="{StaticResource ErrorColorBrush}" />
                            </Grid>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Total Active" VerticalAlignment="Center" />
                                <TextBlock x:Name="TotalActiveAlertsText" Grid.Column="1" Text="5"
                                           FontWeight="Bold" FontSize="18" />
                            </Grid>
                        </StackPanel>

                        <Button Content="View All Alerts" Click="ViewAlerts_Click" HorizontalAlignment="Stretch" />
                    </StackPanel>
                </Border>

                <!-- Last Check -->
                <Border Grid.Column="3" Style="{StaticResource CardStyle}" Margin="8,0,0,0">
                    <StackPanel Spacing="16">
                        <TextBlock Text="Last Analysis" Style="{StaticResource SubtitleTextBlockStyle}" />

                        <StackPanel Spacing="8">
                            <TextBlock x:Name="LastCheckTimeText" Text="2 minutes ago"
                                       FontWeight="Bold" FontSize="18" />
                            <TextBlock Text="Last quality check completed"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource SystemBaseMediumColor}" />
                        </StackPanel>

                        <StackPanel Spacing="4">
                            <TextBlock Text="Next scheduled check:" Style="{StaticResource CaptionTextBlockStyle}" />
                            <TextBlock x:Name="NextCheckText" Text="In 28 minutes" FontWeight="SemiBold" />
                        </StackPanel>

                        <ProgressBar x:Name="CheckProgress" IsIndeterminate="False" Value="0" Maximum="100" />
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Trend Chart Section -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE9D9;" Foreground="{ThemeResource SystemAccentColor}" />
                            <TextBlock Text="Quality Trend" Style="{StaticResource SubtitleTextBlockStyle}" />
                            <Border x:Name="TrendBadge" Background="#1A48BB78" CornerRadius="4" Padding="8,4">
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <FontIcon x:Name="TrendIcon" Glyph="&#xE70E;" FontSize="12"
                                              Foreground="{StaticResource SuccessColorBrush}" />
                                    <TextBlock x:Name="TrendText" Text="+2.3% this week" FontSize="12"
                                               Foreground="{StaticResource SuccessColorBrush}" FontWeight="SemiBold" />
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <ComboBox x:Name="TimeWindowCombo" Grid.Column="1" SelectedIndex="1"
                                  SelectionChanged="TimeWindow_Changed" MinWidth="100">
                            <ComboBoxItem Content="1 Day" Tag="1d" />
                            <ComboBoxItem Content="7 Days" Tag="7d" />
                            <ComboBoxItem Content="30 Days" Tag="30d" />
                            <ComboBoxItem Content="90 Days" Tag="90d" />
                        </ComboBox>
                    </Grid>

                    <!-- Chart Area -->
                    <Border Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                            CornerRadius="4" Padding="16">
                        <Grid Height="200">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- Y-axis labels -->
                            <StackPanel Grid.Row="0" VerticalAlignment="Stretch" Width="40" HorizontalAlignment="Left">
                                <TextBlock Text="100%" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                <TextBlock Text="75%" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource SystemBaseMediumColor}" Margin="0,40,0,0" />
                                <TextBlock Text="50%" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource SystemBaseMediumColor}" Margin="0,40,0,0" />
                                <TextBlock Text="25%" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource SystemBaseMediumColor}" Margin="0,40,0,0" />
                            </StackPanel>

                            <!-- Chart Canvas -->
                            <Canvas x:Name="TrendChart" Grid.Row="0" Margin="50,0,0,0">
                                <Polyline x:Name="TrendChartLine" Stroke="{ThemeResource SystemAccentColor}"
                                          StrokeThickness="2" />
                                <Polygon x:Name="TrendChartFill" Fill="{ThemeResource SystemAccentColor}"
                                         Opacity="0.2" />
                            </Canvas>

                            <!-- X-axis labels -->
                            <StackPanel x:Name="XAxisLabels" Grid.Row="1" Orientation="Horizontal" Margin="50,8,0,0"
                                        HorizontalAlignment="Stretch">
                                <!-- Populated dynamically -->
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Trend Stats -->
                    <Grid ColumnSpacing="24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Average Score" Style="{StaticResource CaptionTextBlockStyle}" />
                            <TextBlock x:Name="AvgScoreText" Text="97.2%" FontWeight="SemiBold"
                                       Foreground="{StaticResource SuccessColorBrush}" />
                        </StackPanel>
                        <StackPanel Grid.Column="1">
                            <TextBlock Text="Min Score" Style="{StaticResource CaptionTextBlockStyle}" />
                            <TextBlock x:Name="MinScoreText" Text="92.1%" FontWeight="SemiBold" />
                        </StackPanel>
                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Max Score" Style="{StaticResource CaptionTextBlockStyle}" />
                            <TextBlock x:Name="MaxScoreText" Text="99.8%" FontWeight="SemiBold" />
                        </StackPanel>
                        <StackPanel Grid.Column="3">
                            <TextBlock Text="Std Deviation" Style="{StaticResource CaptionTextBlockStyle}" />
                            <TextBlock x:Name="StdDevText" Text="1.2%" FontWeight="SemiBold" />
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Two Column Layout: Symbol Quality & Alerts -->
            <Grid ColumnSpacing="24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="400" />
                </Grid.ColumnDefinitions>

                <!-- Symbol Quality List -->
                <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                    <StackPanel Spacing="16">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE9D9;" Foreground="{ThemeResource SystemAccentColor}" />
                                <TextBlock Text="Quality by Symbol" Style="{StaticResource SubtitleTextBlockStyle}" />
                            </StackPanel>

                            <AutoSuggestBox x:Name="SymbolFilterBox" Grid.Column="1" PlaceholderText="Filter symbols..."
                                            Width="200" QueryIcon="Find" TextChanged="SymbolFilter_TextChanged" />
                        </Grid>

                        <!-- Header -->
                        <Grid Padding="12,8" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80" />
                                <ColumnDefinition Width="80" />
                                <ColumnDefinition Width="60" />
                                <ColumnDefinition Width="80" />
                                <ColumnDefinition Width="80" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Symbol" FontWeight="SemiBold" />
                            <TextBlock Grid.Column="1" Text="Score" FontWeight="SemiBold" />
                            <TextBlock Grid.Column="2" Text="Grade" FontWeight="SemiBold" />
                            <TextBlock Grid.Column="3" Text="Events" FontWeight="SemiBold" />
                            <TextBlock Grid.Column="4" Text="Gaps" FontWeight="SemiBold" />
                            <TextBlock Grid.Column="5" Text="Last Update" FontWeight="SemiBold" />
                        </Grid>

                        <ListView x:Name="SymbolQualityList" MaxHeight="350" SelectionMode="Single"
                                  SelectionChanged="SymbolQuality_SelectionChanged">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="60" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="{Binding Symbol}" FontWeight="SemiBold"
                                                   VerticalAlignment="Center" />
                                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                                            <Ellipse Width="8" Height="8">
                                                <Ellipse.Fill>
                                                    <SolidColorBrush Color="{Binding StatusColor}" />
                                                </Ellipse.Fill>
                                            </Ellipse>
                                            <TextBlock Text="{Binding ScoreFormatted}" />
                                        </StackPanel>
                                        <Border Grid.Column="2" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                                CornerRadius="4" Padding="8,2" HorizontalAlignment="Left" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Grade}" FontWeight="SemiBold" />
                                        </Border>
                                        <TextBlock Grid.Column="3" Text="{Binding EventCount}" VerticalAlignment="Center" />
                                        <TextBlock Grid.Column="4" Text="{Binding GapCount}" VerticalAlignment="Center"
                                                   Foreground="{StaticResource WarningColorBrush}" />
                                        <TextBlock Grid.Column="5" Text="{Binding LastUpdateFormatted}"
                                                   Foreground="{ThemeResource SystemBaseMediumColor}" VerticalAlignment="Center" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>
                </Border>

                <!-- Alerts Panel -->
                <Border Grid.Column="1" Style="{StaticResource CardStyle}">
                    <StackPanel Spacing="16">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE7BA;" Foreground="{StaticResource WarningColorBrush}" />
                                <TextBlock Text="Quality Alerts" Style="{StaticResource SubtitleTextBlockStyle}" />
                            </StackPanel>

                            <ComboBox x:Name="SeverityFilterCombo" Grid.Column="1" SelectedIndex="0"
                                      SelectionChanged="SeverityFilter_Changed" MinWidth="100">
                                <ComboBoxItem Content="All" Tag="All" />
                                <ComboBoxItem Content="Critical" Tag="Critical" />
                                <ComboBoxItem Content="Warning" Tag="Warning" />
                                <ComboBoxItem Content="Info" Tag="Info" />
                            </ComboBox>
                        </Grid>

                        <ListView x:Name="AlertsList" MaxHeight="400" SelectionMode="None">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="8,12" ColumnSpacing="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <!-- Severity indicator -->
                                        <Border Grid.Column="0" Width="4" CornerRadius="2" VerticalAlignment="Stretch">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Setters>
                                                        <Setter Property="Background" Value="{StaticResource WarningColorBrush}" />
                                                    </Style.Setters>
                                                </Style>
                                            </Border.Style>
                                        </Border>

                                        <!-- Alert content -->
                                        <StackPanel Grid.Column="1" Spacing="4">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="{Binding Symbol}" FontWeight="SemiBold" />
                                                <Border Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                                        CornerRadius="4" Padding="6,2">
                                                    <TextBlock Text="{Binding AlertType}" FontSize="11" />
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="{Binding Message}" TextWrapping="Wrap"
                                                       Foreground="{ThemeResource SystemBaseMediumColor}" />
                                        </StackPanel>

                                        <!-- Actions -->
                                        <StackPanel Grid.Column="2" Spacing="4" VerticalAlignment="Center">
                                            <Button Click="AcknowledgeAlert_Click" Tag="{Binding Id}"
                                                    Padding="8,4" ToolTipService.ToolTip="Acknowledge alert">
                                                <FontIcon Glyph="&#xE73E;" FontSize="12" />
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <TextBlock x:Name="NoAlertsText" Text="No alerts to display"
                                   Foreground="{ThemeResource SystemBaseMediumColor}"
                                   FontStyle="Italic" HorizontalAlignment="Center" Visibility="Collapsed" />

                        <Button Content="Acknowledge All" Click="AcknowledgeAll_Click"
                                HorizontalAlignment="Stretch" />
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Anomaly Detection Section -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE783;" Foreground="{StaticResource ErrorColorBrush}" />
                            <TextBlock Text="Anomaly Detection" Style="{StaticResource SubtitleTextBlockStyle}" />
                            <Border x:Name="AnomalyCountBadge" Background="{StaticResource ErrorColorBrush}"
                                    CornerRadius="10" Padding="8,2" Visibility="Collapsed">
                                <TextBlock x:Name="AnomalyCountText" Text="0" FontSize="11" Foreground="White" FontWeight="SemiBold" />
                            </Border>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                            <ComboBox x:Name="AnomalyTypeCombo" SelectedIndex="0" MinWidth="150"
                                      SelectionChanged="AnomalyType_Changed">
                                <ComboBoxItem Content="All Types" Tag="All" />
                                <ComboBoxItem Content="Crossed Spread" Tag="CrossedSpread" />
                                <ComboBoxItem Content="Stale Data" Tag="StaleData" />
                                <ComboBoxItem Content="Future Timestamp" Tag="FutureTimestamp" />
                                <ComboBoxItem Content="Negative Price" Tag="NegativePrice" />
                                <ComboBoxItem Content="Sequence Gap" Tag="SequenceGap" />
                            </ComboBox>
                        </StackPanel>
                    </Grid>

                    <!-- Anomaly summary cards -->
                    <Grid ColumnSpacing="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                CornerRadius="4" Padding="12">
                            <StackPanel Spacing="4" HorizontalAlignment="Center">
                                <TextBlock x:Name="CrossedSpreadCount" Text="0" FontSize="20" FontWeight="Bold"
                                           HorizontalAlignment="Center" />
                                <TextBlock Text="Crossed Spreads" Style="{StaticResource CaptionTextBlockStyle}"
                                           HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="1" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                CornerRadius="4" Padding="12">
                            <StackPanel Spacing="4" HorizontalAlignment="Center">
                                <TextBlock x:Name="StaleDataCount" Text="0" FontSize="20" FontWeight="Bold"
                                           HorizontalAlignment="Center" />
                                <TextBlock Text="Stale Data" Style="{StaticResource CaptionTextBlockStyle}"
                                           HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="2" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                CornerRadius="4" Padding="12">
                            <StackPanel Spacing="4" HorizontalAlignment="Center">
                                <TextBlock x:Name="FutureTimestampCount" Text="0" FontSize="20" FontWeight="Bold"
                                           HorizontalAlignment="Center" />
                                <TextBlock Text="Future Timestamps" Style="{StaticResource CaptionTextBlockStyle}"
                                           HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="3" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                CornerRadius="4" Padding="12">
                            <StackPanel Spacing="4" HorizontalAlignment="Center">
                                <TextBlock x:Name="NegativePriceCount" Text="0" FontSize="20" FontWeight="Bold"
                                           HorizontalAlignment="Center" />
                                <TextBlock Text="Negative Prices" Style="{StaticResource CaptionTextBlockStyle}"
                                           HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="4" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                CornerRadius="4" Padding="12">
                            <StackPanel Spacing="4" HorizontalAlignment="Center">
                                <TextBlock x:Name="SequenceGapCount" Text="0" FontSize="20" FontWeight="Bold"
                                           HorizontalAlignment="Center" />
                                <TextBlock Text="Sequence Gaps" Style="{StaticResource CaptionTextBlockStyle}"
                                           HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Anomaly list -->
                    <ListView x:Name="AnomaliesList" MaxHeight="250" SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="8,10" ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="100" />
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0" Width="4" CornerRadius="2" VerticalAlignment="Stretch"
                                            Background="{StaticResource ErrorColorBrush}" />
                                    <TextBlock Grid.Column="1" Text="{Binding Symbol}" FontWeight="SemiBold"
                                               VerticalAlignment="Center" />
                                    <Border Grid.Column="2" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                            CornerRadius="4" Padding="8,4" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Type}" FontSize="11" />
                                    </Border>
                                    <TextBlock Grid.Column="3" Text="{Binding Description}" TextTrimming="CharacterEllipsis"
                                               VerticalAlignment="Center" Foreground="{ThemeResource SystemBaseMediumColor}" />
                                    <TextBlock Grid.Column="4" Text="{Binding DetectedAt}" FontSize="11"
                                               Foreground="{ThemeResource SystemBaseMediumColor}" VerticalAlignment="Center" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <TextBlock x:Name="NoAnomaliesText" Text="No anomalies detected"
                               Foreground="{ThemeResource SystemBaseMediumColor}"
                               FontStyle="Italic" HorizontalAlignment="Center" Visibility="Collapsed" />
                </StackPanel>
            </Border>

            <!-- Loading Overlay -->
            <ProgressRing x:Name="LoadingRing" IsActive="False" Width="48" Height="48"
                          HorizontalAlignment="Center" Visibility="Collapsed" />

            <InfoBar x:Name="PageInfoBar" IsOpen="False" IsClosable="True" />
        </StackPanel>
    </ScrollViewer>
</Page>
