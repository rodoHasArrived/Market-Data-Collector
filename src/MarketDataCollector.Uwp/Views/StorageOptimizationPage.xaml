<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MarketDataCollector.Uwp.Views.StorageOptimizationPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MarketDataCollector.Uwp.Views"
    xmlns:services="using:MarketDataCollector.Uwp.Services"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="24" Padding="0,0,24,24">
            <!-- Page Header -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel>
                    <TextBlock Text="Storage Optimization Advisor" Style="{StaticResource TitleTextBlockStyle}" />
                    <TextBlock Text="Analyze storage and get optimization recommendations for your data archive"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button x:Name="AnalyzeButton" Content="Analyze Storage" Style="{StaticResource AccentButtonStyle}"
                            Click="AnalyzeStorage_Click" />
                    <Button x:Name="CancelButton" Content="Cancel" Click="CancelAnalysis_Click"
                            Visibility="Collapsed" />
                </StackPanel>
            </Grid>

            <!-- Analysis Progress -->
            <Border x:Name="ProgressSection" Style="{StaticResource CardStyle}" Visibility="Collapsed">
                <StackPanel Spacing="12">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <ProgressRing x:Name="AnalysisProgressRing" IsActive="True" Width="20" Height="20" />
                        <TextBlock x:Name="AnalysisStatusText" Text="Analyzing storage..."
                                   VerticalAlignment="Center" />
                    </StackPanel>
                    <ProgressBar x:Name="AnalysisProgressBar" Value="0" Maximum="100" />
                </StackPanel>
            </Border>

            <!-- Analysis Configuration -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE713;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Analysis Options" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <Grid ColumnSpacing="24" RowSpacing="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <CheckBox x:Name="FindDuplicatesCheck" Grid.Row="0" Grid.Column="0"
                                  Content="Find duplicate files" IsChecked="True" />
                        <CheckBox x:Name="AnalyzeCompressionCheck" Grid.Row="0" Grid.Column="1"
                                  Content="Analyze compression opportunities" IsChecked="True" />

                        <CheckBox x:Name="FindSmallFilesCheck" Grid.Row="1" Grid.Column="0"
                                  Content="Find small files to merge" IsChecked="True" />
                        <CheckBox x:Name="AnalyzeTieringCheck" Grid.Row="1" Grid.Column="1"
                                  Content="Analyze tiering opportunities" IsChecked="True" />

                        <CheckBox x:Name="CalculateHashesCheck" Grid.Row="2" Grid.Column="0"
                                  Content="Calculate file hashes (slower, more accurate)"
                                  IsChecked="True" />
                        <NumberBox x:Name="ColdTierAgeDays" Grid.Row="2" Grid.Column="1"
                                   Header="Cold tier threshold (days)"
                                   Value="90" Minimum="30" Maximum="365"
                                   SpinButtonPlacementMode="Inline" />
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Results Summary -->
            <Border x:Name="ResultsSummarySection" Style="{StaticResource CardStyle}" Visibility="Collapsed">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE9F5;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Analysis Results" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <!-- Summary Cards -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Style="{StaticResource CardStyle}"
                                Background="{ThemeResource SystemFillColorSolidNeutralBackgroundBrush}" Margin="0,0,4,0">
                            <StackPanel Spacing="4" HorizontalAlignment="Center">
                                <TextBlock x:Name="CurrentUsageText" Text="0 GB"
                                           Style="{StaticResource SubheaderTextBlockStyle}"
                                           HorizontalAlignment="Center" />
                                <TextBlock Text="Current Usage" Style="{StaticResource CaptionTextBlockStyle}"
                                           HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="1" Style="{StaticResource CardStyle}"
                                Background="{ThemeResource SystemFillColorSolidNeutralBackgroundBrush}" Margin="4,0">
                            <StackPanel Spacing="4" HorizontalAlignment="Center">
                                <TextBlock x:Name="PotentialSavingsText" Text="0 GB"
                                           Style="{StaticResource SubheaderTextBlockStyle}"
                                           Foreground="#48BB78" HorizontalAlignment="Center" />
                                <TextBlock Text="Potential Savings" Style="{StaticResource CaptionTextBlockStyle}"
                                           HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="2" Style="{StaticResource CardStyle}"
                                Background="{ThemeResource SystemFillColorSolidNeutralBackgroundBrush}" Margin="4,0,0,0">
                            <StackPanel Spacing="4" HorizontalAlignment="Center">
                                <TextBlock x:Name="ProjectedUsageText" Text="0 GB"
                                           Style="{StaticResource SubheaderTextBlockStyle}"
                                           Foreground="{ThemeResource SystemAccentColor}" HorizontalAlignment="Center" />
                                <TextBlock Text="Projected After" Style="{StaticResource CaptionTextBlockStyle}"
                                           HorizontalAlignment="Center" />
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Additional Stats -->
                    <Grid ColumnSpacing="24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Spacing="4">
                            <TextBlock x:Name="TotalFilesText" Text="0" FontWeight="SemiBold" FontSize="18" />
                            <TextBlock Text="Total Files" Style="{StaticResource CaptionTextBlockStyle}" />
                        </StackPanel>

                        <StackPanel Grid.Column="1" Spacing="4">
                            <TextBlock x:Name="DuplicatesFoundText" Text="0" FontWeight="SemiBold" FontSize="18"
                                       Foreground="#ED8936" />
                            <TextBlock Text="Duplicates Found" Style="{StaticResource CaptionTextBlockStyle}" />
                        </StackPanel>

                        <StackPanel Grid.Column="2" Spacing="4">
                            <TextBlock x:Name="UncompressedFilesText" Text="0" FontWeight="SemiBold" FontSize="18"
                                       Foreground="#4299E1" />
                            <TextBlock Text="Uncompressed" Style="{StaticResource CaptionTextBlockStyle}" />
                        </StackPanel>

                        <StackPanel Grid.Column="3" Spacing="4">
                            <TextBlock x:Name="SmallFilesText" Text="0" FontWeight="SemiBold" FontSize="18" />
                            <TextBlock Text="Small Files" Style="{StaticResource CaptionTextBlockStyle}" />
                        </StackPanel>
                    </Grid>

                    <TextBlock x:Name="EstimatedTimeText" Text="Estimated time to complete: --"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                </StackPanel>
            </Border>

            <!-- Recommendations List -->
            <Border x:Name="RecommendationsSection" Style="{StaticResource CardStyle}" Visibility="Collapsed">
                <StackPanel Spacing="16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE7C1;" Foreground="{ThemeResource SystemAccentColor}" />
                            <TextBlock Text="Optimization Recommendations" Style="{StaticResource SubtitleTextBlockStyle}" />
                            <TextBlock x:Name="RecommendationCountText" Text="(0)"
                                       Foreground="{ThemeResource SystemBaseMediumColor}"
                                       VerticalAlignment="Center" />
                        </StackPanel>

                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                            <Button Content="Execute All" Click="ExecuteAll_Click" />
                            <Button Content="Export Report" Click="ExportReport_Click" />
                        </StackPanel>
                    </Grid>

                    <ListView x:Name="RecommendationsList" SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="services:OptimizationRecommendation">
                                <Border CornerRadius="4" Padding="16" Margin="0,4"
                                        Background="{ThemeResource SystemFillColorSolidNeutralBackgroundBrush}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <!-- Priority Indicator -->
                                        <Border Grid.Column="0" Width="4" CornerRadius="2" Margin="0,0,12,0">
                                            <Border.Background>
                                                <SolidColorBrush Color="{Binding Priority, Converter={StaticResource PriorityToColor}}" />
                                            </Border.Background>
                                        </Border>

                                        <!-- Content -->
                                        <StackPanel Grid.Column="1" Spacing="4">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="{x:Bind Title}" FontWeight="SemiBold" />
                                                <Border CornerRadius="4" Padding="6,2"
                                                        Background="{ThemeResource SystemAccentColor}">
                                                    <TextBlock Text="{x:Bind Type}" FontSize="10" Foreground="White" />
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="{x:Bind Description}" TextWrapping="Wrap"
                                                       Foreground="{ThemeResource SystemBaseMediumColor}" />
                                            <StackPanel Orientation="Horizontal" Spacing="16">
                                                <TextBlock Style="{StaticResource CaptionTextBlockStyle}">
                                                    <Run Text="Files:" />
                                                    <Run Text="{x:Bind AffectedFiles.Count}" />
                                                </TextBlock>
                                                <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                                           Visibility="{x:Bind EstimatedTime}">
                                                    <Run Text="Time:" />
                                                    <Run Text="{x:Bind EstimatedTime}" />
                                                </TextBlock>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Savings -->
                                        <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="16,0">
                                            <TextBlock Text="{x:Bind PotentialSavingsBytes, Converter={StaticResource BytesToString}}"
                                                       FontWeight="SemiBold" FontSize="16" Foreground="#48BB78"
                                                       HorizontalAlignment="Right" />
                                            <TextBlock Text="savings" Style="{StaticResource CaptionTextBlockStyle}"
                                                       HorizontalAlignment="Right" />
                                        </StackPanel>

                                        <!-- Execute Button -->
                                        <Button Grid.Column="3" Content="Execute" VerticalAlignment="Center"
                                                Click="ExecuteRecommendation_Click" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>
            </Border>

            <!-- File Breakdown -->
            <Border x:Name="FileBreakdownSection" Style="{StaticResource CardStyle}" Visibility="Collapsed">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8B7;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Storage Breakdown" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <Grid ColumnSpacing="24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- By Data Type -->
                        <StackPanel Grid.Column="0" Spacing="8">
                            <TextBlock Text="By Data Type" FontWeight="SemiBold" />
                            <ListView x:Name="ByDataTypeList" SelectionMode="None" MaxHeight="200">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Padding="4" ColumnSpacing="8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="80" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="80" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0" Text="{Binding DataType}" FontWeight="SemiBold" />
                                            <ProgressBar Grid.Column="1" Value="{Binding Percentage}" Maximum="100" />
                                            <TextBlock Grid.Column="2" Text="{Binding SizeFormatted}"
                                                       HorizontalAlignment="Right" />
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>

                        <!-- By Storage Tier -->
                        <StackPanel Grid.Column="1" Spacing="8">
                            <TextBlock Text="By Storage Tier" FontWeight="SemiBold" />
                            <ListView x:Name="ByTierList" SelectionMode="None" MaxHeight="200">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Padding="4" ColumnSpacing="8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="80" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="80" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0" Text="{Binding Tier}" FontWeight="SemiBold" />
                                            <ProgressBar Grid.Column="1" Value="{Binding Percentage}" Maximum="100" />
                                            <TextBlock Grid.Column="2" Text="{Binding SizeFormatted}"
                                                       HorizontalAlignment="Right" />
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Top Storage Consumers -->
            <Border x:Name="TopConsumersSection" Style="{StaticResource CardStyle}" Visibility="Collapsed">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE9D9;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Top Storage Consumers" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <ListView x:Name="TopConsumersList" SelectionMode="None" MaxHeight="300">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="8" ColumnSpacing="16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="32" />
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="100" />
                                        <ColumnDefinition Width="60" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="{Binding Rank}" FontWeight="SemiBold"
                                               Foreground="{ThemeResource SystemAccentColor}" />
                                    <TextBlock Grid.Column="1" Text="{Binding Symbol}" FontWeight="SemiBold" />
                                    <ProgressBar Grid.Column="2" Value="{Binding Percentage}" Maximum="100" />
                                    <TextBlock Grid.Column="3" Text="{Binding SizeFormatted}" HorizontalAlignment="Right" />
                                    <TextBlock Grid.Column="4" Text="{Binding FileCount}"
                                               Foreground="{ThemeResource SystemBaseMediumColor}"
                                               HorizontalAlignment="Right" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>
            </Border>

            <!-- One-Click Optimization -->
            <Border x:Name="QuickActionsSection" Style="{StaticResource CardStyle}" Visibility="Collapsed">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE768;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Quick Actions" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Button x:Name="RemoveAllDuplicatesButton" Content="Remove All Duplicates"
                                Click="RemoveAllDuplicates_Click" IsEnabled="False" />
                        <Button x:Name="CompressWarmTierButton" Content="Compress Warm Tier"
                                Click="CompressWarmTier_Click" IsEnabled="False" />
                        <Button x:Name="MergeSmalFilesButton" Content="Merge Small Files"
                                Click="MergeSmallFiles_Click" IsEnabled="False" />
                        <Button x:Name="MoveToClodButton" Content="Move Old Files to Cold"
                                Click="MoveToCold_Click" IsEnabled="False" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</Page>
