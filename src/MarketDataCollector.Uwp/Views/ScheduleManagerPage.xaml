<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MarketDataCollector.Uwp.Views.ScheduleManagerPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MarketDataCollector.Uwp.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                <FontIcon Glyph="&#xE787;" FontSize="28" Foreground="{ThemeResource SystemAccentColor}" />
                <StackPanel>
                    <TextBlock Text="Schedule Manager" Style="{StaticResource TitleTextBlockStyle}" />
                    <TextBlock Text="Manage scheduled backfills and maintenance tasks"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                </StackPanel>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                <Button Click="Refresh_Click" Style="{StaticResource IconButtonStyle}"
                        ToolTipService.ToolTip="Refresh schedules">
                    <FontIcon Glyph="&#xE72C;" FontSize="16" />
                </Button>
                <Button x:Name="CreateBackfillButton" Click="CreateBackfillSchedule_Click"
                        Style="{StaticResource PrimaryButtonStyle}">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <FontIcon Glyph="&#xE710;" FontSize="14" />
                        <TextBlock Text="New Backfill Schedule" />
                    </StackPanel>
                </Button>
                <Button x:Name="CreateMaintenanceButton" Click="CreateMaintenanceSchedule_Click">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <FontIcon Glyph="&#xE710;" FontSize="14" />
                        <TextBlock Text="New Maintenance" />
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Main Content -->
        <Pivot Grid.Row="1">
            <!-- Backfill Schedules Tab -->
            <PivotItem Header="Backfill Schedules">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Stats Summary -->
                    <Grid Grid.Row="0" Margin="0,0,0,16" ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel Spacing="4">
                                <TextBlock x:Name="TotalBackfillSchedulesText" Text="0" FontSize="24" FontWeight="Bold" />
                                <TextBlock Text="Total Schedules" Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="1" Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel Spacing="4">
                                <TextBlock x:Name="ActiveBackfillSchedulesText" Text="0" FontSize="24" FontWeight="Bold"
                                           Foreground="{StaticResource SuccessColorBrush}" />
                                <TextBlock Text="Active" Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="2" Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel Spacing="4">
                                <TextBlock x:Name="RunningBackfillText" Text="0" FontSize="24" FontWeight="Bold"
                                           Foreground="{StaticResource InfoColorBrush}" />
                                <TextBlock Text="Running Now" Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="3" Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel Spacing="4">
                                <TextBlock x:Name="NextBackfillRunText" Text="--" FontSize="18" FontWeight="Bold" />
                                <TextBlock Text="Next Run" Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Backfill List -->
                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!-- List Header -->
                            <Grid Grid.Row="0" Padding="12,8" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}" Margin="0,0,0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60" />
                                    <ColumnDefinition Width="180" />
                                    <ColumnDefinition Width="150" />
                                    <ColumnDefinition Width="100" />
                                    <ColumnDefinition Width="120" />
                                    <ColumnDefinition Width="100" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="Status" FontWeight="SemiBold" />
                                <TextBlock Grid.Column="1" Text="Name" FontWeight="SemiBold" />
                                <TextBlock Grid.Column="2" Text="Schedule" FontWeight="SemiBold" />
                                <TextBlock Grid.Column="3" Text="Provider" FontWeight="SemiBold" />
                                <TextBlock Grid.Column="4" Text="Next Run" FontWeight="SemiBold" />
                                <TextBlock Grid.Column="5" Text="Last Status" FontWeight="SemiBold" />
                                <TextBlock Grid.Column="6" Text="Actions" FontWeight="SemiBold" />
                            </Grid>

                            <ListView x:Name="BackfillSchedulesList" Grid.Row="1" SelectionMode="Single"
                                      SelectionChanged="BackfillSchedule_SelectionChanged"
                                      RightTapped="BackfillScheduleItem_RightTapped">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Padding="8" RightTapped="BackfillScheduleItem_RightTapped" Tag="{Binding Id}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="60" />
                                                <ColumnDefinition Width="180" />
                                                <ColumnDefinition Width="150" />
                                                <ColumnDefinition Width="100" />
                                                <ColumnDefinition Width="120" />
                                                <ColumnDefinition Width="100" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>

                                            <ToggleSwitch Grid.Column="0" IsOn="{Binding IsEnabled}"
                                                          Toggled="BackfillScheduleToggle_Toggled"
                                                          OnContent="" OffContent="" Margin="-8,0,0,0" />

                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" />
                                                <TextBlock Text="{Binding Description}" FontSize="11"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}"
                                                           TextTrimming="CharacterEllipsis" />
                                            </StackPanel>

                                            <StackPanel Grid.Column="2" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding CronDescription}" FontSize="12" />
                                                <TextBlock Text="{Binding CronExpression}" FontSize="10"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}"
                                                           FontFamily="Consolas" />
                                            </StackPanel>

                                            <TextBlock Grid.Column="3" Text="{Binding Provider}"
                                                       VerticalAlignment="Center" />

                                            <TextBlock Grid.Column="4" Text="{Binding NextRunAt}"
                                                       VerticalAlignment="Center"
                                                       Foreground="{ThemeResource SystemBaseMediumColor}" />

                                            <Border Grid.Column="5" CornerRadius="4" Padding="6,2"
                                                    HorizontalAlignment="Left" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding LastRunStatus}" FontSize="11" />
                                            </Border>

                                            <StackPanel Grid.Column="6" Orientation="Horizontal" Spacing="4"
                                                        VerticalAlignment="Center">
                                                <Button Click="RunBackfillNow_Click" Tag="{Binding Id}"
                                                        Padding="8,4" ToolTipService.ToolTip="Run now">
                                                    <FontIcon Glyph="&#xE768;" FontSize="12" />
                                                </Button>
                                                <Button Click="EditBackfillSchedule_Click" Tag="{Binding Id}"
                                                        Padding="8,4" ToolTipService.ToolTip="Edit">
                                                    <FontIcon Glyph="&#xE70F;" FontSize="12" />
                                                </Button>
                                                <Button Click="ViewBackfillHistory_Click" Tag="{Binding Id}"
                                                        Padding="8,4" ToolTipService.ToolTip="View history">
                                                    <FontIcon Glyph="&#xE81C;" FontSize="12" />
                                                </Button>
                                                <Button Click="DeleteBackfillSchedule_Click" Tag="{Binding Id}"
                                                        Padding="8,4" ToolTipService.ToolTip="Delete">
                                                    <FontIcon Glyph="&#xE74D;" FontSize="12" />
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>

                            <TextBlock x:Name="NoBackfillSchedulesText" Grid.Row="1"
                                       Text="No backfill schedules configured. Click 'New Backfill Schedule' to create one."
                                       Foreground="{ThemeResource SystemBaseMediumColor}"
                                       FontStyle="Italic" HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Visibility="Collapsed" />
                        </Grid>
                    </Border>
                </Grid>
            </PivotItem>

            <!-- Maintenance Schedules Tab -->
            <PivotItem Header="Maintenance Schedules">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Stats Summary -->
                    <Grid Grid.Row="0" Margin="0,0,0,16" ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel Spacing="4">
                                <TextBlock x:Name="TotalMaintenanceSchedulesText" Text="0" FontSize="24" FontWeight="Bold" />
                                <TextBlock Text="Total Schedules" Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="1" Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel Spacing="4">
                                <TextBlock x:Name="ActiveMaintenanceSchedulesText" Text="0" FontSize="24" FontWeight="Bold"
                                           Foreground="{StaticResource SuccessColorBrush}" />
                                <TextBlock Text="Active" Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="2" Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel Spacing="4">
                                <TextBlock x:Name="RunningMaintenanceText" Text="0" FontSize="24" FontWeight="Bold"
                                           Foreground="{StaticResource InfoColorBrush}" />
                                <TextBlock Text="Running Now" Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="3" Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel Spacing="4">
                                <TextBlock x:Name="NextMaintenanceRunText" Text="--" FontSize="18" FontWeight="Bold" />
                                <TextBlock Text="Next Run" Style="{StaticResource CaptionTextBlockStyle}" />
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Maintenance List -->
                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!-- List Header -->
                            <Grid Grid.Row="0" Padding="12,8" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}" Margin="0,0,0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60" />
                                    <ColumnDefinition Width="180" />
                                    <ColumnDefinition Width="120" />
                                    <ColumnDefinition Width="150" />
                                    <ColumnDefinition Width="120" />
                                    <ColumnDefinition Width="100" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="Status" FontWeight="SemiBold" />
                                <TextBlock Grid.Column="1" Text="Name" FontWeight="SemiBold" />
                                <TextBlock Grid.Column="2" Text="Type" FontWeight="SemiBold" />
                                <TextBlock Grid.Column="3" Text="Schedule" FontWeight="SemiBold" />
                                <TextBlock Grid.Column="4" Text="Next Run" FontWeight="SemiBold" />
                                <TextBlock Grid.Column="5" Text="Last Status" FontWeight="SemiBold" />
                                <TextBlock Grid.Column="6" Text="Actions" FontWeight="SemiBold" />
                            </Grid>

                            <ListView x:Name="MaintenanceSchedulesList" Grid.Row="1" SelectionMode="Single"
                                      SelectionChanged="MaintenanceSchedule_SelectionChanged"
                                      RightTapped="MaintenanceScheduleItem_RightTapped">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Padding="8" RightTapped="MaintenanceScheduleItem_RightTapped" Tag="{Binding Id}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="60" />
                                                <ColumnDefinition Width="180" />
                                                <ColumnDefinition Width="120" />
                                                <ColumnDefinition Width="150" />
                                                <ColumnDefinition Width="120" />
                                                <ColumnDefinition Width="100" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>

                                            <ToggleSwitch Grid.Column="0" IsOn="{Binding IsEnabled}"
                                                          Toggled="MaintenanceScheduleToggle_Toggled"
                                                          OnContent="" OffContent="" Margin="-8,0,0,0" />

                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" />
                                                <TextBlock Text="{Binding Description}" FontSize="11"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}"
                                                           TextTrimming="CharacterEllipsis" />
                                            </StackPanel>

                                            <Border Grid.Column="2" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                                    CornerRadius="4" Padding="8,4" VerticalAlignment="Center"
                                                    HorizontalAlignment="Left">
                                                <TextBlock Text="{Binding MaintenanceType}" FontSize="11" />
                                            </Border>

                                            <StackPanel Grid.Column="3" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding CronDescription}" FontSize="12" />
                                                <TextBlock Text="{Binding CronExpression}" FontSize="10"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}"
                                                           FontFamily="Consolas" />
                                            </StackPanel>

                                            <TextBlock Grid.Column="4" Text="{Binding NextRunAt}"
                                                       VerticalAlignment="Center"
                                                       Foreground="{ThemeResource SystemBaseMediumColor}" />

                                            <Border Grid.Column="5" CornerRadius="4" Padding="6,2"
                                                    HorizontalAlignment="Left" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding LastRunStatus}" FontSize="11" />
                                            </Border>

                                            <StackPanel Grid.Column="6" Orientation="Horizontal" Spacing="4"
                                                        VerticalAlignment="Center">
                                                <Button Click="RunMaintenanceNow_Click" Tag="{Binding Id}"
                                                        Padding="8,4" ToolTipService.ToolTip="Run now">
                                                    <FontIcon Glyph="&#xE768;" FontSize="12" />
                                                </Button>
                                                <Button Click="EditMaintenanceSchedule_Click" Tag="{Binding Id}"
                                                        Padding="8,4" ToolTipService.ToolTip="Edit">
                                                    <FontIcon Glyph="&#xE70F;" FontSize="12" />
                                                </Button>
                                                <Button Click="ViewMaintenanceHistory_Click" Tag="{Binding Id}"
                                                        Padding="8,4" ToolTipService.ToolTip="View history">
                                                    <FontIcon Glyph="&#xE81C;" FontSize="12" />
                                                </Button>
                                                <Button Click="DeleteMaintenanceSchedule_Click" Tag="{Binding Id}"
                                                        Padding="8,4" ToolTipService.ToolTip="Delete">
                                                    <FontIcon Glyph="&#xE74D;" FontSize="12" />
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>

                            <TextBlock x:Name="NoMaintenanceSchedulesText" Grid.Row="1"
                                       Text="No maintenance schedules configured. Click 'New Maintenance' to create one."
                                       Foreground="{ThemeResource SystemBaseMediumColor}"
                                       FontStyle="Italic" HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Visibility="Collapsed" />
                        </Grid>
                    </Border>
                </Grid>
            </PivotItem>

            <!-- Execution History Tab -->
            <PivotItem Header="Execution History">
                <Border Style="{StaticResource CardStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- Filters -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="16" Margin="0,0,0,16">
                            <ComboBox x:Name="HistoryTypeFilter" Header="Type" SelectedIndex="0"
                                      SelectionChanged="HistoryFilter_Changed" MinWidth="120">
                                <ComboBoxItem Content="All" Tag="All" />
                                <ComboBoxItem Content="Backfill" Tag="Backfill" />
                                <ComboBoxItem Content="Maintenance" Tag="Maintenance" />
                            </ComboBox>

                            <ComboBox x:Name="HistoryStatusFilter" Header="Status" SelectedIndex="0"
                                      SelectionChanged="HistoryFilter_Changed" MinWidth="120">
                                <ComboBoxItem Content="All" Tag="All" />
                                <ComboBoxItem Content="Success" Tag="Success" />
                                <ComboBoxItem Content="Failed" Tag="Failed" />
                                <ComboBoxItem Content="Running" Tag="Running" />
                            </ComboBox>

                            <CalendarDatePicker x:Name="HistoryDateFrom" Header="From" PlaceholderText="Start date"
                                                DateChanged="HistoryFilter_Changed" />

                            <CalendarDatePicker x:Name="HistoryDateTo" Header="To" PlaceholderText="End date"
                                                DateChanged="HistoryFilter_Changed" />

                            <Button Content="Clear Filters" Click="ClearHistoryFilters_Click"
                                    VerticalAlignment="Bottom" />
                        </StackPanel>

                        <!-- History List -->
                        <ListView x:Name="ExecutionHistoryList" Grid.Row="1" SelectionMode="None">
                            <ListView.HeaderTemplate>
                                <DataTemplate>
                                    <Grid Padding="12,8" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="180" />
                                            <ColumnDefinition Width="100" />
                                            <ColumnDefinition Width="150" />
                                            <ColumnDefinition Width="100" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="Schedule" FontWeight="SemiBold" />
                                        <TextBlock Grid.Column="1" Text="Type" FontWeight="SemiBold" />
                                        <TextBlock Grid.Column="2" Text="Started" FontWeight="SemiBold" />
                                        <TextBlock Grid.Column="3" Text="Duration" FontWeight="SemiBold" />
                                        <TextBlock Grid.Column="4" Text="Status" FontWeight="SemiBold" />
                                        <TextBlock Grid.Column="5" Text="Records" FontWeight="SemiBold" />
                                        <TextBlock Grid.Column="6" Text="Details" FontWeight="SemiBold" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.HeaderTemplate>
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="180" />
                                            <ColumnDefinition Width="100" />
                                            <ColumnDefinition Width="150" />
                                            <ColumnDefinition Width="100" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="{Binding ScheduleName}" FontWeight="SemiBold"
                                                   VerticalAlignment="Center" />

                                        <Border Grid.Column="1" Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                                CornerRadius="4" Padding="6,2" VerticalAlignment="Center"
                                                HorizontalAlignment="Left">
                                            <TextBlock Text="Backfill" FontSize="11" />
                                        </Border>

                                        <TextBlock Grid.Column="2" Text="{Binding StartedAt}" VerticalAlignment="Center" />

                                        <TextBlock Grid.Column="3" Text="{Binding Duration}" VerticalAlignment="Center" />

                                        <Border Grid.Column="4" CornerRadius="4" Padding="6,2"
                                                VerticalAlignment="Center" HorizontalAlignment="Left">
                                            <TextBlock Text="{Binding Status}" FontSize="11" />
                                        </Border>

                                        <TextBlock Grid.Column="5" Text="{Binding RecordsProcessed}"
                                                   VerticalAlignment="Center" />

                                        <Button Grid.Column="6" Content="View Details" FontSize="11" Padding="8,4"
                                                Click="ViewExecutionDetails_Click" Tag="{Binding Id}"
                                                VerticalAlignment="Center" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <TextBlock x:Name="NoHistoryText" Grid.Row="1"
                                   Text="No execution history found"
                                   Foreground="{ThemeResource SystemBaseMediumColor}"
                                   FontStyle="Italic" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Visibility="Collapsed" />
                    </Grid>
                </Border>
            </PivotItem>

            <!-- Schedule Templates Tab -->
            <PivotItem Header="Templates">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="16">
                        <!-- Backfill Templates -->
                        <Border Style="{StaticResource CardStyle}">
                            <StackPanel Spacing="16">
                                <TextBlock Text="Backfill Schedule Templates" Style="{StaticResource SubtitleTextBlockStyle}" />

                                <StackPanel x:Name="BackfillTemplatesPanel" Spacing="8">
                                    <!-- Hourly -->
                                    <Button HorizontalAlignment="Stretch" Click="ApplyTemplate_Click" Tag="hourly-backfill">
                                        <Grid HorizontalAlignment="Stretch" Width="600">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <TextBlock Text="Hourly Backfill" FontWeight="SemiBold" />
                                                <TextBlock Text="Run every hour to catch up on recent data"
                                                           Style="{StaticResource CaptionTextBlockStyle}"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                                <TextBlock Text="0 * * * *" FontFamily="Consolas" FontSize="11"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                            </StackPanel>
                                            <TextBlock Grid.Column="1" Text="Every hour"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       VerticalAlignment="Center" />
                                        </Grid>
                                    </Button>

                                    <!-- Daily -->
                                    <Button HorizontalAlignment="Stretch" Click="ApplyTemplate_Click" Tag="daily-backfill">
                                        <Grid HorizontalAlignment="Stretch" Width="600">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <TextBlock Text="Daily Backfill" FontWeight="SemiBold" />
                                                <TextBlock Text="Run daily at 6 AM to fill previous day's data"
                                                           Style="{StaticResource CaptionTextBlockStyle}"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                                <TextBlock Text="0 6 * * *" FontFamily="Consolas" FontSize="11"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                            </StackPanel>
                                            <TextBlock Grid.Column="1" Text="Daily at 6 AM"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       VerticalAlignment="Center" />
                                        </Grid>
                                    </Button>

                                    <!-- Weekly -->
                                    <Button HorizontalAlignment="Stretch" Click="ApplyTemplate_Click" Tag="weekly-backfill">
                                        <Grid HorizontalAlignment="Stretch" Width="600">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <TextBlock Text="Weekly Full Backfill" FontWeight="SemiBold" />
                                                <TextBlock Text="Run every Sunday at midnight for weekly reconciliation"
                                                           Style="{StaticResource CaptionTextBlockStyle}"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                                <TextBlock Text="0 0 * * 0" FontFamily="Consolas" FontSize="11"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                            </StackPanel>
                                            <TextBlock Grid.Column="1" Text="Sunday midnight"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       VerticalAlignment="Center" />
                                        </Grid>
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Maintenance Templates -->
                        <Border Style="{StaticResource CardStyle}">
                            <StackPanel Spacing="16">
                                <TextBlock Text="Maintenance Schedule Templates" Style="{StaticResource SubtitleTextBlockStyle}" />

                                <StackPanel x:Name="MaintenanceTemplatesPanel" Spacing="8">
                                    <!-- Health Check -->
                                    <Button HorizontalAlignment="Stretch" Click="ApplyMaintenanceTemplate_Click" Tag="health-check">
                                        <Grid HorizontalAlignment="Stretch" Width="600">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <TextBlock Text="Daily Health Check" FontWeight="SemiBold" />
                                                <TextBlock Text="Run integrity checks on all data files daily"
                                                           Style="{StaticResource CaptionTextBlockStyle}"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                                <TextBlock Text="0 3 * * *" FontFamily="Consolas" FontSize="11"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                            </StackPanel>
                                            <TextBlock Grid.Column="1" Text="Daily at 3 AM"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       VerticalAlignment="Center" />
                                        </Grid>
                                    </Button>

                                    <!-- Cleanup -->
                                    <Button HorizontalAlignment="Stretch" Click="ApplyMaintenanceTemplate_Click" Tag="cleanup">
                                        <Grid HorizontalAlignment="Stretch" Width="600">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <TextBlock Text="Weekly Cleanup" FontWeight="SemiBold" />
                                                <TextBlock Text="Remove orphaned files and temporary data weekly"
                                                           Style="{StaticResource CaptionTextBlockStyle}"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                                <TextBlock Text="0 4 * * 6" FontFamily="Consolas" FontSize="11"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                            </StackPanel>
                                            <TextBlock Grid.Column="1" Text="Saturday 4 AM"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       VerticalAlignment="Center" />
                                        </Grid>
                                    </Button>

                                    <!-- Archive Migration -->
                                    <Button HorizontalAlignment="Stretch" Click="ApplyMaintenanceTemplate_Click" Tag="archive">
                                        <Grid HorizontalAlignment="Stretch" Width="600">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel>
                                                <TextBlock Text="Monthly Archive Migration" FontWeight="SemiBold" />
                                                <TextBlock Text="Move old data to cold storage monthly"
                                                           Style="{StaticResource CaptionTextBlockStyle}"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                                <TextBlock Text="0 2 1 * *" FontFamily="Consolas" FontSize="11"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                            </StackPanel>
                                            <TextBlock Grid.Column="1" Text="1st of month 2 AM"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       VerticalAlignment="Center" />
                                        </Grid>
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Cron Expression Builder -->
                        <Border Style="{StaticResource CardStyle}">
                            <StackPanel Spacing="16">
                                <TextBlock Text="Cron Expression Builder" Style="{StaticResource SubtitleTextBlockStyle}" />

                                <Grid ColumnSpacing="16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <TextBox x:Name="CronExpressionInput" Grid.Column="0"
                                             Header="Cron Expression"
                                             PlaceholderText="* * * * * (minute hour day month weekday)"
                                             FontFamily="Consolas"
                                             TextChanged="CronExpression_TextChanged" />

                                    <Button Grid.Column="1" Content="Validate" Click="ValidateCron_Click"
                                            VerticalAlignment="Bottom" />
                                </Grid>

                                <StackPanel x:Name="CronValidationPanel" Spacing="8" Visibility="Collapsed">
                                    <TextBlock x:Name="CronDescriptionText" FontWeight="SemiBold" />
                                    <TextBlock Text="Next 5 runs:" Style="{StaticResource CaptionTextBlockStyle}" />
                                    <ItemsControl x:Name="NextRunsList">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding}" FontFamily="Consolas" FontSize="12"
                                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>

                                <InfoBar x:Name="CronErrorBar" IsOpen="False" Severity="Error" IsClosable="True" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </PivotItem>
        </Pivot>

        <!-- Loading Overlay -->
        <ProgressRing x:Name="LoadingRing" Grid.RowSpan="2" IsActive="False" Width="48" Height="48"
                      HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed" />

        <InfoBar x:Name="PageInfoBar" Grid.Row="1" IsOpen="False" IsClosable="True"
                 HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,16" />
    </Grid>
</Page>
