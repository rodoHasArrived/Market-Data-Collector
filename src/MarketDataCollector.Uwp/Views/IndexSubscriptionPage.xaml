<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MarketDataCollector.Uwp.Views.IndexSubscriptionPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="380" />
        </Grid.ColumnDefinitions>

        <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto" Padding="24">
            <StackPanel Spacing="24" MaxWidth="900">
                <!-- Header -->
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <FontIcon Glyph="&#xE9D9;" FontSize="28" Foreground="{ThemeResource SystemAccentColor}" />
                    <TextBlock Text="Index Subscription" Style="{StaticResource TitleTextBlockStyle}" VerticalAlignment="Center" />
                </StackPanel>

                <TextBlock Text="Subscribe to all constituents of major market indices automatically."
                           Style="{StaticResource BodyTextBlockStyle}"
                           Foreground="{ThemeResource SystemBaseMediumColor}" />

                <!-- Major US Indices -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel Spacing="16">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE8D4;" Foreground="{ThemeResource SystemAccentColor}" />
                            <TextBlock Text="Major US Indices" Style="{StaticResource SubtitleTextBlockStyle}" />
                        </StackPanel>

                        <Grid ColumnSpacing="16" RowSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- S&P 500 -->
                            <Border Grid.Row="0" Grid.Column="0"
                                    Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                    CornerRadius="8" Padding="16">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Text="S&amp;P 500" FontWeight="Bold" FontSize="16" />
                                    <TextBlock Grid.Row="1" Text="500 large-cap US stocks"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                                    <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8" Margin="0,12,0,0">
                                        <Button Content="Subscribe All" Tag="SP500"
                                                Style="{StaticResource AccentButtonStyle}"
                                                Click="SubscribeIndex_Click" />
                                        <Button Content="Top 50" Tag="SP500_50"
                                                Click="SubscribeIndex_Click" />
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Nasdaq-100 -->
                            <Border Grid.Row="0" Grid.Column="1"
                                    Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                    CornerRadius="8" Padding="16">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Text="Nasdaq-100" FontWeight="Bold" FontSize="16" />
                                    <TextBlock Grid.Row="1" Text="100 largest non-financial stocks"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                                    <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8" Margin="0,12,0,0">
                                        <Button Content="Subscribe All" Tag="NDX"
                                                Style="{StaticResource AccentButtonStyle}"
                                                Click="SubscribeIndex_Click" />
                                        <Button Content="Top 30" Tag="NDX_30"
                                                Click="SubscribeIndex_Click" />
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Dow Jones -->
                            <Border Grid.Row="1" Grid.Column="0"
                                    Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                    CornerRadius="8" Padding="16">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Text="Dow Jones 30" FontWeight="Bold" FontSize="16" />
                                    <TextBlock Grid.Row="1" Text="30 blue-chip stocks"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                                    <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8" Margin="0,12,0,0">
                                        <Button Content="Subscribe All" Tag="DJI"
                                                Style="{StaticResource AccentButtonStyle}"
                                                Click="SubscribeIndex_Click" />
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Russell 2000 -->
                            <Border Grid.Row="1" Grid.Column="1"
                                    Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                    CornerRadius="8" Padding="16">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Text="Russell 2000" FontWeight="Bold" FontSize="16" />
                                    <TextBlock Grid.Row="1" Text="2000 small-cap stocks"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                                    <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8" Margin="0,12,0,0">
                                        <Button Content="Top 100" Tag="RTY_100"
                                                Style="{StaticResource AccentButtonStyle}"
                                                Click="SubscribeIndex_Click" />
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Sector ETFs -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel Spacing="16">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE943;" Foreground="{ThemeResource SystemAccentColor}" />
                            <TextBlock Text="Sector ETFs" Style="{StaticResource SubtitleTextBlockStyle}" />
                        </StackPanel>

                        <TextBlock Text="Subscribe to sector-specific ETFs and their top holdings."
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource SystemBaseMediumColor}" />

                        <ListView x:Name="SectorETFsList" SelectionMode="None">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="8,4" ColumnSpacing="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="60" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="{Binding Symbol}" FontWeight="SemiBold" />
                                        <TextBlock Grid.Column="1" Text="{Binding Name}" />
                                        <TextBlock Grid.Column="2" Text="{Binding HoldingsText}"
                                                   Foreground="{ThemeResource SystemBaseMediumColor}" />
                                        <Button Grid.Column="3" Content="Subscribe" FontSize="11" Padding="8,4"
                                                Click="SubscribeSector_Click" Tag="{Binding}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>
                </Border>

                <!-- Custom Index -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel Spacing="16">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE70F;" Foreground="{ThemeResource SystemAccentColor}" />
                            <TextBlock Text="Custom Index" Style="{StaticResource SubtitleTextBlockStyle}" />
                        </StackPanel>

                        <TextBlock Text="Enter a custom index or ETF to fetch its constituents."
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource SystemBaseMediumColor}" />

                        <Grid ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBox x:Name="CustomIndexBox" PlaceholderText="ETF symbol (e.g., XLF, XLK, VTI)" />
                            <Button Grid.Column="1" Content="Fetch Holdings" Click="FetchCustomIndex_Click" />
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Preview Constituents -->
                <Border x:Name="ConstituentPreviewCard" Style="{StaticResource CardStyle}" Visibility="Collapsed">
                    <StackPanel Spacing="16">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock x:Name="PreviewIndexName" Text="Index Constituents"
                                           Style="{StaticResource SubtitleTextBlockStyle}" />
                                <TextBlock x:Name="PreviewCountText"
                                           VerticalAlignment="Center"
                                           Foreground="{ThemeResource SystemBaseMediumColor}" />
                            </StackPanel>

                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                                <Button Content="Select All" Click="SelectAllConstituents_Click" />
                                <Button Content="Clear" Click="ClearConstituents_Click" />
                            </StackPanel>
                        </Grid>

                        <ListView x:Name="ConstituentsList" SelectionMode="Multiple" MaxHeight="300">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="4" ColumnSpacing="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="70" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="80" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="{Binding Symbol}" FontWeight="SemiBold" />
                                        <TextBlock Grid.Column="1" Text="{Binding Name}"
                                                   TextTrimming="CharacterEllipsis" />
                                        <TextBlock Grid.Column="2" Text="{Binding WeightText}"
                                                   HorizontalAlignment="Right"
                                                   Foreground="{ThemeResource SystemBaseMediumColor}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <Grid ColumnSpacing="24">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Spacing="8">
                                <CheckBox x:Name="EnableTradesCheck" Content="Subscribe to Trades" IsChecked="True" />
                                <CheckBox x:Name="EnableDepthCheck" Content="Subscribe to Market Depth" />
                            </StackPanel>

                            <StackPanel Grid.Column="1" Spacing="8">
                                <ComboBox x:Name="DepthLevelsCombo" Header="Depth Levels" SelectedIndex="1"
                                          IsEnabled="False" HorizontalAlignment="Stretch">
                                    <ComboBoxItem Content="1 level" Tag="1" />
                                    <ComboBoxItem Content="5 levels" Tag="5" />
                                    <ComboBoxItem Content="10 levels" Tag="10" />
                                </ComboBox>
                            </StackPanel>
                        </Grid>

                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <Button x:Name="SubscribeSelectedButton"
                                    Content="Subscribe Selected"
                                    Style="{StaticResource AccentButtonStyle}"
                                    Click="SubscribeSelected_Click" />
                            <ProgressRing x:Name="SubscribeProgress" IsActive="False" Width="24" Height="24" />
                            <TextBlock x:Name="SubscribeStatusText" VerticalAlignment="Center"
                                       Style="{StaticResource CaptionTextBlockStyle}" />
                        </StackPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Right Panel -->
        <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto" Padding="12,24,24,24">
            <StackPanel Spacing="16">
                <!-- Current Subscriptions Summary -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Current Index Subscriptions" Style="{StaticResource BodyStrongTextBlockStyle}" />

                        <Grid RowSpacing="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Active Indices" />
                            <TextBlock x:Name="ActiveIndicesText" Grid.Row="0" Grid.Column="1" Text="0"
                                       FontWeight="SemiBold" />

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Total Symbols" />
                            <TextBlock x:Name="TotalSymbolsText" Grid.Row="1" Grid.Column="1" Text="0"
                                       FontWeight="SemiBold" />

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Last Update" />
                            <TextBlock x:Name="LastUpdateText" Grid.Row="2" Grid.Column="1" Text="Never"
                                       FontWeight="SemiBold" />
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Active Index Subscriptions -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Active Indices" Style="{StaticResource BodyStrongTextBlockStyle}" />

                        <ListView x:Name="ActiveIndicesList" SelectionMode="None" MaxHeight="200">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="4" ColumnSpacing="8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="{Binding Name}" FontWeight="SemiBold" />
                                        <TextBlock Grid.Column="1" Text="{Binding SymbolCount}"
                                                   Foreground="{ThemeResource SystemBaseMediumColor}" />
                                        <Button Grid.Column="2" Content="Remove" FontSize="11" Padding="6,2"
                                                Click="RemoveIndex_Click" Tag="{Binding}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <TextBlock x:Name="NoActiveIndicesText" Text="No active index subscriptions"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource SystemBaseMediumColor}" />
                    </StackPanel>
                </Border>

                <!-- Auto-Rebalance -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Auto-Rebalance" Style="{StaticResource BodyStrongTextBlockStyle}" />

                        <ToggleSwitch x:Name="AutoRebalanceToggle"
                                      Header="Automatic Index Rebalancing"
                                      OffContent="Manual updates only"
                                      OnContent="Auto-update on rebalance" />

                        <TextBlock Text="Automatically update subscriptions when index constituents change."
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource SystemBaseMediumColor}"
                                   TextWrapping="Wrap" />
                    </StackPanel>
                </Border>

                <!-- Info -->
                <Border Style="{StaticResource CardStyle}"
                        Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}">
                    <StackPanel Spacing="8">
                        <TextBlock Text="About Index Subscriptions" Style="{StaticResource BodyStrongTextBlockStyle}" />

                        <TextBlock Text="Index subscriptions allow you to automatically track all constituents of major indices. This is useful for broad market analysis or creating index-tracking strategies."
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   TextWrapping="Wrap" />
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
