<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MarketDataCollector.Uwp.Views.ServiceManagerPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MarketDataCollector.Uwp.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24">
        <StackPanel Spacing="24" MaxWidth="1000">
            <!-- Header -->
            <StackPanel Orientation="Horizontal" Spacing="12">
                <FontIcon Glyph="&#xE912;" FontSize="28" Foreground="{ThemeResource SystemAccentColor}" />
                <TextBlock Text="Collector Service Manager" Style="{StaticResource TitleTextBlockStyle}" VerticalAlignment="Center" />
            </StackPanel>

            <TextBlock Text="Monitor and control the Market Data Collector background service."
                       Style="{StaticResource BodyTextBlockStyle}"
                       Foreground="{ThemeResource SystemBaseMediumColor}" />

            <!-- Service Status Card -->
            <Border Style="{StaticResource CardStyle}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <Ellipse x:Name="ServiceStatusIndicator" Width="16" Height="16" Fill="#48BB78" />
                            <TextBlock x:Name="ServiceStatusText" Text="Running"
                                       Style="{StaticResource SubtitleTextBlockStyle}" />
                        </StackPanel>

                        <Grid ColumnSpacing="24" RowSpacing="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Process ID:" FontWeight="SemiBold" />
                            <TextBlock x:Name="ProcessIdText" Grid.Row="0" Grid.Column="1" Text="12345" />

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Uptime:" FontWeight="SemiBold" />
                            <TextBlock x:Name="UptimeText" Grid.Row="1" Grid.Column="1" Text="2h 34m 12s" />

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Started At:" FontWeight="SemiBold" />
                            <TextBlock x:Name="StartedAtText" Grid.Row="2" Grid.Column="1" Text="2026-01-02 08:30:00 UTC" />

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Command:" FontWeight="SemiBold" />
                            <TextBlock x:Name="CommandText" Grid.Row="3" Grid.Column="1"
                                       Text="MarketDataCollector --http-port 8080 --watch-config"
                                       TextWrapping="Wrap" FontFamily="Consolas" FontSize="12" />
                        </Grid>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Spacing="8" VerticalAlignment="Center">
                        <Button x:Name="StartButton" Content="Start" Width="100"
                                Style="{StaticResource AccentButtonStyle}"
                                Click="StartService_Click" />
                        <Button x:Name="StopButton" Content="Stop" Width="100"
                                Click="StopService_Click" />
                        <Button x:Name="RestartButton" Content="Restart" Width="100"
                                Click="RestartService_Click" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Resource Usage -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE950;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Resource Usage" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <Grid ColumnSpacing="24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- CPU -->
                        <StackPanel Grid.Column="0" Spacing="8">
                            <TextBlock Text="CPU Usage" Style="{StaticResource CaptionTextBlockStyle}" />
                            <TextBlock x:Name="CpuUsageText" Text="12%"
                                       Style="{StaticResource SubheaderTextBlockStyle}"
                                       Foreground="{ThemeResource SystemAccentColor}" />
                            <ProgressBar x:Name="CpuProgressBar" Value="12" Maximum="100" />
                        </StackPanel>

                        <!-- Memory -->
                        <StackPanel Grid.Column="1" Spacing="8">
                            <TextBlock Text="Memory" Style="{StaticResource CaptionTextBlockStyle}" />
                            <TextBlock x:Name="MemoryUsageText" Text="256 MB"
                                       Style="{StaticResource SubheaderTextBlockStyle}"
                                       Foreground="{ThemeResource SystemAccentColor}" />
                            <ProgressBar x:Name="MemoryProgressBar" Value="25" Maximum="100" />
                        </StackPanel>

                        <!-- Network In -->
                        <StackPanel Grid.Column="2" Spacing="8">
                            <TextBlock Text="Network In" Style="{StaticResource CaptionTextBlockStyle}" />
                            <TextBlock x:Name="NetworkInText" Text="1.2 MB/s"
                                       Style="{StaticResource SubheaderTextBlockStyle}"
                                       Foreground="#48BB78" />
                            <TextBlock x:Name="NetworkInTotalText" Text="Total: 4.5 GB"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource SystemBaseMediumColor}" />
                        </StackPanel>

                        <!-- Network Out -->
                        <StackPanel Grid.Column="3" Spacing="8">
                            <TextBlock Text="Network Out" Style="{StaticResource CaptionTextBlockStyle}" />
                            <TextBlock x:Name="NetworkOutText" Text="0.1 MB/s"
                                       Style="{StaticResource SubheaderTextBlockStyle}"
                                       Foreground="#ED8936" />
                            <TextBlock x:Name="NetworkOutTotalText" Text="Total: 120 MB"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource SystemBaseMediumColor}" />
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Service Configuration -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE713;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Service Configuration" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <ToggleSwitch x:Name="AutoStartToggle"
                                  Header="Auto-Start with Windows"
                                  OffContent="Disabled"
                                  OnContent="Enabled"
                                  IsOn="False"
                                  Toggled="AutoStartToggle_Toggled" />

                    <ToggleSwitch x:Name="AutoRestartToggle"
                                  Header="Auto-Restart on Crash"
                                  OffContent="Disabled"
                                  OnContent="Enabled"
                                  IsOn="True" />

                    <NumberBox x:Name="RestartDelayBox"
                               Header="Restart Delay (seconds)"
                               Value="5"
                               Minimum="1"
                               Maximum="300"
                               SpinButtonPlacementMode="Inline" />

                    <ComboBox x:Name="LogLevelCombo"
                              Header="Log Level"
                              HorizontalAlignment="Stretch"
                              SelectedIndex="2">
                        <ComboBoxItem Content="Verbose" Tag="Verbose" />
                        <ComboBoxItem Content="Debug" Tag="Debug" />
                        <ComboBoxItem Content="Information" Tag="Information" />
                        <ComboBoxItem Content="Warning" Tag="Warning" />
                        <ComboBoxItem Content="Error" Tag="Error" />
                    </ComboBox>

                    <!-- Scheduled Collection -->
                    <TextBlock Text="Collection Schedule" Style="{StaticResource BodyTextBlockStyle}"
                               FontWeight="SemiBold" Margin="0,8,0,0" />

                    <ToggleSwitch x:Name="ScheduledCollectionToggle"
                                  Header="Enable Scheduled Collection"
                                  OffContent="Collect 24/7"
                                  OnContent="Market Hours Only"
                                  IsOn="False" />

                    <InfoBar x:Name="ScheduleInfoBar" IsOpen="False" IsClosable="False"
                             Severity="Informational"
                             Title="Scheduled Collection"
                             Message="When enabled, the collector will only run during configured trading hours. Configure hours in Trading Hours Manager." />
                </StackPanel>
            </Border>

            <!-- Log Viewer -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE756;" Foreground="{ThemeResource SystemAccentColor}" />
                            <TextBlock Text="Live Logs" Style="{StaticResource SubtitleTextBlockStyle}" />
                        </StackPanel>

                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                            <ToggleSwitch x:Name="AutoScrollToggle"
                                          OffContent="Auto-scroll Off"
                                          OnContent="Auto-scroll On"
                                          IsOn="True" />
                            <Button Content="Clear" Click="ClearLogs_Click" />
                            <Button Content="Export" Click="ExportLogs_Click" />
                        </StackPanel>
                    </Grid>

                    <!-- Log Filter -->
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <CheckBox x:Name="ShowInfoCheck" Content="Info" IsChecked="True" />
                        <CheckBox x:Name="ShowWarningCheck" Content="Warning" IsChecked="True" />
                        <CheckBox x:Name="ShowErrorCheck" Content="Error" IsChecked="True" />
                        <CheckBox x:Name="ShowDebugCheck" Content="Debug" IsChecked="False" />
                        <AutoSuggestBox x:Name="LogFilterBox"
                                        PlaceholderText="Filter logs..."
                                        QueryIcon="Find"
                                        Width="200" />
                    </StackPanel>

                    <!-- Log Content -->
                    <Border Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                            CornerRadius="4" Padding="12">
                        <ScrollViewer x:Name="LogScrollViewer"
                                      Height="300"
                                      VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Auto">
                            <ItemsControl x:Name="LogEntriesControl">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Padding="4,2" ColumnSpacing="12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="160" />
                                                <ColumnDefinition Width="70" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0" Text="{Binding Timestamp}"
                                                       FontFamily="Consolas" FontSize="12"
                                                       Foreground="{ThemeResource SystemBaseMediumColor}" />
                                            <TextBlock Grid.Column="1" Text="{Binding Level}"
                                                       FontFamily="Consolas" FontSize="12"
                                                       Foreground="{Binding LevelColor}" />
                                            <TextBlock Grid.Column="2" Text="{Binding Message}"
                                                       FontFamily="Consolas" FontSize="12"
                                                       TextWrapping="Wrap" />
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>
                </StackPanel>
            </Border>

            <!-- Crash Recovery History -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE783;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Recovery History" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <ListView x:Name="RecoveryHistoryList"
                              SelectionMode="None"
                              MaxHeight="200">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="8,4" ColumnSpacing="16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160" />
                                        <ColumnDefinition Width="100" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="{Binding Timestamp}" />
                                    <TextBlock Grid.Column="1" Text="{Binding Type}"
                                               Foreground="{Binding TypeColor}" />
                                    <TextBlock Grid.Column="2" Text="{Binding Reason}"
                                               TextWrapping="Wrap"
                                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <TextBlock x:Name="NoRecoveryHistoryText"
                               Text="No crash recovery events recorded."
                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                </StackPanel>
            </Border>

            <!-- Action Buttons -->
            <StackPanel Orientation="Horizontal" Spacing="12">
                <Button Content="Save Configuration"
                        Style="{StaticResource AccentButtonStyle}"
                        Click="SaveConfiguration_Click" />
                <Button Content="Refresh Status" Click="RefreshStatus_Click" />
                <ProgressRing x:Name="ActionProgress" IsActive="False" Width="20" Height="20" />
            </StackPanel>

            <InfoBar x:Name="ActionInfoBar" IsOpen="False" IsClosable="True" />
        </StackPanel>
    </ScrollViewer>
</Page>
