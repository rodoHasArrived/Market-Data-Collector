<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MarketDataCollector.Uwp.Views.ExportPresetsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MarketDataCollector.Uwp.Views"
    xmlns:export="using:MarketDataCollector.Contracts.Export"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="24" Padding="0,0,24,24">
            <!-- Page Header -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel>
                    <TextBlock Text="Export Presets" Style="{StaticResource TitleTextBlockStyle}" />
                    <TextBlock Text="Save and manage export configurations for different workflows and analysis tools"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button Content="Create Preset" Style="{StaticResource AccentButtonStyle}"
                            Click="CreatePreset_Click">
                        <Button.KeyboardAccelerators>
                            <KeyboardAccelerator Modifiers="Control" Key="N" />
                        </Button.KeyboardAccelerators>
                    </Button>
                    <Button Content="Import" Click="ImportPresets_Click" />
                </StackPanel>
            </Grid>

            <!-- Quick Export Section -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE896;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Quick Export" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <TextBlock Text="Start an export using a preset. Select a preset and click Export."
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource SystemBaseMediumColor}" />

                    <Grid ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ComboBox x:Name="QuickExportPresetCombo" Header="Select Preset"
                                  HorizontalAlignment="Stretch" DisplayMemberPath="Name" />

                        <Button Grid.Column="1" Content="Export Now" Style="{StaticResource AccentButtonStyle}"
                                VerticalAlignment="Bottom" Click="QuickExport_Click" />
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Built-in Presets Section -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8F1;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Built-in Presets" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <TextBlock Text="Pre-configured presets optimized for common analysis tools"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource SystemBaseMediumColor}" />

                    <GridView x:Name="BuiltInPresetsGrid" SelectionMode="None">
                        <GridView.ItemTemplate>
                            <DataTemplate x:DataType="export:ExportPreset">
                                <Border Style="{StaticResource CardStyle}" Width="300" Margin="0,0,8,8"
                                        Background="{ThemeResource SystemFillColorSolidNeutralBackgroundBrush}">
                                    <StackPanel Spacing="12" Padding="4">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon Glyph="&#xE8A5;" Foreground="{ThemeResource SystemAccentColor}" />
                                                <TextBlock Text="{x:Bind Name}" FontWeight="SemiBold" />
                                            </StackPanel>

                                            <Border Grid.Column="1" Background="{ThemeResource SystemAccentColor}"
                                                    CornerRadius="4" Padding="6,2">
                                                <TextBlock Text="Built-in" FontSize="10" Foreground="White" />
                                            </Border>
                                        </Grid>

                                        <TextBlock Text="{x:Bind Description}" TextWrapping="Wrap"
                                                   Foreground="{ThemeResource SystemBaseMediumColor}"
                                                   MaxLines="2" />

                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <Border Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                                    CornerRadius="4" Padding="6,2">
                                                <TextBlock Text="{x:Bind Format}" FontSize="11" />
                                            </Border>
                                            <Border Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                                    CornerRadius="4" Padding="6,2">
                                                <TextBlock Text="{x:Bind Compression}" FontSize="11" />
                                            </Border>
                                        </StackPanel>

                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <Button Content="Use" HorizontalAlignment="Stretch"
                                                    Click="UsePreset_Click" Tag="{x:Bind Id}" />
                                            <Button Content="Duplicate" Click="DuplicatePreset_Click" Tag="{x:Bind Id}" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </GridView.ItemTemplate>
                    </GridView>
                </StackPanel>
            </Border>

            <!-- Custom Presets Section -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE728;" Foreground="{ThemeResource SystemAccentColor}" />
                            <TextBlock Text="Custom Presets" Style="{StaticResource SubtitleTextBlockStyle}" />
                            <TextBlock x:Name="CustomPresetCount" Text="(0)"
                                       Foreground="{ThemeResource SystemBaseMediumColor}"
                                       VerticalAlignment="Center" />
                        </StackPanel>

                        <Button Grid.Column="1" Content="Export Selected" Click="ExportSelectedPresets_Click" />
                    </Grid>

                    <TextBlock Text="Your saved export configurations"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource SystemBaseMediumColor}" />

                    <TextBlock x:Name="NoCustomPresetsText" Text="No custom presets. Create one to save your export configuration."
                               Foreground="{ThemeResource SystemBaseMediumColor}"
                               Visibility="Visible" />

                    <ListView x:Name="CustomPresetsList" SelectionMode="None" Visibility="Collapsed">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="export:ExportPreset">
                                <Border CornerRadius="4" Padding="12" Margin="0,4"
                                        Background="{ThemeResource SystemFillColorSolidNeutralBackgroundBrush}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="{x:Bind Name}" FontWeight="SemiBold" />
                                                <Border Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                                        CornerRadius="4" Padding="6,2" Visibility="{x:Bind ScheduleEnabled}">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <FontIcon Glyph="&#xE787;" FontSize="10" />
                                                        <TextBlock Text="Scheduled" FontSize="10" />
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="{x:Bind Description}" TextWrapping="Wrap"
                                                       Foreground="{ThemeResource SystemBaseMediumColor}" />
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Border Background="{ThemeResource SystemFillColorNeutralBackgroundBrush}"
                                                        CornerRadius="4" Padding="6,2">
                                                    <TextBlock Text="{x:Bind Format}" FontSize="11" />
                                                </Border>
                                                <TextBlock Style="{StaticResource CaptionTextBlockStyle}">
                                                    <Run Text="Used:" />
                                                    <Run Text="{x:Bind UseCount}" />
                                                    <Run Text="times" />
                                                </TextBlock>
                                            </StackPanel>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Top">
                                            <Button Content="Use" Click="UsePreset_Click" Tag="{x:Bind Id}" />
                                            <Button Content="Edit" Click="EditPreset_Click" Tag="{x:Bind Id}" />
                                            <Button Content="Duplicate" Click="DuplicatePreset_Click" Tag="{x:Bind Id}" />
                                            <Button Click="DeletePreset_Click" Tag="{x:Bind Id}">
                                                <FontIcon Glyph="&#xE74D;" FontSize="14" />
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>
            </Border>

            <!-- Preset Details/Editor Section -->
            <Border Style="{StaticResource CardStyle}" x:Name="PresetEditorSection" Visibility="Collapsed">
                <StackPanel Spacing="16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE70F;" Foreground="{ThemeResource SystemAccentColor}" />
                            <TextBlock x:Name="EditorTitle" Text="Create Preset" Style="{StaticResource SubtitleTextBlockStyle}" />
                        </StackPanel>

                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                            <Button Content="Save" Style="{StaticResource AccentButtonStyle}" Click="SavePreset_Click" />
                            <Button Content="Cancel" Click="CancelEdit_Click" />
                        </StackPanel>
                    </Grid>

                    <!-- Basic Settings -->
                    <Grid ColumnSpacing="16" RowSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBox x:Name="PresetNameBox" Header="Preset Name" PlaceholderText="My Export Preset" />
                        <TextBox x:Name="PresetDescriptionBox" Grid.Column="1" Header="Description" PlaceholderText="What this preset is for" />

                        <ComboBox x:Name="FormatCombo" Grid.Row="1" Header="Export Format" HorizontalAlignment="Stretch">
                            <ComboBoxItem Content="Parquet" Tag="Parquet" IsSelected="True" />
                            <ComboBoxItem Content="CSV" Tag="Csv" />
                            <ComboBoxItem Content="JSON Lines" Tag="Jsonl" />
                            <ComboBoxItem Content="QuantConnect Lean" Tag="Lean" />
                            <ComboBoxItem Content="Excel (XLSX)" Tag="Xlsx" />
                            <ComboBoxItem Content="SQL" Tag="Sql" />
                            <ComboBoxItem Content="Raw (Copy)" Tag="Raw" />
                        </ComboBox>

                        <ComboBox x:Name="CompressionCombo" Grid.Row="1" Grid.Column="1" Header="Compression" HorizontalAlignment="Stretch">
                            <ComboBoxItem Content="None" Tag="None" />
                            <ComboBoxItem Content="Snappy (Fast)" Tag="Snappy" IsSelected="True" />
                            <ComboBoxItem Content="Gzip" Tag="Gzip" />
                            <ComboBoxItem Content="ZSTD (Balanced)" Tag="Zstd" />
                            <ComboBoxItem Content="LZ4 (Fastest)" Tag="Lz4" />
                            <ComboBoxItem Content="ZIP Archive" Tag="Zip" />
                        </ComboBox>
                    </Grid>

                    <!-- Destination Settings -->
                    <TextBox x:Name="DestinationBox" Header="Destination Path Template"
                             PlaceholderText="D:\Exports\{year}\{month}"
                             HorizontalAlignment="Stretch" />

                    <TextBlock Text="Variables: {year}, {month}, {day}, {date}, {symbol}, {format}"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource SystemBaseMediumColor}" />

                    <TextBox x:Name="FilenamePatternBox" Header="Filename Pattern"
                             PlaceholderText="{symbol}_{date}.{format}"
                             HorizontalAlignment="Stretch" />

                    <!-- Filters -->
                    <TextBlock Text="Filters" FontWeight="SemiBold" Margin="0,8,0,0" />

                    <Grid ColumnSpacing="16" RowSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <ComboBox x:Name="DateRangeCombo" Header="Date Range" HorizontalAlignment="Stretch">
                            <ComboBoxItem Content="Today" Tag="Today" />
                            <ComboBoxItem Content="Yesterday" Tag="Yesterday" />
                            <ComboBoxItem Content="Last Week" Tag="LastWeek" IsSelected="True" />
                            <ComboBoxItem Content="Last Month" Tag="LastMonth" />
                            <ComboBoxItem Content="Last Quarter" Tag="LastQuarter" />
                            <ComboBoxItem Content="Last Year" Tag="LastYear" />
                            <ComboBoxItem Content="All Data" Tag="All" />
                            <ComboBoxItem Content="Custom" Tag="Custom" />
                        </ComboBox>

                        <ComboBox x:Name="SessionFilterCombo" Grid.Column="1" Header="Session Filter" HorizontalAlignment="Stretch">
                            <ComboBoxItem Content="All Sessions" Tag="All" IsSelected="True" />
                            <ComboBoxItem Content="Regular Hours Only" Tag="RegularHours" />
                            <ComboBoxItem Content="Pre-Market Only" Tag="PreMarket" />
                            <ComboBoxItem Content="After-Hours Only" Tag="AfterHours" />
                            <ComboBoxItem Content="Extended Hours" Tag="ExtendedHours" />
                        </ComboBox>
                    </Grid>

                    <TextBox x:Name="EventTypesBox" Header="Event Types (comma-separated, leave empty for all)"
                             PlaceholderText="Trade, BboQuote" />

                    <TextBox x:Name="SymbolsBox" Header="Symbols (comma-separated, leave empty for all)"
                             PlaceholderText="AAPL, MSFT, GOOGL" />

                    <!-- Options -->
                    <TextBlock Text="Options" FontWeight="SemiBold" Margin="0,8,0,0" />

                    <Grid ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Spacing="8">
                            <CheckBox x:Name="IncludeDataDictionaryCheck" Content="Include Data Dictionary" IsChecked="True" />
                            <CheckBox x:Name="IncludeLoaderScriptCheck" Content="Include Loader Script" IsChecked="True" />
                            <CheckBox x:Name="OverwriteExistingCheck" Content="Overwrite Existing Files" />
                        </StackPanel>

                        <StackPanel Grid.Column="1" Spacing="8">
                            <CheckBox x:Name="NotifyOnCompleteCheck" Content="Notify When Complete" />
                        </StackPanel>
                    </Grid>

                    <!-- Post-Export Hook -->
                    <TextBox x:Name="PostExportHookBox" Header="Post-Export Hook (optional command)"
                             PlaceholderText="python analyze.py --date {date}"
                             HorizontalAlignment="Stretch" />

                    <TextBlock Text="Variables: {date}, {destination}, {symbol}, {files}"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource SystemBaseMediumColor}" />

                    <!-- Schedule -->
                    <Grid ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <ToggleSwitch x:Name="ScheduleEnabledToggle" Header="Enable Schedule" />

                        <TextBox x:Name="ScheduleCronBox" Grid.Column="1" Header="Cron Schedule"
                                 PlaceholderText="0 6 * * *"
                                 IsEnabled="{x:Bind ScheduleEnabledToggle.IsOn, Mode=OneWay}" />
                    </Grid>

                    <TextBlock Text="Cron format: minute hour day month weekday (e.g., '0 6 * * *' = 6 AM daily)"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource SystemBaseMediumColor}" />
                </StackPanel>
            </Border>

            <!-- Usage Tips Section -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE946;" Foreground="{ThemeResource SystemAccentColor}" />
                        <TextBlock Text="Usage Tips" Style="{StaticResource SubtitleTextBlockStyle}" />
                    </StackPanel>

                    <Grid ColumnSpacing="32" RowSpacing="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Grid.Column="0" Spacing="4">
                            <TextBlock Text="Python/Pandas" FontWeight="SemiBold" />
                            <TextBlock Text="Use Parquet format with Snappy compression for best pandas performance"
                                       TextWrapping="Wrap" Foreground="{ThemeResource SystemBaseMediumColor}" />
                        </StackPanel>

                        <StackPanel Grid.Row="0" Grid.Column="1" Spacing="4">
                            <TextBlock Text="R Statistics" FontWeight="SemiBold" />
                            <TextBlock Text="CSV format with no compression works best with data.table and tidyverse"
                                       TextWrapping="Wrap" Foreground="{ThemeResource SystemBaseMediumColor}" />
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="0" Spacing="4">
                            <TextBlock Text="QuantConnect" FontWeight="SemiBold" />
                            <TextBlock Text="Lean format with ZIP compression for direct backtesting integration"
                                       TextWrapping="Wrap" Foreground="{ThemeResource SystemBaseMediumColor}" />
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="1" Spacing="4">
                            <TextBlock Text="Database Import" FontWeight="SemiBold" />
                            <TextBlock Text="CSV with DDL scripts for PostgreSQL COPY command bulk loading"
                                       TextWrapping="Wrap" Foreground="{ThemeResource SystemBaseMediumColor}" />
                        </StackPanel>

                        <StackPanel Grid.Row="2" Grid.Column="0" Spacing="4">
                            <TextBlock Text="Scheduled Exports" FontWeight="SemiBold" />
                            <TextBlock Text="Set up cron schedules for automated daily or weekly exports"
                                       TextWrapping="Wrap" Foreground="{ThemeResource SystemBaseMediumColor}" />
                        </StackPanel>

                        <StackPanel Grid.Row="2" Grid.Column="1" Spacing="4">
                            <TextBlock Text="Post-Export Hooks" FontWeight="SemiBold" />
                            <TextBlock Text="Run scripts automatically after export completes (e.g., analysis pipelines)"
                                       TextWrapping="Wrap" Foreground="{ThemeResource SystemBaseMediumColor}" />
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</Page>
