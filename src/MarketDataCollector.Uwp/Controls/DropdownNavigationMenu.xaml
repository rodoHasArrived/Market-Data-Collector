<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="MarketDataCollector.Uwp.Controls.DropdownNavigationMenu"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MarketDataCollector.Uwp.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    x:Name="RootControl">

    <UserControl.Resources>
        <!-- Menu item hover brush -->
        <SolidColorBrush x:Key="MenuItemHoverBrush" Color="#2621262d" />
        <SolidColorBrush x:Key="MenuItemPressedBrush" Color="#3321262d" />
        <SolidColorBrush x:Key="MenuSeparatorBrush" Color="#30808080" />
        <SolidColorBrush x:Key="MenuAccentBrush" Color="#3fb950" />
    </UserControl.Resources>

    <Grid x:Name="RootGrid">
        <!-- Backdrop overlay (click to dismiss) -->
        <Border x:Name="BackdropOverlay"
                Background="#000000"
                Opacity="0"
                Visibility="Collapsed">
            <Border.RenderTransform>
                <TranslateTransform />
            </Border.RenderTransform>
        </Border>

        <!-- Menu Container -->
        <Border x:Name="MenuContainer"
                Visibility="Collapsed"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Background="{StaticResource ConsoleBackgroundMediumBrush}"
                BorderBrush="{StaticResource ConsoleBorderBrush}"
                BorderThickness="1"
                CornerRadius="8"
                MinWidth="220"
                MaxWidth="320"
                Padding="4"
                RenderTransformOrigin="0,0">
            <Border.RenderTransform>
                <CompositeTransform ScaleY="1" ScaleX="1" />
            </Border.RenderTransform>
            <Border.Shadow>
                <ThemeShadow />
            </Border.Shadow>

            <Grid RowSpacing="4">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Menu Header (optional) -->
                <Border x:Name="MenuHeader"
                        Grid.Row="0"
                        Padding="12,8"
                        Visibility="{x:Bind HeaderVisibility, Mode=OneWay}">
                    <Grid ColumnSpacing="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <FontIcon x:Name="HeaderIcon"
                                  Grid.Column="0"
                                  Glyph="{x:Bind HeaderIcon, Mode=OneWay}"
                                  FontSize="16"
                                  Foreground="{StaticResource MenuAccentBrush}"
                                  VerticalAlignment="Center" />

                        <TextBlock x:Name="HeaderText"
                                   Grid.Column="1"
                                   Text="{x:Bind Header, Mode=OneWay}"
                                   FontWeight="SemiBold"
                                   FontSize="14"
                                   Foreground="{StaticResource ConsoleTextPrimaryBrush}"
                                   VerticalAlignment="Center" />

                        <!-- Close button -->
                        <Button x:Name="CloseButton"
                                Grid.Column="2"
                                Click="CloseButton_Click"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="6"
                                CornerRadius="4"
                                ToolTipService.ToolTip="Close (Esc)">
                            <FontIcon Glyph="&#xE711;" FontSize="12"
                                      Foreground="{StaticResource ConsoleTextMutedBrush}" />
                        </Button>
                    </Grid>
                </Border>

                <!-- Separator after header -->
                <Border x:Name="HeaderSeparator"
                        Grid.Row="1"
                        Height="1"
                        Background="{StaticResource MenuSeparatorBrush}"
                        Margin="8,0"
                        Visibility="{x:Bind HeaderVisibility, Mode=OneWay}" />

                <!-- Menu Items -->
                <ScrollViewer x:Name="MenuScrollViewer"
                              Grid.Row="2"
                              VerticalScrollBarVisibility="Auto"
                              MaxHeight="400">
                    <ItemsControl x:Name="MenuItemsControl"
                                  ItemsSource="{x:Bind MenuItems, Mode=OneWay}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="local:DropdownMenuItemData">
                                <local:DropdownMenuItem
                                    Icon="{x:Bind Icon}"
                                    Text="{x:Bind Text}"
                                    Description="{x:Bind Description}"
                                    Shortcut="{x:Bind Shortcut}"
                                    Tag="{x:Bind Tag}"
                                    IsSeparator="{x:Bind IsSeparator}"
                                    IsHeader="{x:Bind IsHeader}"
                                    IsEnabled="{x:Bind IsEnabled}"
                                    HasSubmenu="{x:Bind HasSubmenu}"
                                    ItemClicked="MenuItem_Clicked" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Footer (optional - shows hint text) -->
                <Border x:Name="MenuFooter"
                        Grid.Row="3"
                        Padding="12,8"
                        Visibility="{x:Bind FooterVisibility, Mode=OneWay}">
                    <StackPanel>
                        <Border Height="1"
                                Background="{StaticResource MenuSeparatorBrush}"
                                Margin="-4,0,-4,8" />
                        <TextBlock x:Name="FooterText"
                                   Text="{x:Bind Footer, Mode=OneWay}"
                                   FontSize="11"
                                   Foreground="{StaticResource ConsoleTextMutedBrush}"
                                   TextWrapping="Wrap" />
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Flick Indicator (shows during gesture) -->
        <Border x:Name="FlickIndicator"
                HorizontalAlignment="Left"
                VerticalAlignment="Center"
                Background="{StaticResource MenuAccentBrush}"
                CornerRadius="0,4,4,0"
                Padding="8,16"
                Opacity="0"
                Visibility="Collapsed">
            <FontIcon Glyph="&#xE76C;" FontSize="16" Foreground="White" />
        </Border>
    </Grid>
</UserControl>
