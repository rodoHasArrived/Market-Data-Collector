<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="MarketDataCollector.Uwp.Controls.DataTable"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MarketDataCollector.Uwp.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header with Title, Search, and Actions -->
        <Grid Grid.Row="0" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Title and Count -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                <TextBlock x:Name="TitleText"
                           Text="{x:Bind Title, Mode=OneWay}"
                           Style="{StaticResource SubtitleTextBlockStyle}"
                           Visibility="{x:Bind TitleVisibility, Mode=OneWay}" />
                <Border x:Name="CountBadge"
                        Background="{StaticResource ConsoleBackgroundLightBrush}"
                        CornerRadius="12"
                        Padding="10,4"
                        Visibility="{x:Bind CountVisibility, Mode=OneWay}">
                    <TextBlock Text="{x:Bind ItemCountDisplay, Mode=OneWay}"
                               FontSize="12"
                               Foreground="{StaticResource ConsoleTextSecondaryBrush}" />
                </Border>
            </StackPanel>

            <!-- Search Box -->
            <AutoSuggestBox x:Name="SearchBox"
                            Grid.Column="1"
                            PlaceholderText="{x:Bind SearchPlaceholder, Mode=OneWay}"
                            QueryIcon="Find"
                            MinWidth="200"
                            Margin="0,0,8,0"
                            Visibility="{x:Bind SearchVisibility, Mode=OneWay}"
                            TextChanged="SearchBox_TextChanged"
                            QuerySubmitted="SearchBox_QuerySubmitted"
                            AutomationProperties.Name="Search table" />

            <!-- Sort/Filter Controls -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                <ComboBox x:Name="SortCombo"
                          PlaceholderText="Sort by"
                          MinWidth="120"
                          Visibility="{x:Bind SortVisibility, Mode=OneWay}"
                          SelectionChanged="SortCombo_SelectionChanged" />
                <Button x:Name="RefreshButton"
                        Click="RefreshButton_Click"
                        Visibility="{x:Bind RefreshVisibility, Mode=OneWay}"
                        ToolTipService.ToolTip="Refresh data"
                        Padding="8">
                    <FontIcon Glyph="&#xE72C;" FontSize="14" />
                </Button>
            </StackPanel>
        </Grid>

        <!-- Column Headers -->
        <Border x:Name="HeaderRow"
                Grid.Row="1"
                Background="{StaticResource ConsoleBackgroundLightBrush}"
                CornerRadius="8,8,0,0"
                Padding="12,10">
            <Grid x:Name="HeaderGrid">
                <!-- Headers are populated dynamically -->
            </Grid>
        </Border>

        <!-- Data ListView -->
        <ListView x:Name="DataListView"
                  Grid.Row="2"
                  SelectionMode="{x:Bind SelectionMode, Mode=OneWay}"
                  MaxHeight="{x:Bind MaxTableHeight, Mode=OneWay}"
                  Background="{StaticResource ConsoleBackgroundMediumBrush}"
                  BorderBrush="{StaticResource ConsoleBorderBrush}"
                  BorderThickness="1,0,1,1"
                  CornerRadius="0,0,8,8"
                  SelectionChanged="DataListView_SelectionChanged"
                  RightTapped="DataListView_RightTapped">
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    <Setter Property="Padding" Value="12,8" />
                    <Setter Property="MinHeight" Value="44" />
                </Style>
            </ListView.ItemContainerStyle>
        </ListView>

        <!-- Empty State -->
        <Border x:Name="EmptyState"
                Grid.Row="2"
                Background="{StaticResource ConsoleBackgroundMediumBrush}"
                BorderBrush="{StaticResource ConsoleBorderBrush}"
                BorderThickness="1,0,1,1"
                CornerRadius="0,0,8,8"
                Visibility="Collapsed"
                Padding="24">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="8">
                <FontIcon x:Name="EmptyIcon"
                          Glyph="&#xE7BA;"
                          FontSize="32"
                          Foreground="{StaticResource ConsoleTextMutedBrush}" />
                <TextBlock x:Name="EmptyText"
                           Text="{x:Bind EmptyMessage, Mode=OneWay}"
                           Foreground="{StaticResource ConsoleTextMutedBrush}"
                           FontStyle="Italic"
                           HorizontalAlignment="Center" />
                <Button x:Name="EmptyActionButton"
                        Content="{x:Bind EmptyActionText, Mode=OneWay}"
                        Click="EmptyActionButton_Click"
                        Visibility="{x:Bind EmptyActionVisibility, Mode=OneWay}"
                        Margin="0,8,0,0" />
            </StackPanel>
        </Border>

        <!-- Footer with Pagination -->
        <Grid x:Name="FooterGrid"
              Grid.Row="3"
              Margin="0,8,0,0"
              Visibility="{x:Bind FooterVisibility, Mode=OneWay}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Selection Info -->
            <TextBlock x:Name="SelectionInfoText"
                       Grid.Column="0"
                       Text="{x:Bind SelectionInfoDisplay, Mode=OneWay}"
                       FontSize="12"
                       Foreground="{StaticResource ConsoleTextSecondaryBrush}"
                       VerticalAlignment="Center" />

            <!-- Pagination Controls -->
            <StackPanel x:Name="PaginationControls"
                        Grid.Column="1"
                        Orientation="Horizontal"
                        Spacing="8"
                        Visibility="{x:Bind PaginationVisibility, Mode=OneWay}">
                <Button x:Name="PrevPageButton"
                        Click="PrevPage_Click"
                        IsEnabled="{x:Bind CanGoPrev, Mode=OneWay}"
                        Padding="8,4">
                    <FontIcon Glyph="&#xE76B;" FontSize="12" />
                </Button>
                <TextBlock x:Name="PageInfoText"
                           Text="{x:Bind PageInfoDisplay, Mode=OneWay}"
                           FontSize="12"
                           VerticalAlignment="Center"
                           Foreground="{StaticResource ConsoleTextSecondaryBrush}" />
                <Button x:Name="NextPageButton"
                        Click="NextPage_Click"
                        IsEnabled="{x:Bind CanGoNext, Mode=OneWay}"
                        Padding="8,4">
                    <FontIcon Glyph="&#xE76C;" FontSize="12" />
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
