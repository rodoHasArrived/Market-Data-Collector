<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="MarketDataCollector.Uwp.Controls.ProgressCard"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MarketDataCollector.Uwp.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Border x:Name="CardBorder"
            Style="{StaticResource CardStyle}"
            AutomationProperties.Name="{x:Bind Title, Mode=OneWay}">
        <Grid RowSpacing="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Header Row: Title + Status -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="10">
                    <!-- Optional Icon -->
                    <FontIcon x:Name="TitleIcon"
                              Glyph="{x:Bind IconGlyph, Mode=OneWay}"
                              FontSize="16"
                              Foreground="{StaticResource ConsoleTextSecondaryBrush}"
                              Visibility="{x:Bind IconVisibility, Mode=OneWay}"
                              VerticalAlignment="Center" />

                    <TextBlock Text="{x:Bind Title, Mode=OneWay}"
                               Style="{StaticResource CardHeaderStyle}"
                               VerticalAlignment="Center" />
                </StackPanel>

                <!-- Status Badge -->
                <Border x:Name="StatusBadge"
                        Grid.Column="1"
                        CornerRadius="4"
                        Padding="10,5"
                        VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <ProgressRing x:Name="StatusSpinner"
                                      Width="12" Height="12"
                                      IsActive="{x:Bind IsIndeterminate, Mode=OneWay}"
                                      Visibility="{x:Bind SpinnerVisibility, Mode=OneWay}" />
                        <TextBlock x:Name="StatusText"
                                   Text="{x:Bind StatusLabel, Mode=OneWay}"
                                   FontSize="12"
                                   FontWeight="SemiBold" />
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Progress Bar -->
            <Grid Grid.Row="1" RowSpacing="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ProgressBar x:Name="MainProgressBar"
                             Grid.Row="0"
                             Value="{x:Bind Progress, Mode=OneWay}"
                             Maximum="{x:Bind Maximum, Mode=OneWay}"
                             IsIndeterminate="{x:Bind IsIndeterminate, Mode=OneWay}"
                             Height="8"
                             CornerRadius="4" />

                <!-- Progress Stats Row -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="{x:Bind ProgressText, Mode=OneWay}"
                               FontSize="12"
                               Foreground="{StaticResource ConsoleTextSecondaryBrush}"
                               FontFamily="Cascadia Code, Consolas, monospace" />

                    <TextBlock Grid.Column="1"
                               Text="{x:Bind PercentageText, Mode=OneWay}"
                               FontSize="12"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource ConsoleTextPrimaryBrush}"
                               FontFamily="Cascadia Code, Consolas, monospace" />
                </Grid>
            </Grid>

            <!-- Stats Grid (3 columns) -->
            <Grid x:Name="StatsGrid"
                  Grid.Row="2"
                  Visibility="{x:Bind StatsVisibility, Mode=OneWay}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Stat 1: Elapsed -->
                <StackPanel Grid.Column="0" Spacing="2">
                    <TextBlock Text="ELAPSED"
                               Style="{StaticResource DataLabelStyle}" />
                    <TextBlock Text="{x:Bind ElapsedTime, Mode=OneWay}"
                               FontSize="14"
                               FontWeight="SemiBold"
                               FontFamily="Cascadia Code, Consolas, monospace"
                               Foreground="{StaticResource ConsoleTextPrimaryBrush}" />
                </StackPanel>

                <!-- Stat 2: Rate -->
                <StackPanel Grid.Column="1" Spacing="2" HorizontalAlignment="Center">
                    <TextBlock Text="RATE"
                               Style="{StaticResource DataLabelStyle}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{x:Bind RateText, Mode=OneWay}"
                               FontSize="14"
                               FontWeight="SemiBold"
                               FontFamily="Cascadia Code, Consolas, monospace"
                               Foreground="{StaticResource ConsoleTextPrimaryBrush}"
                               HorizontalAlignment="Center" />
                </StackPanel>

                <!-- Stat 3: Remaining -->
                <StackPanel Grid.Column="2" Spacing="2" HorizontalAlignment="Right">
                    <TextBlock Text="REMAINING"
                               Style="{StaticResource DataLabelStyle}"
                               HorizontalAlignment="Right" />
                    <TextBlock Text="{x:Bind RemainingTime, Mode=OneWay}"
                               FontSize="14"
                               FontWeight="SemiBold"
                               FontFamily="Cascadia Code, Consolas, monospace"
                               Foreground="{StaticResource ConsoleTextPrimaryBrush}"
                               HorizontalAlignment="Right" />
                </StackPanel>
            </Grid>

            <!-- Optional Description/Details -->
            <TextBlock x:Name="DetailsText"
                       Grid.Row="3"
                       Text="{x:Bind Details, Mode=OneWay}"
                       FontSize="12"
                       Foreground="{StaticResource ConsoleTextMutedBrush}"
                       TextWrapping="Wrap"
                       Visibility="{x:Bind DetailsVisibility, Mode=OneWay}" />
        </Grid>
    </Border>
</UserControl>
