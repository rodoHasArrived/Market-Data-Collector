<Page x:Class="MarketDataCollector.Wpf.Views.SetupWizardPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="{DynamicResource ConsoleBackgroundDarkBrush}"
      Loaded="OnPageLoaded">
    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24">
        <StackPanel MaxWidth="1200">
            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                <TextBlock Text="&#xE8D2;" FontFamily="{StaticResource SymbolThemeFontFamily}"
                           FontSize="28" Foreground="{StaticResource InfoColorBrush}" VerticalAlignment="Center" />
                <TextBlock Text="Setup Wizard" Style="{StaticResource PageTitleStyle}" Margin="12,0,0,0" VerticalAlignment="Center" />
            </StackPanel>
            <TextBlock Text="Let’s get your backend connection and configuration ready. Follow each step, then save &amp; continue."
                       Foreground="{StaticResource ConsoleTextMutedBrush}" Margin="0,0,0,24" />

            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="Step 1 · Connect to the backend service" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,12" />
                    <TextBlock Text="The app connects to http://localhost:8080. Check that the backend is running before continuing."
                               Foreground="{StaticResource ConsoleTextSecondaryBrush}" Margin="0,0,0,16" />

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <Ellipse x:Name="BackendStatusDot" Width="10" Height="10" Margin="0,0,8,0"
                                 Fill="{StaticResource ConsoleTextMutedBrush}" VerticalAlignment="Center" />
                        <TextBlock x:Name="BackendStatusText" Text="Checking backend status..."
                                   Foreground="{StaticResource ConsoleTextPrimaryBrush}" VerticalAlignment="Center" />
                    </StackPanel>
                    <TextBlock x:Name="BackendStatusDetailText" Text="No connection check performed yet."
                               Foreground="{StaticResource ConsoleTextMutedBrush}" Margin="0,0,0,16" />

                    <WrapPanel>
                        <Button Content="Test Connection"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Margin="0,0,12,0"
                                Click="TestConnection_Click" />
                        <Button Content="Start Backend"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Margin="0,0,12,0"
                                Click="StartBackend_Click" />
                        <Button Content="Open Instructions"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Click="OpenInstructions_Click" />
                    </WrapPanel>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="Step 2 · Choose your workflow (optional)" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,12" />
                    <TextBlock Text="Select a preset that matches your use case. This pre-configures symbols, providers, and settings for your workflow."
                               Foreground="{StaticResource ConsoleTextSecondaryBrush}" Margin="0,0,0,16" />

                    <ItemsControl x:Name="PresetsList">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="2" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Margin="0,0,8,8"
                                        Click="PresetCard_Click"
                                        Tag="{Binding Id}"
                                        HorizontalContentAlignment="Stretch">
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource SecondaryButtonStyle}">
                                            <Setter Property="Padding" Value="16,12" />
                                            <Setter Property="HorizontalAlignment" Value="Stretch" />
                                        </Style>
                                    </Button.Style>
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                            <TextBlock Text="{Binding Icon}" FontFamily="{StaticResource SymbolThemeFontFamily}"
                                                       FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0" />
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="14" VerticalAlignment="Center" />
                                        </StackPanel>
                                        <TextBlock Text="{Binding Description}" TextWrapping="Wrap"
                                                   Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="12" />
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <TextBlock x:Name="PresetStatusText"
                               Foreground="{StaticResource ConsoleTextMutedBrush}" Margin="0,8,0,0" />
                </StackPanel>
            </Border>

            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="Step 3 · Configure providers and storage" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,12" />
                    <TextBlock Text="Choose your default data provider and where data will be stored."
                               Foreground="{StaticResource ConsoleTextSecondaryBrush}" Margin="0,0,0,16" />

                    <StackPanel Margin="0,0,0,12">
                        <TextBlock Text="Configuration file" Style="{StaticResource FormLabelStyle}" Margin="0,0,0,4" />
                        <TextBlock x:Name="ConfigPathText" Foreground="{StaticResource ConsoleTextMutedBrush}" />
                    </StackPanel>

                    <StackPanel Margin="0,0,0,12">
                        <TextBlock Text="Default provider" Style="{StaticResource FormLabelStyle}" Margin="0,0,0,4" />
                        <ComboBox x:Name="ProviderCombo"
                                  Style="{StaticResource FormComboBoxStyle}" />
                    </StackPanel>

                    <StackPanel Margin="0,0,0,12">
                        <TextBlock Text="Storage location" Style="{StaticResource FormLabelStyle}" Margin="0,0,0,4" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="StorageLocationTextBox"
                                     Style="{StaticResource FormTextBoxStyle}"
                                     Grid.Column="0"
                                     Margin="0,0,12,0" />
                            <Button Content="Use Default"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Grid.Column="1"
                                    Click="UseDefaultStorage_Click" />
                        </Grid>
                    </StackPanel>
                    <TextBlock x:Name="ConfigStatusText"
                               Foreground="{StaticResource ConsoleTextMutedBrush}" />
                </StackPanel>
            </Border>

            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="Step 4 · Add API keys (optional)" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,12" />
                    <TextBlock Text="Provide API keys for premium providers. Keys are stored in your user environment variables."
                               Foreground="{StaticResource ConsoleTextSecondaryBrush}" Margin="0,0,0,16" />

                    <StackPanel Margin="0,0,0,12">
                        <TextBlock Text="Nasdaq Data Link API key" Style="{StaticResource FormLabelStyle}" Margin="0,0,0,4" />
                        <TextBox x:Name="NasdaqApiKeyTextBox" Style="{StaticResource FormTextBoxStyle}" />
                    </StackPanel>

                    <StackPanel Margin="0,0,0,16">
                        <TextBlock Text="OpenFIGI API key (optional)" Style="{StaticResource FormLabelStyle}" Margin="0,0,0,4" />
                        <TextBox x:Name="OpenFigiApiKeyTextBox" Style="{StaticResource FormTextBoxStyle}" />
                    </StackPanel>

                    <TextBlock x:Name="ValidationStatusText"
                               Foreground="{StaticResource ConsoleTextMutedBrush}" Margin="0,0,0,16" />

                    <WrapPanel>
                        <Button Content="Save &amp; Continue"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Click="SaveAndContinue_Click" />
                    </WrapPanel>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</Page>
