<Page x:Class="MarketDataCollector.Wpf.Views.TimeSeriesAlignmentPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="{DynamicResource ConsoleBackgroundDarkBrush}"
      Loaded="OnPageLoaded">
    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24">
        <StackPanel MaxWidth="1200">
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="&#xE9D9;" FontFamily="{StaticResource SymbolThemeFontFamily}"
                           FontSize="28" Foreground="{StaticResource InfoColorBrush}" VerticalAlignment="Center" />
                <TextBlock Text="Time Series Alignment" Style="{StaticResource PageTitleStyle}" Margin="12,0,0,0" VerticalAlignment="Center" />
            </StackPanel>
            <TextBlock Text="Align multi-symbol time series data for cross-sectional analysis, correlation studies, and paired analysis."
                       Style="{StaticResource PageSubtitleStyle}" Margin="0,0,0,20" />

            <!-- Alignment Configuration -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                <StackPanel>
                    <TextBlock Text="Alignment Configuration" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,16" />

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Margin="0,0,16,8">
                            <TextBlock Text="Alignment Name" Style="{StaticResource FormLabelStyle}" />
                            <TextBox x:Name="AlignmentNameBox" Style="{StaticResource FormTextBoxStyle}" />
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="0,0,16,8">
                            <TextBlock Text="Target Frequency" Style="{StaticResource FormLabelStyle}" />
                            <ComboBox x:Name="FrequencyCombo" Style="{StaticResource FormComboBoxStyle}" SelectedIndex="2">
                                <ComboBoxItem Content="1 Second" Tag="1s" />
                                <ComboBoxItem Content="1 Minute" Tag="1m" />
                                <ComboBoxItem Content="5 Minutes" Tag="5m" />
                                <ComboBoxItem Content="15 Minutes" Tag="15m" />
                                <ComboBoxItem Content="1 Hour" Tag="1h" />
                                <ComboBoxItem Content="Daily" Tag="1d" />
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Grid.Column="2" Margin="0,0,0,8">
                            <TextBlock Text="Preset" Style="{StaticResource FormLabelStyle}" />
                            <ComboBox x:Name="PresetCombo" Style="{StaticResource FormComboBoxStyle}" SelectedIndex="0" SelectionChanged="Preset_SelectionChanged">
                                <ComboBoxItem Content="Cross-Sectional Snapshot" Tag="cross-sectional" />
                                <ComboBoxItem Content="Correlation Study" Tag="correlation" />
                                <ComboBoxItem Content="Pairs Trading" Tag="pairs" />
                                <ComboBoxItem Content="Index Rebalance" Tag="rebalance" />
                                <ComboBoxItem Content="Custom" Tag="custom" />
                            </ComboBox>
                        </StackPanel>
                    </Grid>

                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <StackPanel Margin="0,0,8,0">
                            <TextBlock Text="From Date" Style="{StaticResource FormLabelStyle}" />
                            <DatePicker x:Name="FromDatePicker" />
                        </StackPanel>
                        <StackPanel Grid.Column="1" Margin="8,0,0,0">
                            <TextBlock Text="To Date" Style="{StaticResource FormLabelStyle}" />
                            <DatePicker x:Name="ToDatePicker" />
                        </StackPanel>
                    </Grid>

                    <TextBlock Text="Symbols (comma-separated)" Style="{StaticResource FormLabelStyle}" />
                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="SymbolsBox" Style="{StaticResource FormTextBoxStyle}" />
                        <Button Grid.Column="1" Content="Add" Click="AddSymbols_Click" Style="{StaticResource FormButtonStyle}" Margin="8,0,0,0" />
                    </Grid>

                    <ItemsControl x:Name="SelectedSymbolsList" Margin="0,0,0,8">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource ConsoleBackgroundBrush}" CornerRadius="4" Padding="8,4" Margin="0,0,4,4">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding}" FontFamily="Consolas" Foreground="{DynamicResource ConsoleTextBrush}" />
                                        <Button Content=" x" Click="RemoveSymbol_Click" Tag="{Binding}" FontSize="10"
                                                Background="Transparent" BorderThickness="0" Foreground="{StaticResource ConsoleTextMutedBrush}" Cursor="Hand" Margin="4,0,0,0" />
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <!-- Alignment Options -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                <StackPanel>
                    <TextBlock Text="Alignment Options" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,16" />

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Margin="0,0,16,0">
                            <TextBlock Text="Gap Handling" Style="{StaticResource FormLabelStyle}" />
                            <ComboBox x:Name="GapHandlingCombo" Style="{StaticResource FormComboBoxStyle}" SelectedIndex="0" Margin="0,0,0,8">
                                <ComboBoxItem Content="Forward Fill" Tag="ffill" />
                                <ComboBoxItem Content="Backward Fill" Tag="bfill" />
                                <ComboBoxItem Content="Interpolate" Tag="interpolate" />
                                <ComboBoxItem Content="Drop Rows" Tag="drop" />
                                <ComboBoxItem Content="Zero Fill" Tag="zero" />
                            </ComboBox>

                            <TextBlock Text="Timezone" Style="{StaticResource FormLabelStyle}" />
                            <ComboBox x:Name="TimezoneCombo" Style="{StaticResource FormComboBoxStyle}" SelectedIndex="0" Margin="0,0,0,8">
                                <ComboBoxItem Content="UTC" Tag="UTC" />
                                <ComboBoxItem Content="US/Eastern" Tag="US/Eastern" />
                                <ComboBoxItem Content="US/Pacific" Tag="US/Pacific" />
                                <ComboBoxItem Content="Europe/London" Tag="Europe/London" />
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="16,0,0,0">
                            <TextBlock Text="Data Fields" Style="{StaticResource FormLabelStyle}" />
                            <CheckBox x:Name="IncludeCloseCheck" Content="Close" IsChecked="True" Foreground="{DynamicResource ConsoleTextBrush}" Margin="0,0,0,4" />
                            <CheckBox x:Name="IncludeOpenCheck" Content="Open" IsChecked="True" Foreground="{DynamicResource ConsoleTextBrush}" Margin="0,0,0,4" />
                            <CheckBox x:Name="IncludeHighCheck" Content="High" Foreground="{DynamicResource ConsoleTextBrush}" Margin="0,0,0,4" />
                            <CheckBox x:Name="IncludeLowCheck" Content="Low" Foreground="{DynamicResource ConsoleTextBrush}" Margin="0,0,0,4" />
                            <CheckBox x:Name="IncludeVolumeCheck" Content="Volume" IsChecked="True" Foreground="{DynamicResource ConsoleTextBrush}" Margin="0,0,0,4" />
                        </StackPanel>
                    </Grid>

                    <TextBlock Text="Export Format" Style="{StaticResource FormLabelStyle}" Margin="0,8,0,0" />
                    <ComboBox x:Name="ExportFormatCombo" Style="{StaticResource FormComboBoxStyle}" SelectedIndex="0" Margin="0,0,0,8">
                        <ComboBoxItem Content="CSV" Tag="Csv" />
                        <ComboBoxItem Content="Parquet" Tag="Parquet" />
                        <ComboBoxItem Content="JSON Lines" Tag="JsonLines" />
                    </ComboBox>
                </StackPanel>
            </Border>

            <!-- Actions -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="Run Alignment" Click="RunAlignment_Click" Style="{StaticResource FormButtonStyle}" />
                        <Button Content="Save Preset" Click="SavePreset_Click" Style="{StaticResource FormButtonStyle}" Margin="8,0,0,0" />
                        <TextBlock x:Name="StatusText" VerticalAlignment="Center" Margin="16,0,0,0"
                                   Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="12" />
                    </StackPanel>

                    <ProgressBar x:Name="AlignmentProgress" Minimum="0" Maximum="100" Value="0" Visibility="Collapsed" Margin="0,8,0,0" />
                </StackPanel>
            </Border>

            <!-- Results -->
            <Border x:Name="ResultsCard" Style="{StaticResource CardStyle}" Margin="0,0,0,16" Visibility="Collapsed">
                <StackPanel>
                    <TextBlock Text="Alignment Results" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,12" />
                    <UniformGrid Columns="4" Margin="0,0,0,12">
                        <StackPanel>
                            <TextBlock x:Name="ResultRowsText" Text="--" FontSize="20" FontWeight="Bold" Foreground="{StaticResource InfoColorBrush}" />
                            <TextBlock Text="Aligned Rows" Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="11" />
                        </StackPanel>
                        <StackPanel>
                            <TextBlock x:Name="ResultSymbolsText" Text="--" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource ConsoleTextBrush}" />
                            <TextBlock Text="Symbols" Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="11" />
                        </StackPanel>
                        <StackPanel>
                            <TextBlock x:Name="ResultGapsText" Text="--" FontSize="20" FontWeight="Bold" Foreground="{StaticResource WarningColorBrush}" />
                            <TextBlock Text="Gaps Filled" Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="11" />
                        </StackPanel>
                        <StackPanel>
                            <TextBlock x:Name="ResultFileSizeText" Text="--" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource ConsoleTextBrush}" />
                            <TextBlock Text="Output Size" Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="11" />
                        </StackPanel>
                    </UniformGrid>
                    <TextBlock x:Name="ResultOutputPathText" FontSize="12" Foreground="{StaticResource ConsoleTextMutedBrush}" TextWrapping="Wrap" />
                </StackPanel>
            </Border>

            <!-- Recent Alignments -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="Recent Alignments" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,12" />
                    <ItemsControl x:Name="RecentAlignmentsList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="8,6" Margin="0,0,0,4" BorderBrush="{DynamicResource ConsoleBackgroundBrush}" BorderThickness="0,0,0,1">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="{Binding Name}" FontWeight="SemiBold" Foreground="{DynamicResource ConsoleTextBrush}" />
                                        <TextBlock Grid.Column="1" Text="{Binding DetailsText}" Foreground="{StaticResource ConsoleTextMutedBrush}" Margin="16,0" FontSize="12" />
                                        <TextBlock Grid.Column="2" Text="{Binding DateText}" Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="11" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <TextBlock x:Name="NoAlignmentsText" Text="No recent alignments." Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="12" />
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</Page>
