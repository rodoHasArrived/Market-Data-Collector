<Page x:Class="MarketDataCollector.Wpf.Views.DataExportPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      mc:Ignorable="d"
      Background="{DynamicResource ConsoleBackgroundDarkBrush}"
      Loaded="OnPageLoaded">
    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24">
        <StackPanel MaxWidth="1100">
            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                <TextBlock Text="&#xEDE1;" FontFamily="{StaticResource SymbolThemeFontFamily}"
                           FontSize="28" Foreground="{StaticResource InfoColorBrush}" VerticalAlignment="Center" />
                <TextBlock Text="Data Export &amp; Integration" Style="{StaticResource PageTitleStyle}"
                           Margin="12,0,0,0" VerticalAlignment="Center" />
            </StackPanel>
            <TextBlock Text="Export collected market data to various formats and integrate with external systems."
                       Style="{StaticResource PageSubtitleStyle}" />

            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <TextBlock Text="{StaticResource IconExport}"
                                   FontFamily="{StaticResource SymbolThemeFontFamily}"
                                   FontSize="18" Foreground="{StaticResource InfoColorBrush}"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="Quick Export" Style="{StaticResource CardHeaderStyle}" Margin="8,0,0,0" />
                    </StackPanel>

                    <Grid ColumnSpacing="16" RowSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Grid.Column="0">
                            <TextBlock Text="Symbols" Style="{StaticResource FormLabelStyle}" />
                            <StackPanel Orientation="Horizontal">
                                <TextBox x:Name="SymbolSearchBox"
                                         Style="{StaticResource FormTextBoxStyle}"
                                         MinWidth="140" />
                                <Button Content="Add"
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        Margin="8,0,0,0"
                                        Click="AddSymbol_Click" />
                            </StackPanel>
                            <ListBox x:Name="SelectedSymbolsList"
                                     ItemsSource="{Binding SelectedSymbols}"
                                     Height="120"
                                     Margin="0,8,0,0" />
                            <TextBlock x:Name="SymbolsValidationError"
                                       Foreground="{StaticResource ErrorColorBrush}"
                                       FontSize="11"
                                       Visibility="Collapsed"
                                       Margin="0,4,0,0" />
                        </StackPanel>

                        <StackPanel Grid.Row="0" Grid.Column="1">
                            <TextBlock Text="Date Range" Style="{StaticResource FormLabelStyle}" />
                            <DatePicker x:Name="ExportFromDate" Margin="0,0,0,8" />
                            <DatePicker x:Name="ExportToDate" />
                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                <Button Content="Today" Click="SetToday_Click" Margin="0,0,8,0" />
                                <Button Content="Week" Click="SetWeek_Click" Margin="0,0,8,0" />
                                <Button Content="Month" Click="SetMonth_Click" />
                            </StackPanel>
                            <TextBlock x:Name="DateValidationError"
                                       Foreground="{StaticResource ErrorColorBrush}"
                                       FontSize="11"
                                       Visibility="Collapsed"
                                       Margin="0,4,0,0" />
                        </StackPanel>

                        <StackPanel Grid.Row="0" Grid.Column="2">
                            <TextBlock Text="Data Types" Style="{StaticResource FormLabelStyle}" />
                            <CheckBox x:Name="ExportTradesCheck" Content="Trades" IsChecked="True"
                                      Foreground="{StaticResource ConsoleTextPrimaryBrush}" />
                            <CheckBox x:Name="ExportDepthCheck" Content="Order Book Depth" IsChecked="True"
                                      Foreground="{StaticResource ConsoleTextPrimaryBrush}" />
                            <CheckBox x:Name="ExportQuotesCheck" Content="BBO Quotes"
                                      Foreground="{StaticResource ConsoleTextPrimaryBrush}" />
                            <CheckBox x:Name="ExportBarsCheck" Content="Historical Bars"
                                      Foreground="{StaticResource ConsoleTextPrimaryBrush}" />
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="0">
                            <TextBlock Text="Export Format" Style="{StaticResource FormLabelStyle}" />
                            <ComboBox x:Name="ExportFormatCombo" Style="{StaticResource FormComboBoxStyle}">
                                <ComboBoxItem Content="CSV (Comma-Separated)" Tag="csv" />
                                <ComboBoxItem Content="Parquet (Columnar)" Tag="parquet" />
                                <ComboBoxItem Content="JSON Lines" Tag="jsonl" />
                                <ComboBoxItem Content="HDF5 (Hierarchical)" Tag="hdf5" />
                                <ComboBoxItem Content="Feather (Arrow IPC)" Tag="feather" />
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="1">
                            <TextBlock Text="Compression" Style="{StaticResource FormLabelStyle}" />
                            <ComboBox x:Name="CompressionCombo" Style="{StaticResource FormComboBoxStyle}">
                                <ComboBoxItem Content="None" Tag="none" />
                                <ComboBoxItem Content="Gzip" Tag="gzip" />
                                <ComboBoxItem Content="LZ4 (Fast)" Tag="lz4" />
                                <ComboBoxItem Content="Zstd (Best)" Tag="zstd" />
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Bottom">
                            <Button x:Name="ExportButton"
                                    Content="Export Data"
                                    Style="{StaticResource AccentButtonStyle}"
                                    Click="ExportData_Click" />
                            <ProgressBar x:Name="ExportProgress"
                                         Width="120"
                                         Height="8"
                                         Margin="12,8,0,0"
                                         Visibility="Collapsed" />
                        </StackPanel>
                    </Grid>

                    <StackPanel x:Name="ExportProgressPanel" Visibility="Collapsed" Margin="0,16,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock x:Name="ExportProgressLabel" Grid.Column="0" Text="Exporting..." />
                            <TextBlock x:Name="ExportProgressPercent" Grid.Column="1" Text="0%" />
                        </Grid>
                        <ProgressBar x:Name="ExportProgressBar" Minimum="0" Maximum="100" Value="0" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <TextBlock Text="{StaticResource IconDatabase}"
                                   FontFamily="{StaticResource SymbolThemeFontFamily}"
                                   FontSize="18" Foreground="{StaticResource InfoColorBrush}"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="Database Export" Style="{StaticResource CardHeaderStyle}" Margin="8,0,0,0" />
                    </StackPanel>

                    <Border Background="{StaticResource ConsoleAccentBlueAlpha10Brush}"
                            CornerRadius="6"
                            Padding="8"
                            Margin="0,0,0,12">
                        <TextBlock Text="Export market data directly to your database for analysis and backtesting."
                                   Foreground="{StaticResource ConsoleTextSecondaryBrush}" />
                    </Border>

                    <Grid ColumnSpacing="16" RowSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Grid.Column="0">
                            <TextBlock Text="Database Type" Style="{StaticResource FormLabelStyle}" />
                            <ComboBox x:Name="DatabaseTypeCombo"
                                      Style="{StaticResource FormComboBoxStyle}"
                                      SelectionChanged="DatabaseType_SelectionChanged">
                                <ComboBoxItem Content="PostgreSQL" Tag="postgresql" />
                                <ComboBoxItem Content="TimescaleDB" Tag="timescaledb" />
                                <ComboBoxItem Content="ClickHouse" Tag="clickhouse" />
                                <ComboBoxItem Content="QuestDB" Tag="questdb" />
                                <ComboBoxItem Content="InfluxDB" Tag="influxdb" />
                                <ComboBoxItem Content="SQLite" Tag="sqlite" />
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Grid.Row="0" Grid.Column="1">
                            <TextBlock Text="Host" Style="{StaticResource FormLabelStyle}" />
                            <TextBox x:Name="DatabaseHostBox" Style="{StaticResource FormTextBoxStyle}" />
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="0">
                            <TextBlock Text="Port" Style="{StaticResource FormLabelStyle}" />
                            <TextBox x:Name="DatabasePortBox" Style="{StaticResource FormTextBoxStyle}" />
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="1">
                            <TextBlock Text="Database Name" Style="{StaticResource FormLabelStyle}" />
                            <TextBox x:Name="DatabaseNameBox" Style="{StaticResource FormTextBoxStyle}" />
                        </StackPanel>

                        <StackPanel Grid.Row="2" Grid.Column="0">
                            <TextBlock Text="Username" Style="{StaticResource FormLabelStyle}" />
                            <TextBox x:Name="DatabaseUserBox" Style="{StaticResource FormTextBoxStyle}" />
                        </StackPanel>

                        <StackPanel Grid.Row="2" Grid.Column="1">
                            <TextBlock Text="Password" Style="{StaticResource FormLabelStyle}" />
                            <StackPanel Orientation="Horizontal">
                                <Button Content="Set Credentials"
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        Click="SetDatabaseCredentials_Click" />
                                <TextBlock x:Name="DbCredentialStatus"
                                           Text="Not configured"
                                           Foreground="{StaticResource ConsoleTextSecondaryBrush}"
                                           Margin="8,6,0,0" />
                            </StackPanel>
                        </StackPanel>
                    </Grid>

                    <StackPanel Orientation="Horizontal" Margin="0,16,0,0">
                        <Button Content="Test Connection" Click="TestDatabaseConnection_Click" />
                        <Button Content="Configure Sync" Click="ConfigureDatabaseSync_Click"
                                Style="{StaticResource AccentButtonStyle}"
                                Margin="12,0,0,0" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <TextBlock Text="{StaticResource IconSchedule}"
                                   FontFamily="{StaticResource SymbolThemeFontFamily}"
                                   FontSize="18" Foreground="{StaticResource InfoColorBrush}"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="Scheduled Exports" Style="{StaticResource CardHeaderStyle}" Margin="8,0,0,0" />
                    </StackPanel>

                    <CheckBox x:Name="EnableScheduledExportsToggle"
                              Content="Enable Scheduled Exports"
                              Foreground="{StaticResource ConsoleTextPrimaryBrush}"
                              Checked="EnableScheduledExportsToggle_Changed"
                              Unchecked="EnableScheduledExportsToggle_Changed" />

                    <Grid x:Name="ScheduledExportsPanel" ColumnSpacing="16" RowSpacing="16" Margin="0,12,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Frequency" Style="{StaticResource FormLabelStyle}" />
                            <ComboBox x:Name="ScheduleFrequencyCombo" Style="{StaticResource FormComboBoxStyle}">
                                <ComboBoxItem Content="Hourly" Tag="hourly" />
                                <ComboBoxItem Content="Daily" Tag="daily" />
                                <ComboBoxItem Content="Weekly" Tag="weekly" />
                                <ComboBoxItem Content="Monthly" Tag="monthly" />
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Grid.Column="1">
                            <TextBlock Text="Time (Local)" Style="{StaticResource FormLabelStyle}" />
                            <TextBox x:Name="ScheduleTimeBox"
                                     Style="{StaticResource FormTextBoxStyle}"
                                     TextChanged="ScheduleTimeBox_TextChanged" />
                            <TextBlock x:Name="ScheduleTimeError"
                                       Foreground="{StaticResource ErrorColorBrush}"
                                       FontSize="11"
                                       Visibility="Collapsed"
                                       Margin="0,4,0,0" />
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Destination Path" Style="{StaticResource FormLabelStyle}" />
                            <TextBox x:Name="ExportDestinationBox" Style="{StaticResource FormTextBoxStyle}" />
                        </StackPanel>
                    </Grid>

                    <Expander Header="Email Delivery (Optional)" IsExpanded="False" Margin="0,12,0,0">
                        <StackPanel Margin="0,8,0,0">
                            <TextBlock Text="Recipients (comma-separated)" Style="{StaticResource FormLabelStyle}" />
                            <TextBox x:Name="EmailRecipientsBox" Style="{StaticResource FormTextBoxStyle}" />

                            <TextBlock Text="Subject Template" Style="{StaticResource FormLabelStyle}" Margin="0,12,0,0" />
                            <TextBox x:Name="EmailSubjectBox" Style="{StaticResource FormTextBoxStyle}" />

                            <CheckBox x:Name="AttachExportCheck"
                                      Content="Attach export file (if under 25MB)"
                                      Foreground="{StaticResource ConsoleTextPrimaryBrush}"
                                      Margin="0,8,0,0" />
                        </StackPanel>
                    </Expander>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <TextBlock Text="{StaticResource IconLink}"
                                   FontFamily="{StaticResource SymbolThemeFontFamily}"
                                   FontSize="18" Foreground="{StaticResource InfoColorBrush}"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="Webhook Integration" Style="{StaticResource CardHeaderStyle}" Margin="8,0,0,0" />
                    </StackPanel>

                    <TextBlock Text="Send real-time events to external systems via webhooks."
                               Foreground="{StaticResource ConsoleTextSecondaryBrush}" />

                    <CheckBox x:Name="EnableWebhooksToggle"
                              Content="Enable Webhooks"
                              Foreground="{StaticResource ConsoleTextPrimaryBrush}"
                              Margin="0,8,0,0" />

                    <TextBlock Text="Webhook URL" Style="{StaticResource FormLabelStyle}" Margin="0,12,0,0" />
                    <TextBox x:Name="WebhookUrlBox" Style="{StaticResource FormTextBoxStyle}" />

                    <Grid ColumnSpacing="16" Margin="0,12,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Payload Format" Style="{StaticResource FormLabelStyle}" />
                            <ComboBox x:Name="WebhookFormatCombo" Style="{StaticResource FormComboBoxStyle}">
                                <ComboBoxItem Content="JSON" Tag="json" />
                                <ComboBoxItem Content="MessagePack" Tag="msgpack" />
                                <ComboBoxItem Content="Protobuf" Tag="protobuf" />
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Grid.Column="1">
                            <TextBlock Text="Batching" Style="{StaticResource FormLabelStyle}" />
                            <ComboBox x:Name="WebhookBatchCombo" Style="{StaticResource FormComboBoxStyle}">
                                <ComboBoxItem Content="Real-time (each event)" Tag="realtime" />
                                <ComboBoxItem Content="Micro-batch (100ms)" Tag="microbatch" />
                                <ComboBoxItem Content="Batch (1 second)" Tag="batch" />
                                <ComboBoxItem Content="Bulk (1 minute)" Tag="bulk" />
                            </ComboBox>
                        </StackPanel>
                    </Grid>

                    <TextBlock Text="Event Types to Send" Style="{StaticResource FormLabelStyle}" Margin="0,12,0,0" />
                    <StackPanel Orientation="Horizontal">
                        <CheckBox Content="Trades" IsChecked="True" Foreground="{StaticResource ConsoleTextPrimaryBrush}" Margin="0,0,12,0" />
                        <CheckBox Content="Quotes" IsChecked="True" Foreground="{StaticResource ConsoleTextPrimaryBrush}" Margin="0,0,12,0" />
                        <CheckBox Content="Depth Updates" Foreground="{StaticResource ConsoleTextPrimaryBrush}" Margin="0,0,12,0" />
                        <CheckBox Content="Integrity Alerts" IsChecked="True" Foreground="{StaticResource ConsoleTextPrimaryBrush}" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                        <Button Content="Test Webhook" Click="TestWebhook_Click" />
                        <TextBlock x:Name="WebhookTestResult"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource ConsoleTextSecondaryBrush}"
                                   Margin="12,0,0,0" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <TextBlock Text="{StaticResource IconIntegration}"
                                   FontFamily="{StaticResource SymbolThemeFontFamily}"
                                   FontSize="18" Foreground="{StaticResource InfoColorBrush}"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="QuantConnect Lean Export" Style="{StaticResource CardHeaderStyle}" Margin="8,0,0,0" />
                    </StackPanel>

                    <TextBlock Text="Export data in QuantConnect Lean format for algorithmic backtesting."
                               Foreground="{StaticResource ConsoleTextSecondaryBrush}" />

                    <Grid ColumnSpacing="16" Margin="0,12,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBox x:Name="LeanDataPathBox"
                                 Grid.Column="0"
                                 Style="{StaticResource FormTextBoxStyle}" />
                        <Button Grid.Column="1" Content="Browse..." Click="BrowseLeanPath_Click" Margin="8,0,0,0" />
                    </Grid>

                    <StackPanel Margin="0,12,0,0">
                        <TextBlock Text="Resolution" Style="{StaticResource FormLabelStyle}" />
                        <ComboBox x:Name="LeanResolutionCombo" Style="{StaticResource FormComboBoxStyle}">
                            <ComboBoxItem Content="Tick" Tag="tick" />
                            <ComboBoxItem Content="Second" Tag="second" />
                            <ComboBoxItem Content="Minute" Tag="minute" />
                            <ComboBoxItem Content="Hour" Tag="hour" />
                            <ComboBoxItem Content="Daily" Tag="daily" />
                        </ComboBox>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                        <Button Content="Export to Lean Format"
                                Style="{StaticResource AccentButtonStyle}"
                                Click="ExportToLean_Click" />
                        <Button Content="Verify Lean Data" Click="VerifyLeanData_Click" Margin="12,0,0,0" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <TextBlock Text="{StaticResource IconHistory}"
                                   FontFamily="{StaticResource SymbolThemeFontFamily}"
                                   FontSize="18" Foreground="{StaticResource InfoColorBrush}"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="Export History" Style="{StaticResource CardHeaderStyle}" Margin="8,0,0,0" />
                    </StackPanel>

                    <ListView x:Name="ExportHistoryList"
                              ItemsSource="{Binding ExportHistory}"
                              BorderThickness="0"
                              Background="Transparent"
                              MaxHeight="220">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Timestamp" DisplayMemberBinding="{Binding Timestamp}" Width="160" />
                                <GridViewColumn Header="Format" DisplayMemberBinding="{Binding Format}" Width="100" />
                                <GridViewColumn Header="Symbols" DisplayMemberBinding="{Binding SymbolCount}" Width="80" />
                                <GridViewColumn Header="Size" DisplayMemberBinding="{Binding Size}" Width="80" />
                                <GridViewColumn Header="Destination" DisplayMemberBinding="{Binding Destination}" Width="280" />
                            </GridView>
                        </ListView.View>
                    </ListView>

                    <TextBlock x:Name="NoExportHistoryText"
                               Text="No exports recorded yet."
                               Foreground="{StaticResource ConsoleTextSecondaryBrush}"
                               Margin="0,8,0,0" />
                </StackPanel>
            </Border>

            <Border x:Name="ActionInfoPanel"
                    Background="{StaticResource ConsoleBackgroundLightBrush}"
                    CornerRadius="8"
                    Padding="12"
                    Margin="0,24,0,0"
                    Visibility="Collapsed">
                <TextBlock x:Name="ActionInfoText"
                           Foreground="{StaticResource ConsoleTextPrimaryBrush}"
                           TextWrapping="Wrap" />
            </Border>
        </StackPanel>
    </ScrollViewer>
</Page>
