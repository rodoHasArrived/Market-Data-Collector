<Page x:Class="MarketDataCollector.Wpf.Views.OptionsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="{DynamicResource ConsoleBackgroundDarkBrush}"
      Loaded="OnPageLoaded">
    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24">
        <StackPanel MaxWidth="1200">

            <!-- Header -->
            <StackPanel Margin="0,0,0,24">
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                    <TextBlock Text="{StaticResource IconTrending}" FontFamily="{StaticResource SymbolThemeFontFamily}"
                               FontSize="28" Foreground="{StaticResource InfoColorBrush}" VerticalAlignment="Center" />
                    <TextBlock Text="Options Chain" Style="{StaticResource PageTitleStyle}" Margin="12,0,0,0" VerticalAlignment="Center" />
                </StackPanel>
                <TextBlock Text="View option chain data, expirations, strikes, and greeks for tracked underlying symbols"
                           Style="{StaticResource CardDescriptionStyle}" />
            </StackPanel>

            <!-- Summary Card -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="Options Summary" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,16" />
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="16" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="16" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="16" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- Tracked Contracts -->
                        <Border Grid.Column="0" Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock x:Name="TrackedContractsText" Text="--" FontSize="28" FontWeight="Bold"
                                           Foreground="{StaticResource InfoColorBrush}" HorizontalAlignment="Center" />
                                <TextBlock Text="Contracts" FontSize="12" Foreground="{StaticResource ConsoleTextMutedBrush}"
                                           HorizontalAlignment="Center" Margin="0,4,0,0" />
                            </StackPanel>
                        </Border>

                        <!-- Tracked Chains -->
                        <Border Grid.Column="2" Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock x:Name="TrackedChainsText" Text="--" FontSize="28" FontWeight="Bold"
                                           Foreground="{StaticResource SuccessColorBrush}" HorizontalAlignment="Center" />
                                <TextBlock Text="Chains" FontSize="12" Foreground="{StaticResource ConsoleTextMutedBrush}"
                                           HorizontalAlignment="Center" Margin="0,4,0,0" />
                            </StackPanel>
                        </Border>

                        <!-- Underlyings -->
                        <Border Grid.Column="4" Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock x:Name="TrackedUnderlyingsText" Text="--" FontSize="28" FontWeight="Bold"
                                           Foreground="{StaticResource WarningColorBrush}" HorizontalAlignment="Center" />
                                <TextBlock Text="Underlyings" FontSize="12" Foreground="{StaticResource ConsoleTextMutedBrush}"
                                           HorizontalAlignment="Center" Margin="0,4,0,0" />
                            </StackPanel>
                        </Border>

                        <!-- With Greeks -->
                        <Border Grid.Column="6" Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock x:Name="WithGreeksText" Text="--" FontSize="28" FontWeight="Bold"
                                           Foreground="{StaticResource ConsoleTextPrimaryBrush}" HorizontalAlignment="Center" />
                                <TextBlock Text="With Greeks" FontSize="12" Foreground="{StaticResource ConsoleTextMutedBrush}"
                                           HorizontalAlignment="Center" Margin="0,4,0,0" />
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Provider Status -->
                    <StackPanel Orientation="Horizontal" Margin="0,16,0,0">
                        <Ellipse x:Name="ProviderStatusDot" Width="8" Height="8" Margin="0,0,8,0"
                                 Fill="{StaticResource ConsoleTextMutedBrush}" VerticalAlignment="Center" />
                        <TextBlock x:Name="ProviderStatusText" Text="Provider status unknown"
                                   FontSize="12" Foreground="{StaticResource ConsoleTextMutedBrush}" VerticalAlignment="Center" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Symbol Lookup -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="Option Chain Lookup" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,16" />
                    <TextBlock Text="Enter an underlying symbol to view available expirations and option chains"
                               FontSize="12" Foreground="{StaticResource ConsoleTextMutedBrush}" Margin="0,0,0,12" />
                    <StackPanel Orientation="Horizontal">
                        <TextBox x:Name="SymbolInput" Width="160" Margin="0,0,12,0"
                                 Style="{StaticResource FormTextBoxStyle}"
                                 KeyDown="SymbolInput_KeyDown" />
                        <Button Content="Load Expirations" Click="LoadExpirations_Click"
                                Style="{StaticResource PrimaryButtonStyle}" />
                        <Button x:Name="RefreshButton" Content="Refresh" Click="RefreshData_Click"
                                Style="{StaticResource SecondaryButtonStyle}" Margin="8,0,0,0" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Tracked Underlyings -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="Tracked Underlyings" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,16" />
                    <ListView x:Name="UnderlyingsList" SelectionMode="Single" MaxHeight="200"
                              Background="Transparent" BorderThickness="0"
                              SelectionChanged="UnderlyingsList_SelectionChanged">
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                <Setter Property="Padding" Value="0" />
                                <Setter Property="Margin" Value="0,0,0,4" />
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="Cursor" Value="Hand" />
                            </Style>
                        </ListView.ItemContainerStyle>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource ConsoleBackgroundLightBrush}"
                                        CornerRadius="6" Padding="12,8"
                                        BorderBrush="{StaticResource ConsoleBorderBrush}" BorderThickness="1">
                                    <TextBlock Text="{Binding}" FontSize="14" FontWeight="Bold"
                                               Foreground="{StaticResource InfoColorBrush}" />
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                    <TextBlock x:Name="NoUnderlyingsText" Text="No tracked underlyings. Use the lookup above to load option chain data."
                               FontSize="12" Foreground="{StaticResource ConsoleTextMutedBrush}"
                               Visibility="Visible" Margin="0,8,0,0" />
                </StackPanel>
            </Border>

            <!-- Expirations -->
            <Border x:Name="ExpirationsPanel" Style="{StaticResource CardStyle}" Margin="0,0,0,24" Visibility="Collapsed">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <TextBlock x:Name="ExpirationsHeader" Text="Expirations" Style="{StaticResource CardHeaderStyle}" />
                    </StackPanel>
                    <ListView x:Name="ExpirationsList" SelectionMode="Single" MaxHeight="250"
                              Background="Transparent" BorderThickness="0"
                              SelectionChanged="ExpirationsList_SelectionChanged">
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                <Setter Property="Padding" Value="0" />
                                <Setter Property="Margin" Value="0,0,0,4" />
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="Cursor" Value="Hand" />
                            </Style>
                        </ListView.ItemContainerStyle>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource ConsoleBackgroundLightBrush}"
                                        CornerRadius="6" Padding="12,8"
                                        BorderBrush="{StaticResource ConsoleBorderBrush}" BorderThickness="1">
                                    <TextBlock Text="{Binding}" FontSize="13"
                                               Foreground="{StaticResource ConsoleTextPrimaryBrush}" />
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>
            </Border>

            <!-- Option Chain Table -->
            <Border x:Name="ChainPanel" Style="{StaticResource CardStyle}" Margin="0,0,0,24" Visibility="Collapsed">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <TextBlock x:Name="ChainHeader" Text="Option Chain" Style="{StaticResource CardHeaderStyle}" />
                    </StackPanel>

                    <!-- Chain Summary Info -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <TextBlock x:Name="ChainUnderlyingPrice" Text="" FontSize="13"
                                   Foreground="{StaticResource ConsoleTextSecondaryBrush}" Margin="0,0,16,0" />
                        <TextBlock x:Name="ChainDTE" Text="" FontSize="13"
                                   Foreground="{StaticResource ConsoleTextMutedBrush}" Margin="0,0,16,0" />
                        <TextBlock x:Name="ChainPCRatio" Text="" FontSize="13"
                                   Foreground="{StaticResource ConsoleTextMutedBrush}" />
                    </StackPanel>

                    <!-- Calls -->
                    <TextBlock Text="Calls" FontSize="14" FontWeight="SemiBold"
                               Foreground="{StaticResource SuccessColorBrush}" Margin="0,0,0,8" />
                    <ListView x:Name="CallsList" MaxHeight="300"
                              Background="Transparent" BorderThickness="0">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Strike" Width="80" DisplayMemberBinding="{Binding Strike}" />
                                <GridViewColumn Header="Bid" Width="70" DisplayMemberBinding="{Binding BidPrice}" />
                                <GridViewColumn Header="Ask" Width="70" DisplayMemberBinding="{Binding AskPrice}" />
                                <GridViewColumn Header="Last" Width="70" DisplayMemberBinding="{Binding LastPrice}" />
                                <GridViewColumn Header="IV" Width="70" DisplayMemberBinding="{Binding ImpliedVolatility}" />
                                <GridViewColumn Header="Delta" Width="70" DisplayMemberBinding="{Binding Delta}" />
                                <GridViewColumn Header="Gamma" Width="70" DisplayMemberBinding="{Binding Gamma}" />
                                <GridViewColumn Header="OI" Width="70" DisplayMemberBinding="{Binding OpenInterest}" />
                                <GridViewColumn Header="Volume" Width="70" DisplayMemberBinding="{Binding Volume}" />
                            </GridView>
                        </ListView.View>
                    </ListView>

                    <!-- Puts -->
                    <TextBlock Text="Puts" FontSize="14" FontWeight="SemiBold"
                               Foreground="{StaticResource ErrorColorBrush}" Margin="0,16,0,8" />
                    <ListView x:Name="PutsList" MaxHeight="300"
                              Background="Transparent" BorderThickness="0">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Strike" Width="80" DisplayMemberBinding="{Binding Strike}" />
                                <GridViewColumn Header="Bid" Width="70" DisplayMemberBinding="{Binding BidPrice}" />
                                <GridViewColumn Header="Ask" Width="70" DisplayMemberBinding="{Binding AskPrice}" />
                                <GridViewColumn Header="Last" Width="70" DisplayMemberBinding="{Binding LastPrice}" />
                                <GridViewColumn Header="IV" Width="70" DisplayMemberBinding="{Binding ImpliedVolatility}" />
                                <GridViewColumn Header="Delta" Width="70" DisplayMemberBinding="{Binding Delta}" />
                                <GridViewColumn Header="Gamma" Width="70" DisplayMemberBinding="{Binding Gamma}" />
                                <GridViewColumn Header="OI" Width="70" DisplayMemberBinding="{Binding OpenInterest}" />
                                <GridViewColumn Header="Volume" Width="70" DisplayMemberBinding="{Binding Volume}" />
                            </GridView>
                        </ListView.View>
                    </ListView>
                </StackPanel>
            </Border>

            <!-- Status -->
            <Border x:Name="StatusPanel" Style="{StaticResource CardStyle}" Visibility="Collapsed">
                <StackPanel>
                    <TextBlock x:Name="StatusText" Text="" FontSize="13"
                               Foreground="{StaticResource ConsoleTextPrimaryBrush}" />
                    <ProgressBar x:Name="LoadingProgress" IsIndeterminate="True" Height="4" Margin="0,8,0,0"
                                 Visibility="Collapsed" Foreground="{StaticResource InfoColorBrush}" />
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>
</Page>
