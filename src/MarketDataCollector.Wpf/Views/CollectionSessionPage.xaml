<Page x:Class="MarketDataCollector.Wpf.Views.CollectionSessionPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="{DynamicResource ConsoleBackgroundDarkBrush}"
      Loaded="OnPageLoaded">
    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24">
        <StackPanel MaxWidth="1200">
            <!-- Page Header -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,24">
                <TextBlock Text="&#xE768;" FontFamily="{StaticResource SymbolThemeFontFamily}"
                           FontSize="28" Foreground="{StaticResource InfoColorBrush}" VerticalAlignment="Center" />
                <TextBlock Text="Collection Sessions" Style="{StaticResource PageTitleStyle}" Margin="12,0,0,0" VerticalAlignment="Center" />
            </StackPanel>

            <!-- Active Session -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                <StackPanel>
                    <TextBlock Text="Active Session" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,12" />
                    <Border x:Name="ActiveSessionPanel" Visibility="Collapsed"
                            BorderBrush="{StaticResource SuccessColorBrush}" BorderThickness="1"
                            CornerRadius="4" Padding="12" Margin="0,0,0,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock x:Name="ActiveSessionName" Text="" FontSize="16" FontWeight="SemiBold"
                                           Foreground="{StaticResource ConsoleTextPrimaryBrush}" />
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <Ellipse Width="8" Height="8" Fill="{StaticResource SuccessColorBrush}" VerticalAlignment="Center" />
                                    <TextBlock x:Name="ActiveSessionStatus" Text="Active" Margin="6,0,0,0"
                                               Foreground="{StaticResource SuccessColorBrush}" FontSize="12" />
                                    <TextBlock x:Name="ActiveSessionDuration" Text="" Margin="16,0,0,0"
                                               Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="12" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                    <TextBlock Text="Events: " Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="11" />
                                    <TextBlock x:Name="ActiveSessionEvents" Text="0"
                                               Foreground="{StaticResource ConsoleTextPrimaryBrush}" FontSize="11" />
                                    <TextBlock Text="  |  Rate: " Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="11" Margin="8,0,0,0" />
                                    <TextBlock x:Name="ActiveSessionRate" Text="0/s"
                                               Foreground="{StaticResource ConsoleTextPrimaryBrush}" FontSize="11" />
                                </StackPanel>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Pause" Style="{StaticResource PrimaryButtonStyle}"
                                        Click="PauseSession_Click" Padding="12,6" Margin="0,0,8,0" />
                                <Button Content="Stop" Style="{StaticResource PrimaryButtonStyle}"
                                        Click="StopSession_Click" Padding="12,6" />
                            </StackPanel>
                        </Grid>
                    </Border>
                    <TextBlock x:Name="NoActiveSessionText" Text="No active collection session."
                               Foreground="{StaticResource ConsoleTextMutedBrush}" />
                </StackPanel>
            </Border>

            <!-- Quick Actions -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                <StackPanel>
                    <TextBlock Text="Quick Actions" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,12" />
                    <StackPanel Orientation="Horizontal">
                        <Button Content="Create Daily Session" Style="{StaticResource PrimaryButtonStyle}"
                                Click="CreateDailySession_Click" Padding="16,8" Margin="0,0,8,0" />
                        <Button Content="Refresh" Style="{StaticResource PrimaryButtonStyle}"
                                Click="RefreshSessions_Click" Padding="16,8" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Session History -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                <StackPanel>
                    <TextBlock Text="Session History" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,12" />
                    <TextBlock x:Name="SessionHistoryStatus" Text="Loading sessions..."
                               Foreground="{StaticResource ConsoleTextMutedBrush}" Margin="0,0,0,8" />
                    <ItemsControl x:Name="SessionHistoryList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="{StaticResource ConsoleTextMutedBrush}" BorderThickness="0,0,0,1"
                                        Padding="0,8" Margin="0,0,0,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold"
                                                       Foreground="{StaticResource ConsoleTextPrimaryBrush}" />
                                            <TextBlock Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="11">
                                                <Run Text="{Binding CreatedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" />
                                                <Run Text=" | " />
                                                <Run Text="{Binding Symbols.Length, StringFormat='{}{0} symbols'}" />
                                            </TextBlock>
                                        </StackPanel>
                                        <TextBlock Grid.Column="1" Text="{Binding Status}" Margin="12,0"
                                                   VerticalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="{StaticResource ConsoleTextMutedBrush}" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Status}" Value="Completed">
                                                            <Setter Property="Foreground" Value="{StaticResource SuccessColorBrush}" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Active">
                                                            <Setter Property="Foreground" Value="{StaticResource InfoColorBrush}" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Paused">
                                                            <Setter Property="Foreground" Value="{StaticResource WarningColorBrush}" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                        <TextBlock Grid.Column="2" Text="{Binding QualityScore, StringFormat='{}{0:F1}%'}"
                                                   Foreground="{StaticResource ConsoleTextMutedBrush}" Margin="12,0"
                                                   VerticalAlignment="Center" />
                                        <TextBlock Grid.Column="3" Text="{Binding Statistics.TotalEvents, StringFormat='{}{0:N0} events'}"
                                                   Foreground="{StaticResource ConsoleTextMutedBrush}" Margin="12,0,0,0"
                                                   VerticalAlignment="Center" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <!-- Session Summary -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="Session Summary" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,12" />
                    <TextBlock x:Name="SessionSummaryText" Text="Select a completed session to view its summary."
                               Foreground="{StaticResource ConsoleTextMutedBrush}" TextWrapping="Wrap"
                               FontFamily="Consolas" FontSize="11" />
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</Page>
