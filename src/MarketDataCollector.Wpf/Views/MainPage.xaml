<Page x:Class="MarketDataCollector.Wpf.Views.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      mc:Ignorable="d"
      d:DesignHeight="900" d:DesignWidth="1400"
      Background="{DynamicResource ConsoleBackgroundDarkBrush}"
      Loaded="OnPageLoaded">

    <Page.Resources>
        <!-- Navigation Item Style -->
        <Style x:Key="NavItemStyle" TargetType="ListBoxItem">
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Padding" Value="16,10" />
            <Setter Property="Margin" Value="8,1" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{StaticResource ConsoleTextSecondaryBrush}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ConsoleBackgroundHoverBrush}" />
                                <Setter Property="Foreground" Value="{StaticResource ConsoleTextPrimaryBrush}" />
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ConsoleBackgroundActiveBrush}" />
                                <Setter Property="Foreground" Value="{StaticResource ConsoleTextPrimaryBrush}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Navigation Icon Style -->
        <Style x:Key="NavIconStyle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="{StaticResource SymbolThemeFontFamily}" />
            <Setter Property="FontSize" Value="16" />
            <Setter Property="Width" Value="22" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <!-- Navigation Label Style -->
        <Style x:Key="NavLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Margin" Value="10,0,0,0" />
        </Style>

        <!-- Section Header Style -->
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="{StaticResource ConsoleTextMutedBrush}" />
            <Setter Property="Margin" Value="20,14,20,6" />
        </Style>
    </Page.Resources>

    <Page.InputBindings>
        <KeyBinding Key="K" Modifiers="Control" Command="{x:Null}" />
    </Page.InputBindings>

    <Grid>
        <!-- Command Palette Overlay -->
        <Grid x:Name="CommandPaletteOverlay" Visibility="Collapsed"
              Panel.ZIndex="100"
              Background="#80000000"
              MouseDown="CommandPaletteOverlay_MouseDown">
            <Border HorizontalAlignment="Center" VerticalAlignment="Top"
                    Margin="0,80,0,0" Width="560"
                    Background="{StaticResource ConsoleBackgroundDarkBrush}"
                    CornerRadius="12"
                    BorderBrush="{StaticResource ConsoleBorderBrush}"
                    BorderThickness="1"
                    Padding="0"
                    MouseDown="CommandPaletteBorder_MouseDown">
                <StackPanel>
                    <TextBox x:Name="CommandPaletteTextBox"
                             Margin="12,12,12,4"
                             Padding="10,8"
                             FontSize="14"
                             Background="{StaticResource ConsoleBackgroundMediumBrush}"
                             Foreground="{StaticResource ConsoleTextPrimaryBrush}"
                             BorderBrush="{StaticResource ConsoleBorderBrush}"
                             BorderThickness="1"
                             TextChanged="CommandPaletteTextBox_TextChanged"
                             KeyDown="CommandPaletteTextBox_KeyDown" />
                    <ListBox x:Name="CommandPaletteResults"
                             MaxHeight="320"
                             Background="Transparent"
                             BorderThickness="0"
                             ItemContainerStyle="{StaticResource NavItemStyle}"
                             SelectionChanged="CommandPaletteResults_SelectionChanged"
                             Margin="4,0,4,4" />
                    <TextBlock Text="Ctrl+K to open  ·  Esc to close  ·  Enter to select"
                               FontSize="11"
                               Opacity="0.4"
                               Foreground="{StaticResource ConsoleTextMutedBrush}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,10" />
                </StackPanel>
            </Border>
        </Grid>

        <DockPanel>
            <!-- Sidebar Navigation -->
            <Border DockPanel.Dock="Left"
                    Width="260"
                    Background="{StaticResource ConsoleBackgroundMediumBrush}"
                    BorderBrush="{StaticResource ConsoleBorderBrush}"
                    BorderThickness="0,0,1,0">
                <DockPanel>
                    <!-- Header with Logo/Title -->
                    <Border DockPanel.Dock="Top"
                            Padding="20,20,20,16"
                            BorderBrush="{StaticResource ConsoleBorderBrush}"
                            BorderThickness="0,0,0,1">
                        <StackPanel>
                            <!-- App Title -->
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{StaticResource IconChart}"
                                           FontFamily="{StaticResource SymbolThemeFontFamily}"
                                           FontSize="24"
                                           Foreground="{StaticResource SuccessColorBrush}"
                                           VerticalAlignment="Center" />
                                <TextBlock Text="Market Data"
                                           FontSize="20"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource ConsoleTextPrimaryBrush}"
                                           Margin="12,0,0,0"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                            <TextBlock Text="Collector"
                                       FontSize="20"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource ConsoleTextPrimaryBrush}"
                                       Margin="36,2,0,0" />

                            <!-- Version Badge -->
                            <Border Margin="0,10,0,0"
                                    HorizontalAlignment="Left"
                                    Style="{StaticResource NeutralBadgeStyle}">
                                <TextBlock Text="v1.6.1"
                                           FontSize="11"
                                           Foreground="{StaticResource ConsoleTextMutedBrush}"
                                           FontFamily="Cascadia Code, Consolas, monospace" />
                            </Border>
                        </StackPanel>
                    </Border>

                    <!-- Footer with Help Link -->
                    <Border DockPanel.Dock="Bottom"
                            Padding="20,12"
                            BorderBrush="{StaticResource ConsoleBorderBrush}"
                            BorderThickness="0,1,0,0">
                        <StackPanel>
                            <Button Style="{StaticResource GhostButtonStyle}"
                                    HorizontalAlignment="Stretch"
                                    Click="OnCommandPaletteButtonClick"
                                    ToolTip="Quick Command (Ctrl+K)">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="{StaticResource IconSearch}"
                                               FontFamily="{StaticResource SymbolThemeFontFamily}"
                                               FontSize="14"
                                               VerticalAlignment="Center" />
                                    <TextBlock Text="Ctrl+K"
                                               Margin="8,0,0,0"
                                               FontSize="12"
                                               Opacity="0.6"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button Style="{StaticResource GhostButtonStyle}"
                                    HorizontalAlignment="Stretch"
                                    Click="OnHelpButtonClick"
                                    Margin="0,4,0,0">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="{StaticResource IconHelp}"
                                               FontFamily="{StaticResource SymbolThemeFontFamily}"
                                               FontSize="16"
                                               VerticalAlignment="Center" />
                                    <TextBlock Text="Help &amp; Support"
                                               Margin="8,0,0,0"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Border>

                    <!-- Navigation Menu -->
                    <ScrollViewer DockPanel.Dock="Top"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <StackPanel Margin="0,4,0,4">

                            <!-- ═══ MONITOR Workspace ═══ -->
                            <TextBlock Text="MONITOR" Style="{StaticResource SectionHeaderStyle}" />

                            <ListBox x:Name="MonitorNavList"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     ItemContainerStyle="{StaticResource NavItemStyle}"
                                     SelectionChanged="OnMonitorNavSelectionChanged">
                                <ListBoxItem Tag="Dashboard">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconDashboard}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Dashboard" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                                <ListBoxItem Tag="LiveData">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconChart}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Live Data" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                                <ListBoxItem Tag="Charts">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconChartLine}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Charts" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                                <ListBoxItem Tag="Watchlist">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconList}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Watchlist" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                            </ListBox>

                            <Rectangle Style="{StaticResource HorizontalDividerStyle}" Margin="20,6" />

                            <!-- ═══ COLLECT Workspace ═══ -->
                            <TextBlock Text="COLLECT" Style="{StaticResource SectionHeaderStyle}" />

                            <ListBox x:Name="CollectNavList"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     ItemContainerStyle="{StaticResource NavItemStyle}"
                                     SelectionChanged="OnCollectNavSelectionChanged">
                                <ListBoxItem Tag="Provider">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconNetwork}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Provider" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                                <ListBoxItem Tag="Symbols">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconList}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Symbols" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                                <ListBoxItem Tag="Backfill">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconDownload}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Backfill" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                                <ListBoxItem Tag="Options">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconTrending}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Options" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                            </ListBox>

                            <Rectangle Style="{StaticResource HorizontalDividerStyle}" Margin="20,6" />

                            <!-- ═══ STORAGE Workspace ═══ -->
                            <TextBlock Text="STORAGE" Style="{StaticResource SectionHeaderStyle}" />

                            <ListBox x:Name="StorageNavList"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     ItemContainerStyle="{StaticResource NavItemStyle}"
                                     SelectionChanged="OnStorageNavSelectionChanged">
                                <ListBoxItem Tag="Storage">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconDatabase}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Storage" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                                <ListBoxItem Tag="DataExport">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconExport}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Export" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                                <ListBoxItem Tag="PackageManager">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconExport}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Packages" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                            </ListBox>

                            <Rectangle Style="{StaticResource HorizontalDividerStyle}" Margin="20,6" />

                            <!-- ═══ QUALITY Workspace ═══ -->
                            <TextBlock Text="QUALITY" Style="{StaticResource SectionHeaderStyle}" />

                            <ListBox x:Name="QualityNavList"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     ItemContainerStyle="{StaticResource NavItemStyle}"
                                     SelectionChanged="OnQualityNavSelectionChanged">
                                <ListBoxItem Tag="DataQuality">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconCheckmark}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Data Quality" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                                <ListBoxItem Tag="ProviderHealth">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconNetwork}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Provider Health" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                                <ListBoxItem Tag="Diagnostics">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconSettings}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Diagnostics" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                            </ListBox>

                            <Rectangle Style="{StaticResource HorizontalDividerStyle}" Margin="20,6" />

                            <!-- ═══ SETTINGS Workspace ═══ -->
                            <TextBlock Text="SETTINGS" Style="{StaticResource SectionHeaderStyle}" />

                            <ListBox x:Name="SettingsNavList"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     ItemContainerStyle="{StaticResource NavItemStyle}"
                                     SelectionChanged="OnSettingsNavSelectionChanged">
                                <ListBoxItem Tag="Settings">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconSettings}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Settings" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                                <ListBoxItem Tag="AdminMaintenance">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{StaticResource IconSettings}" Style="{StaticResource NavIconStyle}" />
                                        <TextBlock Text="Admin" Style="{StaticResource NavLabelStyle}" />
                                    </StackPanel>
                                </ListBoxItem>
                            </ListBox>
                        </StackPanel>
                    </ScrollViewer>
                </DockPanel>
            </Border>

            <!-- Main Content Area -->
            <Grid>
                <!-- Top Header Bar -->
                <Border DockPanel.Dock="Top"
                        Height="56"
                        VerticalAlignment="Top"
                        Background="{StaticResource ConsoleBackgroundMediumBrush}"
                        BorderBrush="{StaticResource ConsoleBorderBrush}"
                        BorderThickness="0,0,0,1"
                        Padding="24,0">
                    <Grid>
                        <!-- Page Title (Breadcrumb) -->
                        <StackPanel Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Left">
                            <Button x:Name="BackButton"
                                    Style="{StaticResource IconButtonStyle}"
                                    Visibility="Collapsed"
                                    Click="OnBackButtonClick"
                                    ToolTip="Go Back">
                                <TextBlock Text="{StaticResource IconBack}"
                                           FontFamily="{StaticResource SymbolThemeFontFamily}"
                                           FontSize="16" />
                            </Button>
                            <TextBlock x:Name="PageTitleText"
                                       Text="Dashboard"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource ConsoleTextPrimaryBrush}"
                                       VerticalAlignment="Center"
                                       Margin="8,0,0,0" />
                        </StackPanel>

                        <!-- Connection Status and Actions -->
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center">
                            <!-- Connection Status Indicator -->
                            <Border x:Name="ConnectionStatusBadge"
                                    Style="{StaticResource SuccessBadgeStyle}"
                                    Margin="0,0,16,0">
                                <StackPanel Orientation="Horizontal">
                                    <Ellipse x:Name="ConnectionStatusDot"
                                             Width="8" Height="8"
                                             Fill="{StaticResource SuccessColorBrush}"
                                             Margin="0,0,6,0" />
                                    <TextBlock x:Name="ConnectionStatusText"
                                               Text="Connected"
                                               FontSize="12"
                                               Foreground="{StaticResource SuccessColorBrush}" />
                                </StackPanel>
                            </Border>

                            <!-- Refresh Button -->
                            <Button Style="{StaticResource IconButtonStyle}"
                                    ToolTip="Refresh (F5)"
                                    Click="OnRefreshButtonClick">
                                <TextBlock Text="{StaticResource IconRefresh}"
                                           FontFamily="{StaticResource SymbolThemeFontFamily}"
                                           FontSize="16" />
                            </Button>

                            <!-- Notifications Button -->
                            <Button Style="{StaticResource IconButtonStyle}"
                                    ToolTip="Notifications"
                                    Margin="4,0,0,0"
                                    Click="OnNotificationsButtonClick">
                                <TextBlock Text="{StaticResource IconBell}"
                                           FontFamily="{StaticResource SymbolThemeFontFamily}"
                                           FontSize="16" />
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Content Frame -->
                <Frame x:Name="ContentFrame"
                       NavigationUIVisibility="Hidden"
                       Margin="0,56,0,0"
                       Navigated="OnContentFrameNavigated" />
            </Grid>
        </DockPanel>
    </Grid>
</Page>
