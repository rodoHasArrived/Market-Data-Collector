<Page x:Class="MarketDataCollector.Wpf.Views.ScheduleManagerPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="{DynamicResource ConsoleBackgroundDarkBrush}"
      Loaded="OnPageLoaded">
    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24">
        <StackPanel MaxWidth="1200">
            <!-- Page Header -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,24">
                <TextBlock Text="&#xE823;" FontFamily="{StaticResource SymbolThemeFontFamily}"
                           FontSize="28" Foreground="{StaticResource InfoColorBrush}" VerticalAlignment="Center" />
                <TextBlock Text="Schedule Manager" Style="{StaticResource PageTitleStyle}" Margin="12,0,0,0" VerticalAlignment="Center" />
            </StackPanel>

            <!-- Backfill Schedules -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                <StackPanel>
                    <DockPanel Margin="0,0,0,12">
                        <TextBlock Text="Backfill Schedules" Style="{StaticResource CardHeaderStyle}" VerticalAlignment="Center" />
                        <Button Content="Refresh" Style="{StaticResource PrimaryButtonStyle}"
                                Click="RefreshBackfillSchedules_Click" HorizontalAlignment="Right"
                                Padding="12,6" />
                    </DockPanel>
                    <TextBlock x:Name="BackfillSchedulesStatus" Text="Loading schedules..."
                               Foreground="{StaticResource ConsoleTextMutedBrush}" Margin="0,0,0,8" />
                    <ItemsControl x:Name="BackfillSchedulesList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="{StaticResource ConsoleTextMutedBrush}" BorderThickness="0,0,0,1"
                                        Padding="0,8" Margin="0,0,0,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold"
                                                       Foreground="{StaticResource ConsoleTextPrimaryBrush}" />
                                            <TextBlock Text="{Binding CronDescription}"
                                                       Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="11" />
                                        </StackPanel>
                                        <TextBlock Grid.Column="1" Text="{Binding Provider}" Margin="12,0"
                                                   Foreground="{StaticResource InfoColorBrush}" VerticalAlignment="Center" />
                                        <TextBlock Grid.Column="2" Text="{Binding LastRunStatus}" Margin="12,0"
                                                   Foreground="{StaticResource ConsoleTextMutedBrush}" VerticalAlignment="Center" />
                                        <Ellipse Grid.Column="3" Width="10" Height="10" VerticalAlignment="Center" Margin="12,0,0,0">
                                            <Ellipse.Style>
                                                <Style TargetType="Ellipse">
                                                    <Setter Property="Fill" Value="{StaticResource ConsoleTextMutedBrush}" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsEnabled}" Value="True">
                                                            <Setter Property="Fill" Value="{StaticResource SuccessColorBrush}" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsEnabled}" Value="False">
                                                            <Setter Property="Fill" Value="{StaticResource ErrorColorBrush}" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Ellipse.Style>
                                        </Ellipse>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <!-- Maintenance Schedules -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                <StackPanel>
                    <DockPanel Margin="0,0,0,12">
                        <TextBlock Text="Maintenance Schedules" Style="{StaticResource CardHeaderStyle}" VerticalAlignment="Center" />
                        <Button Content="Refresh" Style="{StaticResource PrimaryButtonStyle}"
                                Click="RefreshMaintenanceSchedules_Click" HorizontalAlignment="Right"
                                Padding="12,6" />
                    </DockPanel>
                    <TextBlock x:Name="MaintenanceSchedulesStatus" Text="Loading schedules..."
                               Foreground="{StaticResource ConsoleTextMutedBrush}" Margin="0,0,0,8" />
                    <ItemsControl x:Name="MaintenanceSchedulesList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="{StaticResource ConsoleTextMutedBrush}" BorderThickness="0,0,0,1"
                                        Padding="0,8" Margin="0,0,0,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold"
                                                       Foreground="{StaticResource ConsoleTextPrimaryBrush}" />
                                            <TextBlock Text="{Binding CronDescription}"
                                                       Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="11" />
                                        </StackPanel>
                                        <TextBlock Grid.Column="1" Text="{Binding MaintenanceType}" Margin="12,0"
                                                   Foreground="{StaticResource InfoColorBrush}" VerticalAlignment="Center" />
                                        <TextBlock Grid.Column="2" Text="{Binding LastRunStatus}" Margin="12,0"
                                                   Foreground="{StaticResource ConsoleTextMutedBrush}" VerticalAlignment="Center" />
                                        <Ellipse Grid.Column="3" Width="10" Height="10" VerticalAlignment="Center" Margin="12,0,0,0">
                                            <Ellipse.Style>
                                                <Style TargetType="Ellipse">
                                                    <Setter Property="Fill" Value="{StaticResource ConsoleTextMutedBrush}" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsEnabled}" Value="True">
                                                            <Setter Property="Fill" Value="{StaticResource SuccessColorBrush}" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsEnabled}" Value="False">
                                                            <Setter Property="Fill" Value="{StaticResource ErrorColorBrush}" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Ellipse.Style>
                                        </Ellipse>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <!-- Schedule Templates -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16">
                <StackPanel>
                    <TextBlock Text="Schedule Templates" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,12" />
                    <TextBlock x:Name="TemplatesStatus" Text="Loading templates..."
                               Foreground="{StaticResource ConsoleTextMutedBrush}" Margin="0,0,0,8" />
                    <ItemsControl x:Name="TemplatesList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="{StaticResource ConsoleTextMutedBrush}" BorderThickness="0,0,0,1"
                                        Padding="0,8" Margin="0,0,0,4">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold"
                                                   Foreground="{StaticResource ConsoleTextPrimaryBrush}" />
                                        <TextBlock Foreground="{StaticResource ConsoleTextMutedBrush}" FontSize="11">
                                            <Run Text="{Binding CronDescription}" />
                                            <Run Text=" | " />
                                            <Run Text="{Binding Category}" />
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <!-- Cron Expression Validator -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="Cron Expression Validator" Style="{StaticResource CardHeaderStyle}" Margin="0,0,0,12" />
                    <DockPanel Margin="0,0,0,8">
                        <Button Content="Validate" Style="{StaticResource PrimaryButtonStyle}"
                                Click="ValidateCron_Click" DockPanel.Dock="Right" Padding="12,6" Margin="8,0,0,0" />
                        <TextBox x:Name="CronExpressionInput" Text="0 0 * * 1-5"
                                 Foreground="{StaticResource ConsoleTextPrimaryBrush}"
                                 Background="{StaticResource ConsoleBackgroundDarkBrush}"
                                 BorderBrush="{StaticResource ConsoleTextMutedBrush}"
                                 Padding="8,6" FontFamily="Consolas" />
                    </DockPanel>
                    <TextBlock x:Name="CronValidationResult" Text=""
                               Foreground="{StaticResource ConsoleTextMutedBrush}" TextWrapping="Wrap" />
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</Page>
