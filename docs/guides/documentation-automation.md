# Documentation Automation Guide

> User guide for the documentation automation system in Market Data Collector.

## Overview

The documentation automation system keeps project documentation accurate and up-to-date through a unified GitHub Actions workflow (`.github/workflows/documentation.yml`) and a suite of Python scripts in `build/scripts/docs/`.

### What It Does

| Feature | Description |
|---------|-------------|
| **Structure Generation** | Auto-generates repository structure docs from the file tree |
| **Provider Registry** | Extracts provider metadata from `[DataSource]` attributes |
| **ADR Indexing** | Builds an index of Architecture Decision Records |
| **AI Instruction Sync** | Keeps CLAUDE.md, Copilot instructions, and agent files in sync |
| **TODO Scanning** | Finds TODO/FIXME/HACK comments and generates tracking docs |
| **Health Dashboard** | Computes documentation quality metrics and health score |
| **Link Repair** | Detects and auto-fixes broken internal links |
| **Code Example Validation** | Validates syntax of code examples in docs |
| **Documentation Coverage** | Measures what percentage of code is documented |
| **Changelog Generation** | Generates changelogs from conventional commit messages |
| **Custom Rules Engine** | Enforces project-specific documentation rules |

## Workflow Triggers

The workflow runs automatically on:

- **Push to main** when documentation-related files change
- **Pull requests** to main with doc changes
- **Weekly schedule** (Monday 3 AM UTC) for full regeneration
- **Manual dispatch** via GitHub Actions UI with configurable options
- **Issue events** for AI Known Error intake

## Manual Dispatch Options

When triggering manually via Actions UI:

| Input | Default | Description |
|-------|---------|-------------|
| `regenerate` | false | Force regenerate all docs |
| `update_all` | false | Update all auto-generated outputs |
| `dry_run` | true | Show changes without committing |
| `create_pr` | false | Create PR instead of direct commit |
| `scan_todos` | true | Run TODO scanning |
| `create_issues` | false | Create GitHub issues for untracked TODOs |
| `include_notes` | true | Include NOTE comments in TODO scan |
| `use_copilot` | true | Use AI for triage recommendations |
| `run_expansion` | true | Run expansion features |

## Job Execution Flow

```
detect-changes (always runs first)
    |
    +-- validate-docs      (parallel)
    +-- regenerate-docs    (parallel)
    +-- scan-todos         (parallel)
    +-- validate-examples  (parallel)
    +-- generate-changelog (parallel)
    |
    +-- link-repair        (after regenerate-docs)
    +-- coverage-report    (after regenerate-docs)
    |
    +-- create-todo-issues (after scan-todos, manual only)
    |
    +-- report             (final, always runs)
```

Key optimization: `validate-docs`, `regenerate-docs`, and `scan-todos` all run in parallel after change detection completes, reducing total execution time.

## Python Scripts

### Core Scripts

#### `scan-todos.py`

Scans the codebase for TODO/FIXME/HACK/NOTE comments.

```bash
# Basic scan
python3 build/scripts/docs/scan-todos.py --output docs/status/TODO.md

# JSON output
python3 build/scripts/docs/scan-todos.py --json-output results.json

# Exclude NOTEs
python3 build/scripts/docs/scan-todos.py --include-notes false
```

#### `generate-structure-docs.py`

Generates repository structure documentation.

```bash
# Full structure
python3 build/scripts/docs/generate-structure-docs.py --output docs/generated/repository-structure.md

# Provider registry only
python3 build/scripts/docs/generate-structure-docs.py --providers-only --output docs/generated/provider-registry.md

# Workflows overview
python3 build/scripts/docs/generate-structure-docs.py --workflows-only --output docs/generated/workflows-overview.md
```

#### `update-claude-md.py`

Syncs the Repository Structure section across AI instruction files.

```bash
# Update CLAUDE.md
python3 build/scripts/docs/update-claude-md.py --claude-md CLAUDE.md --structure-source docs/generated/repository-structure.md

# Dry run
python3 build/scripts/docs/update-claude-md.py --dry-run
```

### Expansion Scripts

#### `generate-health-dashboard.py`

Generates a documentation health score and metrics dashboard.

```bash
python3 build/scripts/docs/generate-health-dashboard.py \
  --output docs/status/health-dashboard.md \
  --json-output docs-health.json
```

#### `repair-links.py`

Detects and optionally auto-fixes broken internal links in documentation.

```bash
# Report only
python3 build/scripts/docs/repair-links.py --output docs/status/link-repair-report.md

# Auto-fix broken links
python3 build/scripts/docs/repair-links.py --auto-fix --output docs/status/link-repair-report.md
```

#### `validate-examples.py`

Validates code examples (Python, JSON, bash, C#) found in markdown files.

```bash
python3 build/scripts/docs/validate-examples.py --output docs/status/example-validation.md
```

#### `generate-coverage.py`

Measures documentation coverage of public APIs, providers, and configuration.

```bash
python3 build/scripts/docs/generate-coverage.py --output docs/status/coverage-report.md
```

#### `generate-changelog.py`

Generates a changelog from conventional commit messages.

```bash
python3 build/scripts/docs/generate-changelog.py --output docs/status/CHANGELOG.md --recent 50
```

#### `rules-engine.py`

Enforces custom documentation validation rules defined in YAML.

```bash
python3 build/scripts/docs/rules-engine.py \
  --rules build/rules/doc-rules.yaml \
  --output docs/status/rules-report.md
```

## Custom Rules

Documentation rules are defined in `build/rules/doc-rules.yaml`. See [Adding Custom Rules](adding-custom-rules.md) for details.

## Generated Output Files

| File | Generator | Purpose |
|------|-----------|---------|
| `docs/generated/repository-structure.md` | generate-structure-docs.py | Repository file tree |
| `docs/generated/provider-registry.md` | generate-structure-docs.py | Data provider catalog |
| `docs/generated/workflows-overview.md` | generate-structure-docs.py | CI/CD workflow summary |
| `docs/generated/adr-index.md` | workflow inline | ADR index table |
| `docs/generated/configuration-schema.md` | workflow inline | Config options from appsettings |
| `docs/generated/project-context.md` | DocGenerator (C#) | Key interfaces and services |
| `docs/status/TODO.md` | scan-todos.py | TODO tracking |
| `docs/status/health-dashboard.md` | generate-health-dashboard.py | Health metrics |
| `docs/status/link-repair-report.md` | repair-links.py | Broken link report |
| `docs/status/example-validation.md` | validate-examples.py | Code example validation |
| `docs/status/coverage-report.md` | generate-coverage.py | Documentation coverage |
| `docs/status/rules-report.md` | rules-engine.py | Rule validation results |

All generated files include an "auto-generated" notice and should not be edited manually.

## Troubleshooting

### Workflow skipped all jobs

The `detect-changes` job uses path-based filtering. If your changes don't match any watched paths, jobs will be skipped. Use `workflow_dispatch` with `update_all=true` to force a full run.

### Script fails with encoding errors

All scripts handle encoding gracefully with `errors='replace'`. If you encounter persistent encoding issues, check for binary files with `.md` extensions.

### Generated files show no changes

The workflow only commits when actual content changes are detected. Timestamp-only changes in generated files are expected and intentional.

### Link repair reports false positives

The link repair script only checks internal (relative) links. Links to anchors require the target heading to exist exactly as referenced. Case-sensitive heading IDs may cause false positives.

---

*This guide is part of the documentation automation system.*
