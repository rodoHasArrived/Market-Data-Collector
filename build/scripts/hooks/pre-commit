#!/bin/sh
# Pre-commit hook: enforce code formatting via dotnet format.
# Install by running: build/scripts/hooks/install-hooks.sh
# or manually: cp build/scripts/hooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

set -e

# Only check staged C#/F# files
STAGED_CS=$(git diff --cached --name-only --diff-filter=ACM -- '*.cs' '*.fs' | head -1)
if [ -z "$STAGED_CS" ]; then
    exit 0
fi

# Verify dotnet is available
if ! command -v dotnet >/dev/null 2>&1; then
    echo "Warning: dotnet CLI not found, skipping format check."
    exit 0
fi

echo "Running dotnet format --verify-no-changes..."
if ! dotnet format --verify-no-changes --verbosity quiet 2>/dev/null; then
    echo ""
    echo "Code formatting issues detected."
    echo "Please run 'dotnet format' to fix formatting, then re-stage your changes."
    exit 1
fi

echo "Format check passed."
